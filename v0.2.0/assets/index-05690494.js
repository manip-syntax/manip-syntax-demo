var P=Object.defineProperty;var k=(t,e,n)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>(k(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function S(t,e){let n=t.length;if(n!=e.length)return!1;for(;n--;)if(t[n]!==e[n])return!1;return!0}function l(t){if(t===null)throw TypeError("elt is null");return t}function q(t,e,n={}){let s=document.createElement(e);return t.appendChild(s),Object.entries(n).forEach(([o,r])=>s.setAttribute(o,r)),s}function L(t,e){t.classList.add("modal-contenu-animation-disparition");const n=()=>{e.style.display="none",t.classList.remove("modal-contenu-animation-disparition"),t.removeEventListener("animationend",n)};t.addEventListener("animationend",n)}function a(t){return l(document.getElementById(t))}const f=class{constructor(e){p(this,"verbes",[]);p(this,"_phrase_cassee",[]);p(this,"_fonctions",{});this.phrase=e,this.phrase=e,this._cassePhrase()}get contenu(){return this.phrase}set contenu(e){this.phrase=e}get copie(){let e=new f(this.contenu);return e.verbes=this.verbes,e._fonctions=this._fonctions,e}toJSON(){const e=this.copie;let n=Object.assign(e);return delete n._phrase_cassee,n}get phraseCassee(){return this._phrase_cassee}get longueur(){return this._phrase_cassee.length}static get separateur(){return this._separateur}fonction(e){let n=[];if(e>=this.longueur)return n;this.verbes.includes(e)&&n.push("verbes");for(const s in this._fonctions)this._fonctions[s].includes(e)&&n.push(s);return n}fonction_detaillee(e){return this.fonction(e).map(n=>{const s=this.fonctionPos(n);return[n,s[0],s.slice(-1)[0]]}).sort((n,s)=>n[2]-n[1]>s[2]-s[1]?-1:1)}fonctionPos(e){return e=="verbes"?this.verbes:this._fonctions[e]}fonctionMots(e){return this._fonctions[e].map(n=>this._phrase_cassee[n]).join(" ")}declareFonction(e,n){n.length!==0&&(e==="verbes"?this.verbes=n:this._fonctions[e]=n.sort((s,o)=>s-o))}_cassePhrase(){this._phrase_cassee=this.phrase.split(f._separateur).filter(e=>e)}};let m=f;p(m,"Separateur","[ ,;?!.'-]"),p(m,"_separateur",new RegExp(f.Separateur));class u extends m{constructor(e){super(e)}toJSON(){return Object.assign(this)}static reviver(e,n){return e===""?u.fromJSON(n):n}static fromJSON(e){if(typeof e=="string")return JSON.parse(e,u.reviver);{let n=Object.create(u.prototype);return Object.assign(n,e)}}aFonction(e){const n=this.fonctionPos(e);return typeof n>"u"?!1:!S(n,[])}estFonction(e,n){return typeof this.fonctionPos(e)>"u"?!1:S(this.fonctionPos(e),n.sort())}}class _ extends m{constructor(e,n){super(e),this._corrige=n,this._corrige=n}get corrige(){return this._corrige}declare(e,n){return this.declareFonction(e,n),this._corrige.estFonction(e,n)}}function I(t,e){return["sujet","groupe_verbal"].includes(t)?e?"[":"]":""}function H(t,e){return e==t[1]||t[0]==="verbes"?`${I(t[0],!0)}<span class="phrase-${t[0]}">`:""}function $(t,e){return e==t[2]||t[0]==="verbes"?`</span>${I(t[0],!1)}`:""}function x(t){const e=new RegExp("("+_.Separateur+")"),n=t.contenu.split(e);let s=0,o=[];for(const r of n){if(_.Separateur.includes(r)){o.push(r);continue}const i=t.fonction_detaillee(s);i.forEach(c=>o.push(H(c,s))),o.push(`<span class="phrase-cliquable" id="phrase-mot-${s}">${r}</span>`),i.forEach(c=>o.push($(c,s))),s+=1}return o.join("")}Array();let g={fonction_de_validation:()=>{console.log("Problème: la fonction de validation n'a pas été mise en place")}};let N=()=>console.log("Problème: aucune fonction définie pour le bouton OK de la nouvelle phrase");l(document.getElementById("modal-nouvelle_phrase-bouton")).addEventListener("click",()=>{N()});let B=()=>console.log("Problème: aucune fonction définie pour la validation de la nouvelle phrase");l(document.getElementById("bouton-valider-phrase")).addEventListener("click",()=>{B()});let v=()=>(console.log("Problème: enregistre_fonction n'a pas été instancié"),new _("vide",new u("vide")));const b={Sujet:"sujet",Verbes:"verbes","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément du verbe impersonnel":"complement_du_verbe_impersonnel"};function y(t,e){const[n,s]=Object.entries(b)[t];l(document.getElementById("phrase-analyse-paragraphe")).innerHTML=x(e),l(document.getElementById("consigne-container")).innerHTML=`À renseigner : ${n}`,v=()=>{const o=Array.from(document.getElementsByClassName("phrase-selectionne")).map(r=>Number(r.id.split("-")[2]));return e.declareFonction(s,o),e},B=()=>{const o="phrase.{{numéro_de_version}}.json",r=new Blob([JSON.stringify(v())],{type:"text/json"}),i=document.createElement("a");i.download=o,i.href=window.URL.createObjectURL(r),i.dataset.downloadurl=["text/json",i.download,i.href].join(":");const c=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});i.dispatchEvent(c),i.remove(),C()},g.fonction_de_validation=()=>{const o=t===Object.entries(b).length-1?0:t+1;y(o,v());const r=a("nouvelle_phrase-fonctions-selection");r.selectedIndex=o}}function C(){for(const r of l(document.getElementsByClassName("modal")))r.style.display="none";const t=l(document.getElementById("modal-nouvelle-phrase"));t.style.display="block";let e="";Object.entries(b).forEach(([r,i])=>{e+=`<option value="${i}">${r}</option>
`});const n=l(document.getElementById("nouvelle_phrase-fonctions-selection"));n.innerHTML=e,n.style.display="block",l(document.getElementById("conseil")).innerHTML="Sélectionnez chaque fonction comme si vous étiez vous-même l'élève. Cliquez sur valider quand vous avez terminé votre sélection. Valider dans rien sélectionner indique que cette fonction est absente de la phrase. Vous pouvez toujours corriger une éventuelle erreur en sélectionnant une fonction dans la liste déroulante.";const s=l(document.getElementById("bouton-valider"));s.style.width="50%",s.innerHTML="Valider la fonction";const o=l(document.getElementById("bouton-valider-phrase"));o.style.display="block",N=()=>{let r=l(document.getElementById("nouvelle_phrase-texterea")).value;if(r.trim()==="")return;let i=new _(r,new u(r));t.style.display="none",y(0,i),a("nouvelle_phrase-fonctions-selection").addEventListener("change",c=>{const h=c.target;v(),y(h.selectedIndex,i)})}}const A=[{phrase:"Le chat mange la souris.",verbes:[2],_fonctions:{verbe_principal:[2],sujet:[0,1],cod:[3,4],groupe_verbal:[2,3,4]}},{phrase:"Marie donne du lait au chat.",verbes:[1],_fonctions:{verbe_principal:[1],sujet:[0],cod:[2,3],coi:[4,5],groupe_verbal:[1,2,3,4,5]}},{phrase:"Un véritable amant ne connaît point d'amis.",verbes:[4],_fonctions:{verbe_principal:[4],sujet:[0,1,2],coi:[6,7],groupe_verbal:[3,4,5,6,7]}},{phrase:"L'amour rend tout permis.",verbes:[2],_fonctions:{verbe_principal:[2],sujet:[0,1],cod:[3],attribut_du_cod:[4],groupe_verbal:[2,3,4]}},{phrase:"Vous êtes son rival ?",verbes:[1],_fonctions:{verbe_principal:[1],sujet:[0],attribut_du_sujet:[2,3],groupe_verbal:[1,2,3]}},{phrase:"Il est adoré d'elle.",verbes:[1,2],_fonctions:{verbe_principal:[1,2],sujet:[0],complément_d_agent:[3,4],groupe_verbal:[1,2,3,4]}}],J=A.map(t=>u.fromJSON(t));function K(t,e=0){return J.slice(e,e+t)}const w=[["verbes","Sélectionne les verbes."],["verbe_principal","Sélectionne le verbe principal"],["groupe_verbal","Sélectionne le groupe verbal"],["sujet","Sélectionne le groupe sujet"],["cod","Sélectionne le Complément d'objet direct (COD)."],["coi","Sélectionne le Complément d'objet indirect (COI)."],["attribut_du_sujet","Sélectionne l'attribut du sujet."],["attribut_du_cod","Sélectionne l'attribut du COD."],["complément_d_agent","Sélectionne le complément d'agent"],["complément_circonstanciel","Sélectionne un complément circonstanciel"],["complément_du_verbe_impersonnel","Sélectionne le complément du verbe impersonnel"],["complément_du_nom","Sélectionne un complément du nom"],["épithète","Sélectionne une épithète"],["apposition","Sélectionne une apposition"],["complément_de_l_adjectif","Sélectionne un complément de l'adjectif"],["modalisateur","Sélectionne un modalisateur"],["auto-énonciative","Sélectionne une fonction auto-énonciative"],["connecteur","Sélectionne un connecteur"],["balise_textuelle","Sélectionne une balise textuelle"]];function M(t){let e=new _(t.contenu,t);E(0,e)}function E(t,e){const[n,s]=w[t];function o(){t===w.length-1?R():E(t+1,e)}if(!e.corrige.aFonction(n))return o();a("consigne-container").innerHTML=`${s}`,a("phrase-analyse-paragraphe").innerHTML=x(e),g.fonction_de_validation=()=>{const r=Array.from(document.getElementsByClassName("phrase-selectionne")).map(c=>Number(c.id.split("-")[2]));if(r.length===0?!e.corrige.aFonction(n):e.declare(n,r))o();else{const c=a("modal-message-contenu");c.classList.add("modal-message-erreur"),d("Il y a une erreur dans ton analyse !","Reprendre l'analyse",()=>{E(t,e),c.classList.remove("modal-message-erreur"),Array.from(document.getElementsByClassName("phrase-cliquable")).forEach(h=>{r.includes(Number(h.id.split("-")[2]))&&h.classList.add("phrase-selectionne")})})}}}function d(t,e,n){const s=a("modal-message"),o=a("modal-message-contenu-texte"),r=a("modal-message-bouton");o.innerHTML=t,r.innerHTML=e,s.style.display="block",F=()=>{L(a("modal-message-contenu"),s),n()}}function R(){d("Bravo !","Commencer une autre analyse",T)}function T(){const t=a("modal-choix-phrase");t.style.display="block";const e=K(5,0),n=a("modal-choix-phrase-liste");n.innerHTML="";for(let s in e){const o=e[s],r=q(n,"li",{id:`modal-choix-phrase-liste-${s}`});r.innerHTML=o.contenu,r.addEventListener("click",()=>{M(e[s]),L(a("modal-choix-phrase-contenu"),t)})}}let j=!1;const O=a("phrase-analyse-paragraphe");O.addEventListener("mousedown",t=>{const e=t.target;t.button!=0||!e.classList.contains("phrase-cliquable")||(j=!0,e.classList.toggle("phrase-selectionne"))});O.addEventListener("mouseover",t=>{const e=t.target;j&&e.classList.contains("phrase-cliquable")&&e.classList.toggle("phrase-selectionne")});O.addEventListener("mouseup",t=>{j=!1});a("bouton-valider").addEventListener("click",()=>{g.fonction_de_validation()});document.onkeyup=function(t){t.which===13&&g.fonction_de_validation()};let F=()=>console.log("Problème: aucune fonction définie pour le bouton du message");a("modal-message-bouton").addEventListener("click",()=>{F()});a("nouvelle_phrase").addEventListener("click",()=>{C()});a("analyse_fichier").addEventListener("click",()=>{for(const t of l(document.getElementsByClassName("modal")))t.style.display="none";a("modal-analyse-fichier").style.display="block"});a("analyse_fichier_input").addEventListener("change",t=>{const e=t.target,n=new FileReader,s=()=>{L(a("modal-analyse-fichier-contenu"),a("modal-analyse-fichier"))};if(e.files.length==0)return s(),d("Pas de fichier chargé.","OK",()=>{});const o=e.files[0];if(!(o.type?o.type:"Introuvable").includes("json"))return s(),d("Format invalide","OK",()=>{});n.addEventListener("load",r=>{const i=n.result??"";if(typeof i!="string"||i==="")return s(),d("Fichier invalide","OK",()=>{});try{M(u.fromJSON(i))}catch(c){return s(),c instanceof TypeError?d("Ce fichier n'est pas compatible avec la version actuelle du programme.","OK",()=>{}):d("Fichier invalide","OK",()=>{})}s()}),n.readAsText(o)});T();
