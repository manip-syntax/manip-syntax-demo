var X=Object.defineProperty;var Y=(s,e,t)=>e in s?X(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var u=(s,e,t)=>(Y(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();function _(s,e){let t=s.length;if(t!=e.length)return!1;for(;t--;)if(s[t]!==e[t])return!1;return!0}function M(s){if(s===null)throw TypeError("elt is null");return s}function Z(s,e,t={}){let n=document.createElement(e);return s.appendChild(n),Object.entries(t).forEach(([o,i])=>n.setAttribute(o,i)),n}function N(s,e){s.classList.add("modal-contenu-animation-disparition");const t=()=>{e.style.display="none",s.classList.remove("modal-contenu-animation-disparition"),s.removeEventListener("animationend",t)};s.addEventListener("animationend",t)}function r(s){return M(document.getElementById(s))}function m(s,e){if(s===!1)throw Error(e)}const C=class{constructor(e=[]){u(this,"_fonctions_uniques",{});u(this,"_fonctions_multiples",{});u(this,"_groupes_enchasses",new Map);u(this,"_fonction_enchassee",(e,t)=>[e,t[0],t.slice(-1)[0]]);this._mots_pos=e}_remplit_les_vides(){typeof this._fonctions_uniques>"u"&&(this._fonctions_uniques={}),typeof this._fonctions_multiples>"u"&&(this._fonctions_multiples={}),typeof this._groupes_enchasses>"u"&&(this._groupes_enchasses=new Map)}get vide(){for(const[,e]of this._groupes_enchasses)if(!e.vide)return!1;return Object.keys(this._fonctions_uniques).length===0&&Object.keys(this._fonctions_multiples).length===0}cree_groupe_enchasse(e,t,n){const o=new $(e);return this._groupes_enchasses.set([t,n],o),o}get groupes_enchasses_nombre(){return this._groupes_enchasses.size}groupe_enchasse(e,t){let n;for(const[o,i]of this._groupes_enchasses)o[0]===e&&o[1]===t&&(n=i);if(typeof n>"u")throw Error(`Pas de groupe avec la fonction ${e} et le numéro ${t}`);return n}supprime_groupe_enchasse(e,t){for(const[n]of this._groupes_enchasses)if(n[0]===e&&n[1]===t)return this._groupes_enchasses.delete(n);return!1}get mots_sans_fonction(){return this._mots_pos.filter(e=>this.fonction(e).length===0)}fonctions_multiples_nombre(e){const t=this._fonctions_multiples;return e in t?t[e].length:0}get copie(){let e=new C;return Object.entries(this._fonctions_uniques).forEach(([t,n])=>{n.length>0&&(e._fonctions_uniques[t]=n)}),Object.entries(this._fonctions_multiples).forEach(([t,n])=>{let o=[];n.length>0&&(o=n.filter(i=>i.length>0)),o.length>0&&(e._fonctions_multiples[t]=o)}),e._groupes_enchasses=new Map([...this._groupes_enchasses.entries()].filter(t=>!t[1].vide).map(t=>[t[0],t[1].copie])),e}get profondeur(){return this._groupes_enchasses.size===0?0:Math.max(...[...this._groupes_enchasses.entries()].map(([e,t])=>t.profondeur))+1}fonction(e){let t=[];for(const n in this._fonctions_uniques)this._fonctions_uniques[n].includes(e)&&t.push(n);for(const n in this._fonctions_multiples)for(const o of this._fonctions_multiples[n])if(o.includes(e)){t.push(n);break}for(const[,n]of this._groupes_enchasses){const o=n.fonction(e);o&&t.push(...o)}return t}fonction_detaillee(e){let t=[];for(const o in this._fonctions_uniques)this._fonctions_uniques[o].includes(e)&&t.push(this._fonction_enchassee(o,this._fonctions_uniques[o]));const n=this._fonctions_multiples;for(const o in n)for(const i of n[o])i.includes(e)&&t.push(this._fonction_enchassee(o,i));for(const[,o]of this._groupes_enchasses)t.push(...o.fonction_detaillee(e));return t.sort((o,i)=>o[2]-o[1]>i[2]-i[1]?-1:1)}fonctionPos(e,t=-1){return t>=0&&m(C.Fonctions_multiples.includes(e),`fonctionPos:  ${e} n'est pas une fonction multiple`),C.Fonctions_multiples.includes(e)?(m(t>-1,`fonctionPos: numero_de_fonction doit être supérieur à -1 pour les fonctions multiples comme ${e}`),!(e in this._fonctions_multiples)||t>=this._fonctions_multiples[e].length?[]:this._fonctions_multiples[e][t]):e in this._fonctions_uniques?this._fonctions_uniques[e]:[]}declareFonction(e,t,n=-1){if(t=t.sort((o,i)=>o-i),C.Fonctions_multiples.includes(e)){let o=this._fonctions_multiples;e in o||(m(n<=0,`declareFonction: ${n} introuvable pour ${e}`),o[e]=[]),n===-1||n===o[e].length?o[e].push(t):(m(n<o[e].length,`declareFonction: ${n} introuvable pour ${e}`),o[e][n]=t)}else this._fonctions_uniques[e]=t}};let p=C;u(p,"Fonctions_multiples",["independante","complement_circonstanciel","modalisateur","auto-enonciative","connecteur","balise_textuelle","epithete","complement_du_nom","complement_du_pronom","complement_de_l_adjectif","apposition"]),u(p,"Fonctions_contenants",["independante","sujet","cod","coi","attribut_du_sujet","attribut_du_cod","complement_circonstanciel","complement_du_verbe_impersonnel","complement_du_nom","complement_du_pronom","epithete","apposition","complement_de_l_adjectif","groupe_verbal"]);const S=class extends p{constructor(t){super();u(this,"verbes",[]);u(this,"_phrase_cassee",[]);this.phrase=t,this.phrase=t,this._cassePhrase(),this._mots_pos=[...Array(this._phrase_cassee.length).keys()]}get contenu(){return this.phrase}get mots_sans_fonction(){return super.mots_sans_fonction.concat(this.verbes)}get mots_pos(){return this._mots_pos}set contenu(t){this.phrase=t}get copie(){let t=super.copie;return t.verbes=this.verbes,t.contenu=this.contenu,t}get profondeur(){let t=super.profondeur;return t>0?t:this.verbes.length>0?1:0}toJSON(){const t=this.copie;let n=Object.assign(t);return n._groupes_enchasses=Array.from(n._groupes_enchasses.entries()),n}get phraseCassee(){return this._phrase_cassee}get longueur(){return this._phrase_cassee.length}static get separateur(){return this._separateur}fonction(t){let n=super.fonction(t);return this.verbes.includes(t)&&n.push("verbes"),n}fonction_detaillee(t){let n=super.fonction_detaillee(t);return this.verbes.includes(t)&&n.push(this._fonction_enchassee("verbes",this.verbes)),n}fonctionPos(t,n=-1){return t=="verbes"?this.verbes:super.fonctionPos(t,n)}fonctionMots(t,n=-1){return n>=0&&(m(p.Fonctions_multiples.includes(t),`fonctionMots: ${t} n'est pas une fonction multiple`),m(t in this._fonctions_multiples,`fonctionMots: ${t} n'a pas été créé.`),m(n<this._fonctions_multiples[t].length,`fonctionMots: ${n} introuvable pour ${t}`)),this.fonctionPos(t,n).map(o=>this._phrase_cassee[o]).join(" ")}mots_valides(t){return t.length>0?t[0]>=0&&t[t.length-1]<this.longueur:!0}declareFonction(t,n,o=-1){m(this.mots_valides(n),`declareFonction: ${n} ne correspond pas à une liste de mots valides. La longueur est de ${this.longueur}`),t==="verbes"?this.verbes=n:super.declareFonction(t,n,o)}_cassePhrase(){this._phrase_cassee=this.phrase.split(S._separateur).filter(t=>t)}};let y=S;u(y,"Separateur","[ ,;?!.'-]"),u(y,"_separateur",new RegExp(S.Separateur));class b extends y{constructor(e){super(e)}static reviver(e,t){return e===""?b.fromJSON(t):t}static fromJSON(e){if(typeof e=="string")return JSON.parse(e,b.reviver);{let t=Object.create(b.prototype);const n=typeof e._groupes_enchasses>"u"?new Map:new Map(Object.entries(e._groupes_enchasses).map(i=>[i[1][0],h.fromJSON(i[1][1])]));let o=Object.assign(t,e,{_groupes_enchasses:n});return o._remplit_les_vides(),o}}cree_groupe_enchasse(e,t,n){const o=new h(e);return this._groupes_enchasses.set([t,n],o),o}groupe_enchasse(e,t){return super.groupe_enchasse(e,t)}aFonction(e){if(p.Fonctions_multiples.includes(e))return e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>!_(n,[])).length>0:!1;const t=this.fonctionPos(e);return!_(t,[])}estFonction(e,t){return t=t.sort(),p.Fonctions_multiples.includes(e)?e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>_(n,t)).length>0:!1:_(this.fonctionPos(e),t.sort())}*groupes_enchasses(){for(const e of this._groupes_enchasses)yield e}}class $ extends p{constructor(e){super(e),this._contenu=e}get copie(){let e=super.copie;return e._contenu=this._contenu,e}get mots_pos(){return this._contenu}toJSON(){let e=this.copie,t=Object.assign(e);return t._groupes_enchasses=Array.from(t._groupes_enchasses.entries()),t}mots_valides(e){if(e.length>0){for(const t of e)if(!this._contenu.includes(t))return!1}return!0}declareFonction(e,t,n=-1){m(this.mots_valides(t),`declareFonction: ${t} ne correspond pas à une liste de mots valides.`),super.declareFonction(e,t,n)}}class h extends ${static reviver(e,t){return e===""?h.fromJSON(t):t}static fromJSON(e){if(typeof e=="string")return JSON.parse(e,h.reviver);{let t=Object.create(h.prototype);const n=typeof e._groupes_enchasses>"u"?new Map:new Map(Object.entries(e._groupes_enchasses).map(i=>[i[1][0],h.fromJSON(i[1][1])]));let o=Object.assign(t,e,{_groupes_enchasses:n});return o._remplit_les_vides(),o}}cree_groupe_enchasse(e,t,n){const o=new h(e);return this._groupes_enchasses.set([t,n],o),o}aFonction(e){if(p.Fonctions_multiples.includes(e))return e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>!_(n,[])).length>0:!1;const t=this.fonctionPos(e);return!_(t,[])}estFonction(e,t){return t=t.sort(),p.Fonctions_multiples.includes(e)?e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>_(n,t)).length>0:!1:_(this.fonctionPos(e),t.sort())}*groupes_enchasses(){for(let e of this._groupes_enchasses)yield e}}class A extends ${constructor(e){super(e.mots_pos),this.gec=e}cree_groupe_enchasse_eleve(e,t,n){const o=new A(e);return this._groupes_enchasses.set([t,n],o),o}get corrige(){return this.gec}est_complet(e){const t=this.corrige.fonctions_multiples_nombre(e);if(t!==this.fonctions_multiples_nombre(e))return!1;const n=this._fonctions_multiples[e];for(let o=0;o<t;o++){const i=this.corrige.fonctionPos(e,o);if(n.filter(c=>_(c,i)).length===0)return!1}return!0}declare(e,t,n=-1){return p.Fonctions_multiples.includes(e)&&e in this._fonctions_multiples&&this._fonctions_multiples[e].filter(o=>_(o,t)).length!==0?!1:(this.declareFonction(e,t,n),this.corrige.estFonction(e,t))}}class f extends y{constructor(e,t){super(e),this._corrige=t,this._corrige=t}get corrige(){return this._corrige}cree_groupe_enchasse_eleve(e,t,n){const o=new A(e);return this._groupes_enchasses.set([t,n],o),o}declare(e,t,n=-1){return p.Fonctions_multiples.includes(e)&&e in this._fonctions_multiples&&this._fonctions_multiples[e].filter(o=>_(o,t)).length!==0?!1:(this.declareFonction(e,t,n),this._corrige.estFonction(e,t))}est_complet(e){const t=this._corrige.fonctions_multiples_nombre(e);if(t!==this.fonctions_multiples_nombre(e))return!1;const n=this._fonctions_multiples[e];for(let o=0;o<t;o++){const i=this._corrige.fonctionPos(e,o);if(n.filter(c=>_(c,i)).length===0)return!1}return!0}}function B(s,e){return["sujet","groupe_verbal"].includes(s)?e?"[":"]":""}function ee(s,e){return e==s[1]||s[0]==="verbes"?`${B(s[0],!0)}<span groupe class="groupe-de-mots phrase-${s[0]}">`:""}function te(s,e){return e==s[2]||s[0]==="verbes"?`</span>${B(s[0],!1)}`:""}function P(s,e=[]){const t=new RegExp("("+f.Separateur+")"),n=s.contenu.split(t);let o=0,i=[];for(const l of n){if(f.Separateur.includes(l)){i.push(l);continue}const c=s.fonction_detaillee(o);c.forEach(d=>i.push(ee(d,o)));const a=e.includes(o)?'class="phrase-cliquable"':'class="phrase-non-cliquable"';i.push(`<span ${a} id="phrase-mot-${o}">${l}</span>`),c.forEach(d=>i.push(te(d,o))),o+=1}return i.join("")}function T(s){const e=V(s);s.style.lineHeight=`${1.8+e/10}`,H(s,e),console.log("profondeur_max",e)}function V(s){let e=1;for(let t=0;t<s.children.length;t++){let n=s.children[t];n.hasAttribute("groupe")&&(e=Math.max(e,V(n)+1))}return e}function H(s,e){for(let t=0;t<s.children.length;t++){let n=s.children[t];n.hasAttribute("groupe")&&(n.style.padding=`0px 0px ${e*10}px`,H(n,e-1))}}Array();let w={fonction_de_validation:()=>{console.log("Problème: la fonction de validation n'a pas été mise en place")}};const ne={Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},oe={Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},se={Noyau:"noyau","Verbe principal":"verbe_principal",COD:"cod",COI:"coi","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément circonstanciel":"complement_circonstanciel","Complément du verbe impersonnel":"complement_du_verbe_impersonnel"},ie={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},re={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},le={"Complément de l'adjectif":"complement_de_l_adjectif",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ce={"Complément de l'adjectif":"complement_de_l_adjectif",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ae={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ue={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},pe={Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},_e={"Complément de l'adjectif":"complement_de_l_adjectif",Noyau:"noyau"},me={Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},de={Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},he={"Complément de l'adjectif":"complement_de_l_adjectif",Sujet:"sujet",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},fe={Noyau:"noyau",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},ge={independante:ne,sujet:oe,groupe_verbal:se,cod:ie,coi:re,attribut_du_sujet:le,attribut_du_cod:ce,complement_d_agent:ae,complement_circonstanciel:ue,complement_du_verbe_impersonnel:pe,epithete:_e,complement_du_nom:me,complement_du_pronom:de,apposition:he,complement_de_l_adjectif:fe};let J=()=>console.log("Problème: aucune fonction définie pour le bouton OK de la nouvelle phrase"),I=()=>console.log("Problème: aucune fonction définie pour la validation de la nouvelle phrase"),G=s=>console.log("Aucune fonction définie pour le sélecteur"),E=()=>(console.log("Problème: enregistre_fonction n'a pas été instancié"),new j("vide"));function ve(){r("modal-nouvelle_phrase-bouton").addEventListener("click",()=>{J()}),r("bouton-valider-phrase").addEventListener("click",()=>{I()}),r("nouvelle_phrase-fonctions-selection").addEventListener("click",s=>{G(s)})}class be{constructor(e,t,n,o,i=-1,l){u(this,"validee",!1);u(this,"est_multiple",!1);this.nom_de_base=e,this.fonction=t,this.html_node=n,this.syntagme=o,this.numero=i,this.parent=l,this.est_multiple=i>-1}get nom(){return this.numero>-1?`${this.nom_de_base}-${this.numero+1}`:this.nom_de_base}get arbre_genealogique(){return typeof this.parent>"u"?this.nom:`${this.parent.arbre_genealogique} > ${this.nom}`}get id_sous_menu(){const e=this.numero===-1?"":`-${this.numero}`,t=`${this.fonction}${e}`;return typeof this.parent>"u"?t:`${this.parent.id_sous_menu}-${t}`}}const O=class{constructor(e){u(this,"_phrase");u(this,"_traceur",[]);u(this,"_pos",0);u(this,"_selecteur",r("nouvelle_phrase-fonctions-selection"));this._phrase=new f(e,new b(e)),this._selecteur.innerHTML="",Object.entries(O.liste_des_fonctions_niveau_1).forEach(t=>this.ajouter_fonction_tracee(this._traceur.length,t[0],t[1])),this._selecteur.style.display="block"}static contenus_possibles(e){return ge[e]}set pos(e){this.fonction_courante.html_node.classList.remove("selectionne"),m(e<this._traceur.length,`${e} est plus grand que la longueur du traceur: ${this._traceur.length}.`),this._pos=e,this.fonction_courante.html_node.classList.add("selectionne")}get pos(){return this._pos}get fonction_courante(){return this._traceur[this._pos]}set_pos_selecteur(e,t){for(let n of e.children)n.classList.contains("selecteur")||n.classList.contains("sous_menu")?t=this.set_pos_selecteur(n,t):(n.setAttribute("pos",t.toString()),t+=1);return t}ajouter_node_selecteur(e,t,n,o){for(let i of e.children)if(i.classList.contains("sous_menu")){if(n=this.ajouter_node_selecteur(i.children[1],t,n+1,o),n>o)return n}else{if(n===o&&i.insertAdjacentElement("beforebegin",t),n>o)return n;n+=1}return n===o?(e.appendChild(t),n+1):n}ajouter_fonction_tracee(e,t,n,o=this._phrase,i=-1,l){f.Fonctions_multiples.includes(n)&&i===-1&&(i=0),m(e<=this._traceur.length,`${e} est plus grand que la longueur du traceur`);let c=document.createElement("div");const a=new be(t,n,c,o,i,l);this._traceur.splice(e,0,a),c.setAttribute("value",a.fonction),c.setAttribute("class","selecteur-element"),c.innerHTML=a.nom,this.ajouter_node_selecteur(this._selecteur,c,0,e),this.set_pos_selecteur(this._selecteur,0)}retirer_enfants(e,t,n=!1){for(const[o,i]of this._traceur.entries())i.parent===e&&(t=this.retirer_enfants(i,t,!1),i.html_node.remove(),t.push(o));return n&&(this._traceur=this._traceur.filter((o,i)=>!t.includes(i)),this.set_pos_selecteur(this._selecteur,0)),t}gere_groupe_enchasse(e,t,n){if(!f.Fonctions_contenants.includes(this.fonction_courante.fonction))return;if(!e){if(n.syntagme.supprime_groupe_enchasse(n.fonction,n.numero)){const a=r(`sous_menu-${n.id_sous_menu}`);a.insertAdjacentElement("beforebegin",n.html_node),this.retirer_enfants(n,[],!0),a.remove()}return}let o=n.syntagme.cree_groupe_enchasse(t,n.fonction,n.numero),i=document.createElement("div");i.setAttribute("class","sous_menu"),i.setAttribute("id",`sous_menu-${n.id_sous_menu}`),this.fonction_courante.html_node.insertAdjacentElement("beforebegin",i),i.insertAdjacentElement("afterbegin",this.fonction_courante.html_node);let l=document.createElement("div");l.setAttribute("class","selecteur sous_menu_contenu"),this.fonction_courante.html_node.insertAdjacentElement("afterend",l);let c=this._pos+1;Object.entries(O.contenus_possibles(this.fonction_courante.fonction)).forEach(a=>{this.ajouter_fonction_tracee(c,a[0],a[1],o,-1,n),c+=1}),i.addEventListener("mouseenter",()=>{l.style.display="block"}),i.addEventListener("mouseleave",()=>{l.style.display="none"}),i.addEventListener("click",()=>{l.style.display="none"})}valide_fonction(e){const t=this.fonction_courante;return t.validee=e,e?t.html_node.classList.add("valide"):t.html_node.classList.remove("valide"),e}analyse_de_fonction(e=-1){e===-1?e=this._pos:this.pos=e;const t=this.fonction_courante.fonction,n=this.fonction_courante.syntagme;r("phrase-analyse-paragraphe").innerHTML=P(this._phrase,n.mots_sans_fonction),T(r("phrase-analyse-paragraphe")),r("consigne-container").innerHTML=`À renseigner : ${this.fonction_courante.arbre_genealogique}`;const o=n.fonctionPos(t,this.fonction_courante.numero);Array.from(document.getElementsByClassName("phrase-cliquable")).forEach(i=>{o.includes(Number(i.id.split("-")[2]))&&i.classList.add("phrase-selectionne")}),E=()=>{const i=Array.from(document.getElementsByClassName("phrase-selectionne")).map(c=>Number(c.id.split("-")[2]));if(this.fonction_courante.est_multiple&&this._phrase.fonctions_multiples_nombre(t)===this.fonction_courante.numero){if(i.length===0)return this;this.ajouter_fonction_tracee(e+1,this.fonction_courante.nom_de_base,t,n,this.fonction_courante.numero+1)}n.declareFonction(t,i,this.fonction_courante.numero);const l=this.valide_fonction(i.length>0);return this.gere_groupe_enchasse(l,i,this.fonction_courante),this},I=()=>{const i="phrase.v0.4.0.json",l=new Blob([JSON.stringify(E()._phrase)],{type:"text/json"}),c=document.createElement("a");c.download=i,c.href=window.URL.createObjectURL(l),c.dataset.downloadurl=["text/json",c.download,c.href].join(":");const a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});c.dispatchEvent(a),c.remove(),D()},w.fonction_de_validation=()=>{E(),this.analyse_de_fonction(e+1)}}};let j=O;u(j,"liste_des_fonctions_niveau_1",{Indépendante:"independante",Sujet:"sujet",Verbes:"verbes",Noyau:"noyau","Verbe principal":"verbe_principal","Groupe verbal":"groupe_verbal","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"}),u(j,"liste_des_fonctions_niveau_2",{COD:"cod",COI:"coi","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément du verbe impersonnel":"complement_du_verbe_impersonnel",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition","Complément de l'adjectif":"complement_de_l_adjectif"});function D(){for(const n of M(document.getElementsByClassName("modal")))n.style.display="none";const s=r("modal-nouvelle-phrase");s.style.display="block",r("nouvelle_phrase-texterea").focus(),r("conseil").innerHTML="Sélectionnez chaque fonction comme si vous étiez vous-même l'élève. Cliquez sur valider quand vous avez terminé votre sélection. Valider dans rien sélectionner indique que cette fonction est absente de la phrase. Vous pouvez toujours corriger une éventuelle erreur en sélectionnant une fonction dans la liste déroulante.";const e=r("bouton-valider");e.style.width="50%",e.innerHTML="Valider la fonction";const t=r("bouton-valider-phrase");t.style.display="block",J=()=>{let n=r("nouvelle_phrase-texterea").value;if(n.trim()==="")return;let o=new j(n);s.style.display="none",o.analyse_de_fonction(0),G=i=>{const l=i.target;E();const c=()=>{let a=l.getAttribute("pos");return typeof a=="string"?parseInt(a):(m(!1,"la valeur de l'attribut est nulle."),-1)};o.analyse_de_fonction(c())}}}function ye(){r("conseil").innerHTML="";const s=r("bouton-valider");s.style.width="100%",s.innerHTML="Valider";const e=r("bouton-valider-phrase");e.style.display="none",r("nouvelle_phrase-fonctions-selection").innerHTML=""}const je=[{phrase:"Le chat mange la souris.",verbes:[2],_fonctions_uniques:{verbe_principal:[2],sujet:[0,1],cod:[3,4],groupe_verbal:[2,3,4]}},{phrase:"Marie donne du lait au chat.",verbes:[1],_fonctions_uniques:{verbe_principal:[1],sujet:[0],cod:[2,3],coi:[4,5],groupe_verbal:[1,2,3,4,5]}},{phrase:"Un véritable amant ne connaît point d'amis.",verbes:[4],_fonctions_uniques:{verbe_principal:[4],sujet:[0,1,2],coi:[6,7],groupe_verbal:[3,4,5,6,7]}},{phrase:"L'amour rend tout permis.",verbes:[2],_fonctions_uniques:{verbe_principal:[2],sujet:[0,1],cod:[3],attribut_du_cod:[4],groupe_verbal:[2,3,4]}},{phrase:"Vous êtes son rival ?",verbes:[1],_fonctions_uniques:{verbe_principal:[1],sujet:[0],attribut_du_sujet:[2,3],groupe_verbal:[1,2,3]}},{phrase:"Il est adoré d'elle.",verbes:[1,2],_fonctions_uniques:{verbe_principal:[1,2],sujet:[0],complément_d_agent:[3,4],groupe_verbal:[1,2,3,4]}}],Ce=je.map(s=>b.fromJSON(s));function Le(s,e=0){return Ce.slice(e,e+s)}const x=[["verbes","Sélectionne les verbes."],["independante","Sélectionne une indépendante"],["verbe_principal","Sélectionne le verbe principal"],["groupe_verbal","Sélectionne le groupe verbal"],["sujet","Sélectionne le groupe sujet"],["cod","Sélectionne le Complément d'objet direct (COD)."],["coi","Sélectionne le Complément d'objet indirect (COI)."],["attribut_du_sujet","Sélectionne l'attribut du sujet."],["attribut_du_cod","Sélectionne l'attribut du COD."],["complement_d_agent","Sélectionne le complément d'agent"],["complement_circonstanciel","Sélectionne un complément circonstanciel"],["complement_du_verbe_impersonnel","Sélectionne le complément du verbe impersonnel"],["complement_du_nom","Sélectionne un complément du nom"],["complement_du_pronom","Sélectionne un complément du pronom"],["epithete","Sélectionne une épithète"],["apposition","Sélectionne une apposition"],["complement_de_l_adjectif","Sélectionne un complément de l'adjectif"],["modalisateur","Sélectionne un modalisateur"],["auto-enonciative","Sélectionne une fonction auto-énonciative"],["connecteur","Sélectionne un connecteur"],["balise_textuelle","Sélectionne une balise textuelle"]];function z(s){let e=new f(s.contenu,s);F(0,e,e,[])}function F(s,e,t,n,o=-1){const i=x[s][0];f.Fonctions_multiples.includes(i)&&o===-1&&(o=0);const l=x[s][1]+(o>=0?` (${o+1})`:"");function c(){if(s===x.length-1){let a=e.corrige.groupes_enchasses();n.push(a);for(let d=n.length-1;d>=0;d--){let g=n[d].next();if(g.done===!1){const[[L,Q],W]=g.value;return F(0,e.cree_groupe_enchasse_eleve(W,L,Q),t,n)}else n.pop()}return Ee()}else{const a=f.Fonctions_multiples.includes(i)&&!e.est_complet(i)?0:1;return o=a===0?o+1:-1,F(s+a,e,t,n,o)}}if(!e.corrige.aFonction(i))return c();r("consigne-container").innerHTML=`${l}`,r("phrase-analyse-paragraphe").innerHTML=P(t,t.mots_pos),T(r("phrase-analyse-paragraphe")),w.fonction_de_validation=()=>{const a=Array.from(document.getElementsByClassName("phrase-selectionne")).map(g=>Number(g.id.split("-")[2]));if(a.length===0?!e.corrige.aFonction(i):e.declare(i,a,o))c();else{const g=r("modal-message-contenu");g.classList.add("modal-message-erreur"),v("Il y a une erreur dans ton analyse !","Reprendre l'analyse",()=>{F(s,e,t,n,o),g.classList.remove("modal-message-erreur"),Array.from(document.getElementsByClassName("phrase-cliquable")).forEach(L=>{a.includes(Number(L.id.split("-")[2]))&&L.classList.add("phrase-selectionne")})})}}}function v(s,e,t){const n=r("modal-message"),o=r("modal-message-contenu-texte"),i=r("modal-message-bouton");o.innerHTML=s,i.innerHTML=e,n.style.display="block",R=()=>{N(r("modal-message-contenu"),n),t()}}function Ee(){v("Bravo !","Commencer une autre analyse",K)}function K(){const s=r("modal-choix-phrase");s.style.display="block";const e=Le(5,0),t=r("modal-choix-phrase-liste");t.innerHTML="";for(let n in e){const o=e[n],i=Z(t,"li",{id:`modal-choix-phrase-liste-${n}`});i.innerHTML=o.contenu,i.addEventListener("click",()=>{z(e[n]),N(r("modal-choix-phrase-contenu"),s)})}}let q=!1;const k=r("phrase-analyse-paragraphe");k.addEventListener("mousedown",s=>{const e=s.target;s.button!=0||!e.classList.contains("phrase-cliquable")||(q=!0,e.classList.toggle("phrase-selectionne"))});k.addEventListener("mouseover",s=>{const e=s.target;q&&e.classList.contains("phrase-cliquable")&&e.classList.toggle("phrase-selectionne")});k.addEventListener("mouseup",s=>{q=!1});r("bouton-valider").addEventListener("click",()=>{w.fonction_de_validation()});document.onkeyup=function(s){s.which===13&&w.fonction_de_validation()};let R=()=>console.log("Problème: aucune fonction définie pour le bouton du message");r("modal-message-bouton").addEventListener("click",()=>{R()});r("nouvelle_phrase").addEventListener("click",()=>{D()});r("analyse_fichier").addEventListener("click",()=>{for(const s of M(document.getElementsByClassName("modal")))s.style.display="none";ye(),r("modal-analyse-fichier").style.display="block"});function Fe(){if((()=>{var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window})()){const e=r("analyse_fichier_input_form");e.classList.add("has-advanced-upload"),r("analyse_fichier_bouton").style.display="none","drag dragstart dragend dragover dragenter dragleave drop".split(" ").forEach(t=>{e.addEventListener(t,n=>{n.preventDefault(),n.stopPropagation()})}),["dragover","dragenter"].forEach(t=>{e.addEventListener(t,()=>e.classList.add("is-dragover"))}),["dragleave","dragend","drop"].forEach(t=>{e.addEventListener(t,()=>e.classList.remove("is-dragover"))})}else r("analyse_fichier_input").classList.remove("box__file")}function U(s){const e=new FileReader,t=()=>{N(r("modal-analyse-fichier-contenu"),r("modal-analyse-fichier"))};if(s.length==0)return t(),v("Pas de fichier chargé.","OK",()=>{});const n=s[0];if(!(n.type?n.type:"Introuvable").includes("json"))return t(),v("Format invalide","OK",()=>{});e.addEventListener("load",o=>{const i=e.result??"";if(typeof i!="string"||i==="")return t(),v("Fichier invalide","OK",()=>{});try{z(b.fromJSON(i))}catch(l){return console.log(l),t(),l instanceof TypeError?v("Ce fichier n'est pas compatible avec la version actuelle du programme.","OK",()=>{}):v("Fichier invalide","OK",()=>{})}t()}),e.readAsText(n)}r("analyse_fichier_input").addEventListener("change",s=>{const e=s.target;U(e.files)});r("analyse_fichier_input_form").addEventListener("drop",s=>{var e;U((e=s.dataTransfer)==null?void 0:e.files)});ve();K();Fe();
