var St=Object.defineProperty;var Mt=(o,e,t)=>e in o?St(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var r=(o,e,t)=>(Mt(o,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const At=document.createElement("canvas");function G(o,e){let t=o.length;if(t!=e.length)return!1;for(;t--;)if(o[t]!==e[t])return!1;return!0}function ne(o){if(o===null)throw TypeError("elt is null");return o}function kt(o,e,t={}){let n=document.createElement(e);return o.appendChild(n),Object.entries(t).forEach(([i,s])=>n.setAttribute(i,s)),n}function K(o,e){o.classList.add("modal-contenu-animation-disparition");const t=()=>{e.style.display="none",o.classList.remove("modal-contenu-animation-disparition"),o.removeEventListener("animationend",t)};o.addEventListener("animationend",t)}function u(o){return ne(document.getElementById(o))}function C(o,e){if(o===!1)throw Error(e)}function Tt(o,e){let t=ne(At.getContext("2d"));t.font=e;let n=t.measureText(o);return Math.ceil(n.width)}function Ft(o){return o.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function he(o,e){if(o.slice(-1)!=="e")throw Error(`${o} ne finit pas par un e`);const t="aeiouy",n=Ft(e).slice(0,1).toLowerCase();return t.indexOf(n)===-1?o+" "+e:o.slice(0,-1)+"'"+e}const L=class L{constructor(e,t=[]){r(this,"_denomination",["phrase",-1]);r(this,"_parent",null);r(this,"_phrase_cassee",[]);r(this,"verbes",[]);r(this,"_mots_offset",[]);r(this,"_fonctions_uniques",{});r(this,"_fonctions_multiples",{});r(this,"_groupes_enchasses",new Map);r(this,"_manipulations",{});r(this,"_fonction_enchassee",(e,t)=>[e,t[0],t.slice(-1)[0]]);this.phrase=e,this._mots_pos=t,this.phrase=e,this._casseSyntagme(),this._mots_pos=G(t,[])?[...Array(this._phrase_cassee.length).keys()]:t,this._remplit_mots_offset()}get ancetre(){if(this._denomination[0]==="phrase")return this;if(this._parent===null)throw C(this._parent!==null,"Pas de parent enregistré"),Error;return this._parent.ancetre}get contenu(){return this.phrase}get arbre_genealogique(){if(this._parent===null)return[this._denomination];let e=this._parent.arbre_genealogique;return e.push(this._denomination),e}get mots_sans_fonction(){return this._mots_pos.filter(e=>this.fonction(e).length===0)}get mots_pos(){return this._mots_pos}set contenu(e){this.phrase=e}_remplit_mots_offset(){let e=new RegExp(L.Separateur,"g");const t=[];let n=0,i;for(;(i=e.exec(this.contenu))!==null;)i.index>n&&t.push([n,i.index]),n=i.index+i[0].length;return n<this.contenu.length&&t.push([n,this.contenu.length]),this._mots_offset=t,t}offset_pos(e){let t=[];for(let n=0,i=0,s=0,a=-1;n<this._mots_offset.length;n++)e.includes(n)?(a===n-1?(s=this._mots_offset[n][1],n===this._mots_offset.length-1&&t.push([i,s])):([i,s]=this._mots_offset[n],n===this._mots_offset.length-1&&t.push([i,s])),a=n):s>0&&a===n-1&&t.push([i,s]);return t}texte_pos(e){let t="";for(let n=0,i=0,s=0,a=-1;n<this._mots_offset.length;n++)e.includes(n)?(a===n-1?(s=this._mots_offset[n][1],n===this._mots_offset.length-1&&(t+=this.contenu.slice(i,s))):([i,s]=this._mots_offset[n],t.length>0&&(t+=" "),n===this._mots_offset.length-1&&(t+=this.contenu.slice(i,s))),a=n):s>0&&a===n-1&&(t+=this.contenu.slice(i,s));return t}fonction_texte_pos(e,t=-1){return this.texte_pos(this.fonctionPos(e,t))}get phraseCassee(){return this._phrase_cassee}get longueur(){return this._phrase_cassee.length}static get separateur(){return this._separateur}_remplit_les_vides(){typeof this._fonctions_uniques>"u"&&(this._fonctions_uniques={}),typeof this._fonctions_multiples>"u"&&(this._fonctions_multiples={}),typeof this._groupes_enchasses>"u"&&(this._groupes_enchasses=new Map)}get vide(){for(const[,e]of this._groupes_enchasses)if(!e.vide)return!1;return Object.keys(this._fonctions_uniques).length===0&&Object.keys(this._fonctions_multiples).length===0}ajoute_infos_de_manipulation(e,t){this._manipulations[e]=t}infos_de_manipulation(e){return C(e in this._manipulations,`${e} n'est pas enregistré dans les données de manipulation`),this._manipulations[e]}get est_attributif(){return"sujet"in this._fonctions_uniques&&"attribut_du_sujet"in this._fonctions_uniques}cree_groupe_enchasse(e,t,n){const i=new L(this.contenu,e);return this._groupes_enchasses.set([t,n],i),i._denomination=[t,n],i._parent=this,i}get groupes_enchasses_nombre(){return this._groupes_enchasses.size}groupe_enchasse(e,t){let n;for(const[i,s]of this._groupes_enchasses)i[0]===e&&i[1]===t&&(n=s);if(typeof n>"u")throw Error(`Pas de groupe avec la fonction ${e} et le numéro ${t}`);return n}supprime_groupe_enchasse(e,t){for(const[n]of this._groupes_enchasses)if(n[0]===e&&n[1]===t)return this._groupes_enchasses.delete(n);return!1}fonctions_multiples_nombre(e){const t=this._fonctions_multiples;return e in t?t[e].length:0}get copie(){let e=new L(this.contenu,this._mots_pos);return Object.entries(this._fonctions_uniques).forEach(([t,n])=>{n.length>0&&(e._fonctions_uniques[t]=n)}),Object.entries(this._fonctions_multiples).forEach(([t,n])=>{let i=[];n.length>0&&(i=n.filter(s=>s.length>0)),i.length>0&&(e._fonctions_multiples[t]=i)}),e._groupes_enchasses=new Map([...this._groupes_enchasses.entries()].filter(t=>!t[1].vide).map(t=>[t[0],t[1].copie])),e._manipulations=this._manipulations,e.verbes=this.verbes,e}toJSON(){let e=Object.assign(this.copie);return e._groupes_enchasses=Array.from(this._groupes_enchasses.entries()),e}get profondeur(){return this._groupes_enchasses.size===0?0:Math.max(...[...this._groupes_enchasses.entries()].map(([e,t])=>t.profondeur))+1}fonction(e){let t=[];this.verbes.includes(e)&&t.push("verbes");for(const n in this._fonctions_uniques)this._fonctions_uniques[n].includes(e)&&t.push(n);for(const n in this._fonctions_multiples)for(const i of this._fonctions_multiples[n])if(i.includes(e)){t.push(n);break}for(const[,n]of this._groupes_enchasses){const i=n.fonction(e);i&&t.push(...i)}return t}fonction_detaillee(e){let t=[];this.verbes.includes(e)&&t.push(this._fonction_enchassee("verbes",this.verbes));for(const i in this._fonctions_uniques)this._fonctions_uniques[i].includes(e)&&t.push(this._fonction_enchassee(i,this._fonctions_uniques[i]));const n=this._fonctions_multiples;for(const i in n)for(const s of n[i])s.includes(e)&&t.push(this._fonction_enchassee(i,s));for(const[,i]of this._groupes_enchasses)t.push(...i.fonction_detaillee(e));return t.sort((i,s)=>i[2]-i[1]>s[2]-s[1]?-1:1)}fonctionPos(e,t=-1){return t>=0&&C(L.Fonctions_multiples.includes(e),`fonctionPos:  ${e} n'est pas une fonction multiple`),e=="verbes"?this.verbes:L.Fonctions_multiples.includes(e)?(C(t>-1,`fonctionPos: numero_de_fonction doit être supérieur à -1 pour les fonctions multiples comme ${e}`),!(e in this._fonctions_multiples)||t>=this._fonctions_multiples[e].length?[]:this._fonctions_multiples[e][t]):e in this._fonctions_uniques?this._fonctions_uniques[e]:[]}declareFonction(e,t,n=-1){if(C(this.mots_valides(t),`declareFonction: ${t} ne correspond pas à une liste de mots valides.`),t=t.sort((i,s)=>i-s),e==="verbes"){this.verbes=t;return}if(L.Fonctions_multiples.includes(e)){let i=this._fonctions_multiples;e in i||(C(n<=0,`declareFonction: ${n} introuvable pour ${e}`),i[e]=[]),n===-1||n===i[e].length?i[e].push(t):(C(n<i[e].length,`declareFonction: ${n} introuvable pour ${e}`),i[e][n]=t)}else this._fonctions_uniques[e]=t}fonctionMots(e,t=-1){return t>=0&&(C(L.Fonctions_multiples.includes(e),`fonctionMots: ${e} n'est pas une fonction multiple`),C(e in this._fonctions_multiples,`fonctionMots: ${e} n'a pas été créé.`),C(t<this._fonctions_multiples[e].length,`fonctionMots: ${t} introuvable pour ${e}`)),this.fonctionPos(e,t).map(n=>this._phrase_cassee[n]).join(" ")}mots_valides(e){if(e.length>0){for(const t of e)if(!this._mots_pos.includes(t))return!1}return!0}_casseSyntagme(){this._phrase_cassee=this.phrase.split(L._separateur).filter(e=>e)}*groupes_enchasses(){for(let e of this._groupes_enchasses)yield e}};r(L,"Separateur","[ ,;:?!.'-]"),r(L,"_separateur",new RegExp(L.Separateur)),r(L,"Fonctions_multiples",["independante","complement_circonstanciel","modalisateur","auto-enonciative","connecteur","balise_textuelle","epithete","complement_du_nom","complement_du_pronom","complement_de_l_adjectif","apposition"]),r(L,"Fonctions_contenants",["independante","sujet","cod","coi","attribut_du_sujet","attribut_du_cod","complement_circonstanciel","complement_du_verbe_impersonnel","complement_du_nom","complement_du_pronom","epithete","apposition","complement_de_l_adjectif"]);let D=L;class F extends D{constructor(e,t=[]){super(e,t)}static reviver(e,t){return e===""?F.fromJSON(t):t}static fromJSON(e){if(typeof e=="string")return JSON.parse(e,F.reviver);{let t=Object.create(F.prototype);const n=typeof e._groupes_enchasses>"u"?new Map:new Map(Object.entries(e._groupes_enchasses).map(s=>[s[1][0],F.fromJSON(s[1][1])]));let i=Object.assign(t,e,{_groupes_enchasses:n});return i._remplit_les_vides(),i}}cree_groupe_enchasse(e,t,n){const i=new F(this.contenu,e);return this._groupes_enchasses.set([t,n],i),i._denomination=[t,n],i._parent=this,i}groupe_enchasse(e,t){return super.groupe_enchasse(e,t)}aFonction(e){if(D.Fonctions_multiples.includes(e))return e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>!G(n,[])).length>0:!1;const t=this.fonctionPos(e);return!G(t,[])}aFonctions(e){for(let t of e)if(!this.aFonction(t))return!1;return!0}estFonction(e,t){return t=t.sort((n,i)=>n-i),D.Fonctions_multiples.includes(e)?e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>G(n,t)).length>0:!1:G(this.fonctionPos(e),t)}*groupes_enchasses(){for(let e of this._groupes_enchasses)yield e}}class T extends D{constructor(e,t){super(e,t.mots_pos),this._corrige=t,this._corrige=t}cree_groupe_enchasse_eleve(e,t,n){const i=new T(this.contenu,e);return this._groupes_enchasses.set([t,n],i),i._denomination=[t,n],i._parent=this,i}get corrige(){return this._corrige}est_complet(e){const t=this.corrige.fonctions_multiples_nombre(e);if(t!==this.fonctions_multiples_nombre(e))return!1;const n=this._fonctions_multiples[e];for(let i=0;i<t;i++){const s=this.corrige.fonctionPos(e,i);if(n.filter(p=>G(p,s)).length===0)return!1}return!0}est_correct(e,t=-1){return D.Fonctions_multiples.includes(e)?(C(e in this._fonctions_multiples,`${e} n'a jamais été enregistré dans ce syntagme`),C(t<this._fonctions_multiples[e].length,`Pas de numero ${t} pour la fonction ${e} dans ce syntagme`),this.corrige.estFonction(e,this._fonctions_multiples[e][t])):e==="verbes"?this.corrige.estFonction(e,this.verbes):(C(e in this._fonctions_uniques,`${e} n'a pas été enregistré dans ce syntagme`),this.corrige.estFonction(e,this._fonctions_uniques[e]))}declare(e,t,n=-1){return D.Fonctions_multiples.includes(e)&&e in this._fonctions_multiples&&this._fonctions_multiples[e].filter(i=>G(i,t)).length!==0?!1:(this.declareFonction(e,t,n),this.corrige.estFonction(e,t))}}Array();let j={fonction_de_validation:()=>{console.log("Problème: la fonction de validation n'a pas été mise en place")},ok:()=>{console.log("Aucune fonction définie pour OK")},annuler:()=>{console.log("Aucune fonction définie pour Annuler")},fonction_du_bouton_de_message:()=>console.log("Fonction du bouton de message non mise en place")};const Qe={Indépendante:"independante",Verbes:"verbes","Verbe noyau":"verbe_noyau",Sujet:"sujet",COD:"cod",COI:"coi","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Complément d'agent":"complement_d_agent","Groupe verbal":"groupe_verbal","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Noyau:"noyau",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition","Complément de l'adjectif":"complement_de_l_adjectif"},Dt=Object.fromEntries(Object.entries(Qe).map(o=>o.reverse()));function V(o,e,t,n=!1){const i=u("modal-message"),s=u("modal-message-contenu-texte"),a=u("modal-message-bouton"),p=u("modal-croix");s.innerHTML=o,a.innerHTML=e,i.style.display="block",n&&(p.style.display="block"),j.fonction_du_bouton_de_message=()=>{K(u("modal-message-contenu"),i),n&&(p.style.display="none"),t()},j.ok=j.fonction_du_bouton_de_message}function Ue(o,e){return["sujet","groupe_verbal"].includes(o)?e?"[":"]":""}function Pt(o,e){if(e==o[1]||o[0]==="verbes"){const t=Ue(o[0],!0),n=Dt[o[0]];return`${t}<span groupe class="groupe-de-mots phrase-${o[0]}"><span class="affichage-nom-fonction affichage-${o[0]}">${n}</span>`}return""}function Nt(o,e){return e==o[2]||o[0]==="verbes"?`</span>${Ue(o[0],!1)}`:""}function ge(o,e=[]){const t=o.ancetre,n=new RegExp("("+T.Separateur+")"),i=t.contenu.split(n);let s=0,a=[];for(const p of i){if(T.Separateur.includes(p)){a.push(p);continue}const c=t.fonction_detaillee(s);c.forEach(h=>a.push(Pt(h,s)));const d=e.includes(s)?'class="phrase-cliquable"':'class="phrase-non-cliquable"';a.push(`<span ${d} id="phrase-mot-${s}">${p}</span>`),c.forEach(h=>a.push(Nt(h,s))),s+=1}return a.join("")}function be(o){const e=et(o);o.style.lineHeight=`${1.8+e/10}`,tt(o,e),Ze(o)}function Ze(o){for(let e=0;e<o.children.length;e++){let t=o.children[e];if(t.hasAttribute("groupe")){const n=ne(t.querySelector(".affichage-nom-fonction")),i=window.getComputedStyle(n).font,s=Tt(n.innerText,i);let a=parseInt(window.getComputedStyle(t).borderWidth);a===0&&(a=parseInt(window.getComputedStyle(t).borderLeftWidth));const p=s+a*2-t.offsetWidth;t.style.paddingRight=`${p}px`;const c=n.innerText==="Indépendante"?68:74,d=parseInt(t.style.paddingBottom),h=n.innerText==="Indépendante"?23:28;n.style.top=`${c+d-h}px`,Ze(t)}}}function et(o){let e=1;for(let t=0;t<o.children.length;t++){let n=o.children[t];n.hasAttribute("groupe")&&(e=Math.max(e,et(n)+1))}return e}function tt(o,e){for(let t=0;t<o.children.length;t++){let n=o.children[t];n.hasAttribute("groupe")&&(n.style.padding=`0px 0px ${e*10}px`,tt(n,e-1))}}function Ne(o,e){const t=e.arbre_genealogique;if(t.length===1)return o;const n={independante:"l'indépendante",verbes:"Verbes",verbe_noyau:"Verbe noyau",sujet:"le sujet",cod:"le COD",coi:"le COI",attribut_du_sujet:"l'attribut du sujet",attribut_du_cod:"l'attribut du COD",complement_du_verbe_impersonnel:"le complément du verbe impersonnel",complement_d_agent:"le complément d'agent",groupe_verbal:"le groupe verbal",complement_circonstanciel:"le complément circonstanciel",modalisateur:"le modalisateur","auto-enonciative":"la fonction auto-énonciative",connecteur:"le connecteur",balise_textuelle:"la balise textuelle",noyau:"Noyau",epithete:"l'épithète",complement_du_nom:"le complément du nom",complement_du_pronom:"le complément du pronom",apposition:"l'apposition",complement_de_l_adjectif:"le complément de l'adjectif"};return t.slice(1).map(i=>"Dans "+(i[1]===-1?n[i[0]]:`${n[i[0]]} numéro ${i[1]+1}`)).join(" > ")+" : "+o}const It={Sujet:"sujet","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},Bt={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},zt={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},Ht={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},Rt={"Complément de l'adjectif":"complement_de_l_adjectif",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},Vt={"Complément de l'adjectif":"complement_de_l_adjectif",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},Gt={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},Wt={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},Xt={Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},Yt={"Complément de l'adjectif":"complement_de_l_adjectif",Noyau:"noyau"},Kt={Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},Jt={Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},Qt={"Complément de l'adjectif":"complement_de_l_adjectif",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},Ut={Noyau:"noyau",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},Zt={independante:It,sujet:Bt,cod:zt,coi:Ht,attribut_du_sujet:Rt,attribut_du_cod:Vt,complement_d_agent:Gt,complement_circonstanciel:Wt,complement_du_verbe_impersonnel:Xt,epithete:Yt,complement_du_nom:Kt,complement_du_pronom:Jt,apposition:Qt,complement_de_l_adjectif:Ut};let ye=()=>console.log("Problème: aucune fonction définie pour le bouton OK de la nouvelle phrase"),nt=()=>console.log("Problème: aucune fonction définie pour la validation de la nouvelle phrase"),ot=o=>console.log("Aucune fonction définie pour le sélecteur"),ae=()=>(console.log("Problème: enregistre_fonction n'a pas été instancié"),new re("vide")),H=()=>console.log("Problème: aucune fonction définie pour le bouton OK des ajouts de manipulations");function en(){u("modal-nouvelle_phrase-bouton").addEventListener("click",()=>{ye()}),u("bouton-valider-phrase").addEventListener("click",()=>{nt()}),u("nouvelle_phrase-fonctions-selection").addEventListener("click",o=>{ot(o)}),u("ajout-manipulations-form").addEventListener("submit",o=>{o.preventDefault(),H()})}class tn{constructor(e,t,n,i,s=-1,a){r(this,"validee",!1);r(this,"est_multiple",!1);this.nom_de_base=e,this.fonction=t,this.html_node=n,this.syntagme=i,this.numero=s,this.parent=a,this.est_multiple=s>-1}get nom(){return this.numero>-1?`${this.nom_de_base}-${this.numero+1}`:this.nom_de_base}get arbre_genealogique(){return typeof this.parent>"u"?this.nom:`${this.parent.arbre_genealogique} > ${this.nom}`}get id_sous_menu(){const e=this.numero===-1?"":`-${this.numero}`,t=`${this.fonction}${e}`;return typeof this.parent>"u"?t:`${this.parent.id_sous_menu}-${t}`}}class re{constructor(e){r(this,"_phrase");r(this,"_traceur",[]);r(this,"_pos",0);r(this,"_selecteur",u("nouvelle_phrase-fonctions-selection"));this._phrase=new T(e,new F(e)),this._selecteur.innerHTML="",Object.entries(Qe).forEach(t=>this.ajouter_fonction_tracee(this._traceur.length,t[0],t[1])),this._selecteur.style.display="block"}static contenus_possibles(e){return Zt[e]}set pos(e){this.fonction_courante.html_node.classList.remove("selectionne"),C(e<this._traceur.length,`${e} est plus grand que la longueur du traceur: ${this._traceur.length}.`),this._pos=e,this.fonction_courante.html_node.classList.add("selectionne")}get pos(){return this._pos}get fonction_courante(){return this._traceur[this._pos]}set_pos_selecteur(e,t){for(let n of e.children)n.classList.contains("selecteur")||n.classList.contains("sous_menu")?t=this.set_pos_selecteur(n,t):(n.setAttribute("pos",t.toString()),t+=1);return t}ajouter_node_selecteur(e,t,n,i){for(let s of e.children)if(s.classList.contains("sous_menu")){if(n=this.ajouter_node_selecteur(s.children[1],t,n+1,i),n>i)return n}else{if(n===i&&s.insertAdjacentElement("beforebegin",t),n>i)return n;n+=1}return n===i?(e.appendChild(t),n+1):n}ajouter_fonction_tracee(e,t,n,i=this._phrase,s=-1,a){T.Fonctions_multiples.includes(n)&&s===-1&&(s=0),C(e<=this._traceur.length,`${e} est plus grand que la longueur du traceur`);let p=document.createElement("div");const c=new tn(t,n,p,i,s,a);this._traceur.splice(e,0,c),p.setAttribute("value",c.fonction),p.setAttribute("class","selecteur-element"),p.innerHTML=c.nom,this.ajouter_node_selecteur(this._selecteur,p,0,e),this.set_pos_selecteur(this._selecteur,0)}retirer_enfants(e,t,n=!1){for(const[i,s]of this._traceur.entries())s.parent===e&&(t=this.retirer_enfants(s,t,!1),s.html_node.remove(),t.push(i));return n&&(this._traceur=this._traceur.filter((i,s)=>!t.includes(s)),this.set_pos_selecteur(this._selecteur,0)),t}gere_groupe_enchasse(e,t,n){if(!T.Fonctions_contenants.includes(this.fonction_courante.fonction))return;if(!e){if(n.syntagme.supprime_groupe_enchasse(n.fonction,n.numero)){const c=u(`sous_menu-${n.id_sous_menu}`);c.insertAdjacentElement("beforebegin",n.html_node),this.retirer_enfants(n,[],!0),c.remove()}return}let i=n.syntagme.cree_groupe_enchasse(t,n.fonction,n.numero),s=document.createElement("div");s.setAttribute("class","sous_menu"),s.setAttribute("id",`sous_menu-${n.id_sous_menu}`),this.fonction_courante.html_node.insertAdjacentElement("beforebegin",s),s.insertAdjacentElement("afterbegin",this.fonction_courante.html_node);let a=document.createElement("div");a.setAttribute("class","selecteur sous_menu_contenu"),this.fonction_courante.html_node.insertAdjacentElement("afterend",a);let p=this._pos+1;Object.entries(re.contenus_possibles(this.fonction_courante.fonction)).forEach(c=>{this.ajouter_fonction_tracee(p,c[0],c[1],i,-1,n),p+=1}),s.addEventListener("mouseenter",()=>{a.style.display="block"}),s.addEventListener("mouseleave",()=>{a.style.display="none"})}valide_fonction(e){const t=this.fonction_courante;return t.validee=e,e?t.html_node.classList.add("valide"):t.html_node.classList.remove("valide"),e}analyse_de_fonction(e=-1){e===-1?e=this._pos:this.pos=e;const t=this.fonction_courante.fonction,n=this.fonction_courante.syntagme,i=()=>{const a={groupe_verbal:"verbes verbe_noyau cod coi attribut_du_sujet attribut_du_cod complement_du_verbe_impersonnel".split(" "),verbes:"verbe_noyau groupe_verbal".split(" "),verbe_noyau:"verbes groupe_verbal".split(" "),cod:["groupe_verbal","verbes"],coi:["groupe_verbal","verbes"],attribut_du_sujet:["groupe_verbal","verbes"],attribut_du_cod:["groupe_verbal","verbes"],complement_du_verbe_impersonnel:["groupe_verbal","verbes"]};return t in a?a[t].map(p=>n.fonctionPos(p)).flat().concat(n.mots_sans_fonction).concat(n.fonctionPos(t,this.fonction_courante.numero)):(console.debug("Intégration des mots sans fonction et de la fonction courante dans les mots qu'on peut sélectionner",t),n.mots_sans_fonction.concat(n.fonctionPos(t,this.fonction_courante.numero)).concat(n.fonctionPos("verbes")))};u("phrase-analyse-paragraphe").innerHTML=ge(this._phrase,i()),be(u("phrase-analyse-paragraphe")),u("consigne-container").innerHTML=`À renseigner : ${this.fonction_courante.arbre_genealogique}`;const s=n.fonctionPos(t,this.fonction_courante.numero);Array.from(document.getElementsByClassName("phrase-cliquable")).forEach(a=>{s.includes(Number(a.id.split("-")[2]))&&a.classList.add("phrase-selectionne")}),ae=()=>{const a=Array.from(document.getElementsByClassName("phrase-selectionne")).map(c=>Number(c.id.split("-")[2]));if(this.fonction_courante.est_multiple&&this._phrase.fonctions_multiples_nombre(t)===this.fonction_courante.numero){if(a.length===0)return this;this.ajouter_fonction_tracee(e+1,this.fonction_courante.nom_de_base,t,n,this.fonction_courante.numero+1)}n.declareFonction(t,a,this.fonction_courante.numero);const p=this.valide_fonction(a.length>0);return this.gere_groupe_enchasse(p,a,this.fonction_courante),this.elements_de_manipulation(p),this},nt=async()=>{let a=this._phrase.contenu.replaceAll(" ","_").replace(D.separateur,"").toLowerCase();a=a.length>40?a.slice(0,37)+"...":a;const p=`${a}.v0.10.3.json`;await this.verification_verbes_sans_sujet(this._phrase);const c=new Blob([JSON.stringify(ae()._phrase)],{type:"text/json"}),d=document.createElement("a");d.download=p,d.href=window.URL.createObjectURL(c),d.dataset.downloadurl=["text/json",d.download,d.href].join(":");const h=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});d.dispatchEvent(h),d.remove(),it()},j.fonction_de_validation=()=>{ae(),this.analyse_de_fonction(e+1)},j.ok=j.fonction_de_validation}manipulation_titre(e){let t;switch(this.fonction_courante.fonction){case"sujet":t="sujet";break;case"cod":t="COD";break;case"groupe_verbal":t="Groupe Verbal";break;case"coi":t="COI";break;default:throw this.fonction_courante.fonction}return u("modal-ajout-manipulations-titre").innerHTML=`Renseignements nécessaires à la manipulation du ${t} : ${e}`,t}cree_fieldset(e,t){return`<fieldset class="ajout-manipulations-cadre">
                    <legend class="ajout-manipulations-cadre-titre">${e}</legend>
                    <div class="ajout-manipulations-cadre-contenu">${t}</div>
                </fieldset>`}cree_select(e,t,n){const i=t.split(",").map(a=>`<option name=${n} value=${a.toLowerCase()}>${a}</option>`).join(" "),s=`<select name="ajout-manipulations-contenu-${n}" class="manipulation-select">
        ${i}</select>
        `;return this.cree_fieldset(e,s)}cree_liste_preposions_coi(e){const t=e.split(" ");let n="à,de,";return t.length>=1&&(n+=t[0]),t.length>=2&&(n+=`,${t[0]} ${t[1]}`),t.length>=3&&(n+=`,${t[0]} ${t[1]} ${t[2]}`),n}recupere_valeur_select(e){return Array.from(document.getElementsByName(e)).filter(t=>t.selected)[0].getAttribute("value")}elements_de_manipulation_verbes(e,t){u("modal-ajout-manipulations").style.display="block",u("modal-ajout-manipulations-titre").innerHTML=`Rentrer les informations nécessaires à la validation d'un verbe sans sujet: ${t}`,u("ajout-manipulations-form-contenu").innerHTML=this.cree_select("Sujet","tu,nous,vous,je,j',il,elle,ils,elles","manipulation-verbe-sans-sujet"),H=()=>{const n=this.recupere_valeur_select("manipulation-verbe-sans-sujet");e.ajoute_infos_de_manipulation("verbe_noyau",{pronominalisation:n}),console.log("manip inside",e.infos_de_manipulation("verbe_noyau")),u("modal-ajout-manipulations").style.display="none"},j.ok=H}async verification_verbes_sans_sujet(e){e.fonctionPos("verbe_noyau").length>0&&e.fonctionPos("sujet").length===0&&(this.elements_de_manipulation_verbes(e,e.fonctionMots("verbe_noyau")),await new Promise((n,i)=>{const s=H;H=()=>{s(),n()}}).then(()=>console.debug("Promise fulfilled")));for(let[t,n]of e.groupes_enchasses())await this.verification_verbes_sans_sujet(n)}elements_de_manipulation(e){if(e&&"sujet cod coi groupe_verbal".split(" ").includes(this.fonction_courante.fonction)){const t=Array.from(document.getElementsByClassName("phrase-selectionne")).map(s=>s.innerHTML).join(" "),n=this.manipulation_titre(t);u("modal-ajout-manipulations").style.display="block";let i=this.fonction_courante;if("sujet cod coi".split(" ").includes(this.fonction_courante.fonction)){let s;switch(n){case"sujet":s="je j' tu il elle nous vous ils elles ce cela c'";break;case"COD":s="me m' te t' le la l' nous vous les en";break;case"COI":s="me m' moi te t' toi elle lui nous vous leur en y";break;default:throw n}s=s.split(" ");const a=s.includes(t.toLowerCase())?`<input type="hidden" id="pronom-inutile" name="${n}-pronoms" value="null" checked="true">`:`<fieldset class="ajout-manipulations-cadre"><legend class="ajout-manipulations-cadre-titre">Par quoi le ${n} peut-il être pronominalisé ?</legend>`+s.map(c=>`<label class="ajout-manipulations-label" for="pronom-${c}">${c}<input type="radio" class="pronoms" id="pronom-${c}" name="${n}-pronoms" value="${c}" required><span class="ajout-manipulations-radio"></span></label class="ajout-manipulations-label">`).join(" ")+"</fieldset>",p=this.fonction_courante.fonction!=="coi"?"":this.cree_select("Par quelle préposition commence la question pour trouver le COI ?",this.cree_liste_preposions_coi(t),"manipulation-preposition-coi");u("ajout-manipulations-form-contenu").innerHTML=`<fieldset class="ajout-manipulations-cadre"><legend class="ajout-manipulations-cadre-titre">Animé ou non-animé ?</legend><label class="ajout-manipulations-label" for="est-anime">Le référent du ${n} est animé.<input type="radio" id="est-anime" value="true" name="${n}-anime" required><span class="ajout-manipulations-radio"></span></label class="ajout-manipulations-label"><label class="ajout-manipulations-label" for="est-non-anime">Le référent du ${n} est non animé.<input type="radio" id="est-non-anime" value="false" name="${n}-anime" required><span class="ajout-manipulations-radio"></span></label class="ajout-manipulations-label"></fieldset>`+p+a,H=()=>{const c=document.getElementsByName(`${n}-anime`)[0].checked;let d=Array.from(document.getElementsByName(`${n}-pronoms`)).filter(h=>h.checked)[0].getAttribute("value");d==="null"&&(d=null),i.syntagme.ajoute_infos_de_manipulation(i.fonction,(()=>i.fonction==="coi"?{est_anime:c,pronominalisation:d,preposition:this.recupere_valeur_select("manipulation-preposition-coi")}:{est_anime:c,pronominalisation:d})()),u("modal-ajout-manipulations").style.display="none"}}else i.fonction==="groupe_verbal"&&(u("ajout-manipulations-form-contenu").innerHTML=this.cree_select("Verbe pouvant remplacer le groupe verbal","fais,fait,faisons,faites,font","manipulation-verbe"),H=()=>{const s=this.recupere_valeur_select("manipulation-verbe");i.syntagme.ajoute_infos_de_manipulation("groupe_verbal",{verbe:s}),u("modal-ajout-manipulations").style.display="none"});j.ok=H}}}function it(){for(const n of ne(document.getElementsByClassName("modal")))n.style.display="none";const o=u("modal-nouvelle-phrase");o.style.display="block",u("nouvelle_phrase-texterea").focus();const e=u("bouton-valider");e.style.width="50%",e.innerHTML="Valider la fonction";const t=u("bouton-valider-phrase");t.style.display="block",ye=()=>{let n=u("nouvelle_phrase-texterea").value;if(n.trim()==="")return;n=n.replace(`
`,"");let i=new re(n);o.style.display="none",i.analyse_de_fonction(0),ot=s=>{const a=s.target;ae();const p=()=>{let c=a.getAttribute("pos");return typeof c=="string"?parseInt(c):(C(!1,"la valeur de l'attribut est nulle."),-1)};i.analyse_de_fonction(p()),Array.from(document.getElementsByClassName("sous_menu_contenu")).map(c=>c.style.display="none")}},j.ok=ye}function nn(){u("conseil").innerHTML="";const o=u("bouton-valider");o.style.width="100%",o.innerHTML="Valider";const e=u("bouton-valider-phrase");e.style.display="none",u("nouvelle_phrase-fonctions-selection").innerHTML=""}const on=[{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{verbe_noyau:[2],sujet:[0,1],attribut_du_sujet:[3,4,5]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[0,1]}],[["attribut_du_sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{noyau:[5]},_fonctions_multiples:{epithete:[[4]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[4]}]],_manipulations:{},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[3,4,5]}]],_manipulations:{sujet:{est_anime:!1,pronominalisation:"elle"}},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[0,1,2,3,4,5]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{coi:[1],cod:[2,3],verbe_noyau:[0]},_fonctions_multiples:{complement_circonstanciel:[[4]]},_groupes_enchasses:[[["coi",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[1]}],[["cod",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[2,3]}],[["complement_circonstanciel",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[4]}]],_manipulations:{coi:{est_anime:!0,pronominalisation:null,preposition:"à"},cod:{est_anime:!1,pronominalisation:"la"},verbe_noyau:{pronominalisation:"vous"}},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[0,1,2,3,4]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{independante:[[0,1,2,3,4],[6,7,8,9]]},_groupes_enchasses:[[["independante",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{sujet:[0,1,2,3],verbe_noyau:[4]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{noyau:[2]},_fonctions_multiples:{epithete:[[1],[3]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[1]}],[["epithete",1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[3]}]],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[0,1,2,3]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"}},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[0,1,2,3,4]}],[["independante",1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{sujet:[6,7,8],verbe_noyau:[9]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{noyau:[8]},_fonctions_multiples:{epithete:[[7]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[7]}]],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[6,7,8]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"}},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[6,7,8,9]}]],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[0,1,2,3,4,5,6,7,8,9]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{sujet:[0,1,2,3],verbe_noyau:[4,5],cod:[6,7]},_fonctions_multiples:{apposition:[[8,9,10,11]]},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{noyau:[1]},_fonctions_multiples:{complement_du_nom:[[2,3]]},_groupes_enchasses:[[["complement_du_nom",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[2,3]}]],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[0,1,2,3]}],[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[0,1,2,3]}],[["cod",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[6,7]}],[["apposition",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{noyau:[9]},_fonctions_multiples:{complement_du_nom:[[10,11]]},_groupes_enchasses:[[["complement_du_nom",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[10,11]}]],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[8,9,10,11]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"},cod:{est_anime:!0,pronominalisation:"l'"}},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[0,1,2,3,4,5,6,7,8,9,10,11]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{cod:[6,7,8,9,10],sujet:[0,1,2],verbe_noyau:[3,5]},_fonctions_multiples:{complement_circonstanciel:[[11,12,13,14],[4]]},_groupes_enchasses:[[["cod",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{noyau:[6,7]},_fonctions_multiples:{complement_circonstanciel:[[8,9,10]]},_groupes_enchasses:[[["complement_circonstanciel",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[8,9,10]}]],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[6,7,8,9,10]}],[["complement_circonstanciel",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{sujet:[12,13],verbe_noyau:[14]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[12,13]}]],_manipulations:{sujet:{est_anime:!1,pronominalisation:"elle"}},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[11,12,13,14]}],[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[0,1,2]}],[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{noyau:[2]},_fonctions_multiples:{epithete:[[1]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[1]}]],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[0,1,2]}],[["complement_circonstanciel",1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[4]}]],_manipulations:{cod:{est_anime:!1,pronominalisation:"l'"},sujet:{est_anime:!0,pronominalisation:"il"}},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]}],sn=on.map(o=>F.fromJSON(o));function an(o,e=0){return sn.slice(e,e+o)}function rn(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ln=function(e,t){return Array.prototype.slice.call(e,t)},un=typeof setImmediate=="function",xe;un?xe=function(o){setImmediate(o)}:xe=function(o){setTimeout(o,0)};var cn=xe,pn=cn,_n=function(e,t,n){e&&pn(function(){e.apply(n||null,t||[])})},Ie=ln,mn=_n,dn=function(e,t){var n=t||{},i={};return e===void 0&&(e={}),e.on=function(s,a){return i[s]?i[s].push(a):i[s]=[a],e},e.once=function(s,a){return a._once=!0,e.on(s,a),e},e.off=function(s,a){var p=arguments.length;if(p===1)delete i[s];else if(p===0)i={};else{var c=i[s];if(!c)return e;c.splice(c.indexOf(a),1)}return e},e.emit=function(){var s=Ie(arguments);return e.emitterSnapshot(s.shift()).apply(this,s)},e.emitterSnapshot=function(s){var a=(i[s]||[]).slice(0);return function(){var p=Ie(arguments),c=this||e;if(s==="error"&&n.throws!==!1&&!a.length)throw p.length===1?p[0]:p;return a.forEach(function(h){n.async?mn(h,p,c):h.apply(c,p),h._once&&e.off(s,h)}),e}},e},st=window.CustomEvent;function hn(){try{var o=new st("cat",{detail:{foo:"bar"}});return o.type==="cat"&&o.detail.foo==="bar"}catch{}return!1}var fn=hn()?st:typeof document<"u"&&typeof document.createEvent=="function"?function(e,t){var n=document.createEvent("CustomEvent");return t?n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail):n.initCustomEvent(e,!1,!1,void 0),n}:function(e,t){var n=document.createEventObject();return n.type=e,t?(n.bubbles=!!t.bubbles,n.cancelable=!!t.cancelable,n.detail=t.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n},at=[],fe="",vn=/^on/;for(fe in window)vn.test(fe)&&at.push(fe.slice(2));var gn=at,bn=fn,yn=gn,oe=window.document,rt=jn,lt=wn,te=[];window.addEventListener||(rt=Cn,lt=Ln);var xn={add:rt,remove:lt,fabricate:En};function jn(o,e,t,n){return o.addEventListener(e,t,n)}function Cn(o,e,t){return o.attachEvent("on"+e,On(o,e,t))}function wn(o,e,t,n){return o.removeEventListener(e,t,n)}function Ln(o,e,t){var n=ut(o,e,t);if(n)return o.detachEvent("on"+e,n)}function En(o,e,t){var n=yn.indexOf(e)===-1?s():i();o.dispatchEvent?o.dispatchEvent(n):o.fireEvent("on"+e,n);function i(){var a;return oe.createEvent?(a=oe.createEvent("Event"),a.initEvent(e,!0,!0)):oe.createEventObject&&(a=oe.createEventObject()),a}function s(){return new bn(e,{detail:t})}}function $n(o,e,t){return function(i){var s=i||window.event;s.target=s.target||s.srcElement,s.preventDefault=s.preventDefault||function(){s.returnValue=!1},s.stopPropagation=s.stopPropagation||function(){s.cancelBubble=!0},s.which=s.which||s.keyCode,t.call(o,s)}}function On(o,e,t){var n=ut(o,e,t)||$n(o,e,t);return te.push({wrapper:n,element:o,type:e,fn:t}),n}function ut(o,e,t){var n=qn(o,e,t);if(n){var i=te[n].wrapper;return te.splice(n,1),i}}function qn(o,e,t){var n,i;for(n=0;n<te.length;n++)if(i=te[n],i.element===o&&i.type===e&&i.fn===t)return n}var Be={},Sn="(?:^|\\s)",Mn="(?:\\s|$)";function ct(o){var e=Be[o];return e?e.lastIndex=0:Be[o]=e=new RegExp(Sn+o+Mn,"g"),e}function An(o,e){var t=o.className;t.length?ct(e).test(t)||(o.className+=" "+e):o.className=e}function kn(o,e){o.className=o.className.replace(ct(e)," ").trim()}var Tn={add:An,rm:kn},Fn=dn,Y=xn,B=Tn,J=document,M=J.documentElement;function Dn(o,e){var t=arguments.length;t===1&&Array.isArray(o)===!1&&(e=o,o=[]);var n,i,s,a,p,c,d,h,b,v,P,S=null,Q,m=e||{};m.moves===void 0&&(m.moves=Ve),m.accepts===void 0&&(m.accepts=Ve),m.invalid===void 0&&(m.invalid=xt),m.containers===void 0&&(m.containers=o||[]),m.isContainer===void 0&&(m.isContainer=Nn),m.copy===void 0&&(m.copy=!1),m.copySortSource===void 0&&(m.copySortSource=!1),m.revertOnSpill===void 0&&(m.revertOnSpill=!1),m.removeOnSpill===void 0&&(m.removeOnSpill=!1),m.direction===void 0&&(m.direction="vertical"),m.ignoreInputTextSelection===void 0&&(m.ignoreInputTextSelection=!0),m.mirrorContainer===void 0&&(m.mirrorContainer=J.body);var y=Fn({containers:m.containers,start:yt,end:Se,cancel:Te,remove:ke,destroy:ft,canMove:bt,dragging:!1});return m.removeOnSpill===!0&&y.on("over",jt).on("out",Ct),Ee(),y;function le(l){return y.containers.indexOf(l)!==-1||m.isContainer(l)}function Ee(l){var _=l?"remove":"add";U(M,_,"mousedown",vt),U(M,_,"mouseup",pe)}function ue(l){var _=l?"remove":"add";U(M,_,"mousemove",gt)}function $e(l){var _=l?"remove":"add";Y[_](M,"selectstart",Oe),Y[_](M,"click",Oe)}function ft(){Ee(!0),pe({})}function Oe(l){Q&&l.preventDefault()}function vt(l){c=l.clientX,d=l.clientY;var _=ze(l)!==1||l.metaKey||l.ctrlKey;if(!_){var f=l.target,g=ce(f);g&&(Q=g,ue(),l.type==="mousedown"&&(Xe(f)?f.focus():l.preventDefault()))}}function gt(l){if(Q){if(ze(l)===0){pe({});return}if(!(l.clientX!==void 0&&Math.abs(l.clientX-c)<=(m.slideFactorX||0)&&l.clientY!==void 0&&Math.abs(l.clientY-d)<=(m.slideFactorY||0))){if(m.ignoreInputTextSelection){var _=z("clientX",l)||0,f=z("clientY",l)||0,g=J.elementFromPoint(_,f);if(Xe(g))return}var E=Q;ue(!0),$e(),Se(),qe(E);var x=Pn(s);a=z("pageX",l)-x.left,p=z("pageY",l)-x.top,B.add(v||s,"gu-transit"),wt(),de(l)}}}function ce(l){if(!(y.dragging&&n)&&!le(l)){for(var _=l;$(l)&&le($(l))===!1;)if(m.invalid(l,_)||(l=$(l),!l))return;var f=$(l);if(f&&!m.invalid(l,_)){var g=m.moves(l,f,_,Z(l));if(g)return{item:l,source:f}}}}function bt(l){return!!ce(l)}function yt(l){var _=ce(l);_&&qe(_)}function qe(l){Et(l.item,l.source)&&(v=l.item.cloneNode(!0),y.emit("cloned",v,l.item,"copy")),i=l.source,s=l.item,h=b=Z(l.item),y.dragging=!0,y.emit("drag",s,i)}function xt(){return!1}function Se(){if(y.dragging){var l=v||s;Ae(l,$(l))}}function Me(){Q=!1,ue(!0),$e(!0)}function pe(l){if(Me(),!!y.dragging){var _=v||s,f=z("clientX",l)||0,g=z("clientY",l)||0,E=Re(n,f,g),x=Fe(E,f,g);x&&(v&&m.copySortSource||!v||x!==i)?Ae(_,x):m.removeOnSpill?ke():Te()}}function Ae(l,_){var f=$(l);v&&m.copySortSource&&_===i&&f.removeChild(s),me(_)?y.emit("cancel",l,i,i):y.emit("drop",l,_,i,b),_e()}function ke(){if(y.dragging){var l=v||s,_=$(l);_&&_.removeChild(l),y.emit(v?"cancel":"remove",l,_,i),_e()}}function Te(l){if(y.dragging){var _=arguments.length>0?l:m.revertOnSpill,f=v||s,g=$(f),E=me(g);E===!1&&_&&(v?g&&g.removeChild(v):i.insertBefore(f,h)),E||_?y.emit("cancel",f,i,i):y.emit("drop",f,g,i,b),_e()}}function _e(){var l=v||s;Me(),Lt(),l&&B.rm(l,"gu-transit"),P&&clearTimeout(P),y.dragging=!1,S&&y.emit("out",l,S,i),y.emit("dragend",l),i=s=v=h=b=P=S=null}function me(l,_){var f;return _!==void 0?f=_:n?f=b:f=Z(v||s),l===i&&f===h}function Fe(l,_,f){for(var g=l;g&&!E();)g=$(g);return g;function E(){var x=le(g);if(x===!1)return!1;var X=De(g,l),w=Pe(g,X,_,f),N=me(g,w);return N?!0:m.accepts(s,g,i,w)}}function de(l){if(!n)return;l.preventDefault();var _=z("clientX",l)||0,f=z("clientY",l)||0,g=_-a,E=f-p;n.style.left=g+"px",n.style.top=E+"px";var x=v||s,X=Re(n,_,f),w=Fe(X,_,f),N=w!==null&&w!==S;(N||w===null)&&(Ot(),S=w,$t());var O=$(x);if(w===i&&v&&!m.copySortSource){O&&O.removeChild(x);return}var q,R=De(w,X);if(R!==null)q=Pe(w,R,_,f);else if(m.revertOnSpill===!0&&!v)q=h,w=i;else{v&&O&&O.removeChild(x);return}(q===null&&N||q!==x&&q!==Z(x))&&(b=q,w.insertBefore(x,q),y.emit("shadow",x,w,i));function I(qt){y.emit(qt,x,S,i)}function $t(){N&&I("over")}function Ot(){S&&I("out")}}function jt(l){B.rm(l,"gu-hide")}function Ct(l){y.dragging&&B.add(l,"gu-hide")}function wt(){if(!n){var l=s.getBoundingClientRect();n=s.cloneNode(!0),n.style.width=Ge(l)+"px",n.style.height=We(l)+"px",B.rm(n,"gu-transit"),B.add(n,"gu-mirror"),m.mirrorContainer.appendChild(n),U(M,"add","mousemove",de),B.add(m.mirrorContainer,"gu-unselectable"),y.emit("cloned",n,s,"mirror")}}function Lt(){n&&(B.rm(m.mirrorContainer,"gu-unselectable"),U(M,"remove","mousemove",de),$(n).removeChild(n),n=null)}function De(l,_){for(var f=_;f!==l&&$(f)!==l;)f=$(f);return f===M?null:f}function Pe(l,_,f,g){var E=m.direction==="horizontal",x=_!==l?w():X();return x;function X(){var O=l.children.length,q,R,I;for(q=0;q<O;q++)if(R=l.children[q],I=R.getBoundingClientRect(),E&&I.left+I.width/2>f||!E&&I.top+I.height/2>g)return R;return null}function w(){var O=_.getBoundingClientRect();return N(E?f>O.left+Ge(O)/2:g>O.top+We(O)/2)}function N(O){return O?Z(_):_}}function Et(l,_){return typeof m.copy=="boolean"?m.copy:m.copy(l,_)}}function U(o,e,t,n){var i={mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"},s={mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"},a={mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"};window.navigator.pointerEnabled?Y[e](o,s[t],n):window.navigator.msPointerEnabled?Y[e](o,a[t],n):(Y[e](o,i[t],n),Y[e](o,t,n))}function ze(o){if(o.touches!==void 0)return o.touches.length;if(o.which!==void 0&&o.which!==0)return o.which;if(o.buttons!==void 0)return o.buttons;var e=o.button;if(e!==void 0)return e&1?1:e&2?3:e&4?2:0}function Pn(o){var e=o.getBoundingClientRect();return{left:e.left+He("scrollLeft","pageXOffset"),top:e.top+He("scrollTop","pageYOffset")}}function He(o,e){return typeof window[e]<"u"?window[e]:M.clientHeight?M[o]:J.body[o]}function Re(o,e,t){o=o||{};var n=o.className||"",i;return o.className+=" gu-hide",i=J.elementFromPoint(e,t),o.className=n,i}function Nn(){return!1}function Ve(){return!0}function Ge(o){return o.width||o.right-o.left}function We(o){return o.height||o.bottom-o.top}function $(o){return o.parentNode===J?null:o.parentNode}function Xe(o){return o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.tagName==="SELECT"||pt(o)}function pt(o){return!o||o.contentEditable==="false"?!1:o.contentEditable==="true"?!0:pt($(o))}function Z(o){return o.nextElementSibling||e();function e(){var t=o;do t=t.nextSibling;while(t&&t.nodeType!==1);return t}}function In(o){return o.targetTouches&&o.targetTouches.length?o.targetTouches[0]:o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:o}function z(o,e){var t=In(e),n={pageX:"clientX",pageY:"clientY"};return o in n&&!(o in t)&&n[o]in t&&(o=n[o]),t[o]}var Bn=Dn;const zn=rn(Bn);function A(o,e){return`<fieldset class="manipulation-element">
                <legend class="manipulation-element-titre">${o}</legend>
                <span class="manipulation-element-contenu">${e}</span>
            </fieldset>`}function Hn(o){return o=o.toLowerCase(),new Map([["je","moi"],["tu","toi"],["il","lui"],["ils","eux"],["me","moi"],["te","toi"],["le","lui"],["la","elle"],["les","eux"]]).get(o)??o}function Ye(o,e){const t=o.offset_pos(e);let n="";for(let i=0,s=0;i<o.contenu.length;i++)i===t[s][0]?n+='<span class="manipulation-supprimable">':i===t[s][1]&&(n+="</span>",s<t.length-1&&s++),n+=o.contenu[i];return A("Suppression",n)}function Rn(o,e){let t='<span id="dragula-container">';for(let n=0;n<o.longueur;n++)console.log("p",n,e),e.indexOf(n)>-1?(t+=`<span class="dragula-draggable">${o.texte_pos(e)} </span> `,n=e.length-1):t+=`<span class="dragula-dz" >${o.texte_pos([n])}</span> `;return t+='<span class="dragula-dz"> </span> </span>',A("Déplacement",t)}function ie(o){if(o.corrige.aFonction("sujet"))return o.fonction_texte_pos("sujet");if(o.corrige.aFonction("verbe_noyau")){const e=o.corrige.infos_de_manipulation("verbe_noyau").pronominalisation;if(typeof e!="string")throw new Error("Impossible de trouver le sujet");return e}return""}function Vn(o,e,t){const n=u("modal-manipulations");n.style.display="block";const i={sujet:"le sujet",attribut_du_sujet:"l'attribut du sujet",cod:"le COD",coi:"le COI",groupe_verbal:"le groupe verbal",complement_circonstanciel:"le complément circonstanciel"}[o];u("modal-manipulations-titre").innerHTML=`Manipule ${i} pour vérifier ta réponse.`,u("manipulations-form-contenu").innerHTML="",u("manipulable").innerHTML=e.texte_pos(t),u("manipulable").style.visibility="visible";const s=e.fonction_texte_pos("verbe_noyau"),a=`<span class="manipulation-drop-zone">Glisse ${i} ici</span>`,p=`
            <span class="manipulation-fleche">
    <svg fill="#000000" height="36px" width="100px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
             viewBox="0 0 476.213 476.213" xml:space="preserve">
    <polygon points="345.606,107.5 324.394,128.713 418.787,223.107 0,223.107 0,253.107 418.787,253.107 324.394,347.5 
            345.606,368.713 476.213,238.106 "/>
    </svg> </span>`;if(o==="sujet"){const c=" "+function(){return e.corrige.aFonction("attribut_du_sujet")?e.fonction_texte_pos("attribut_du_sujet"):e.corrige.aFonction("cod")?e.fonction_texte_pos("cod"):""}(),d=e.corrige.infos_de_manipulation("sujet"),h=d.est_anime?"Qui ":"Qu'",b="Je Tu Il Elle Nous Vous Ils Elles C' Ce Cela".split(" ").map(v=>`<option value="${v.toLowerCase()}">${v}</option>`).join(" ");u("manipulations-form-contenu").innerHTML=`<fieldset class="manipulation-element"><legend class="manipulation-element-titre">Question</legend><span class="manipulation-element-contenu">${h}est-ce qui ${s}${c} ? ${a}</span></fieldset><fieldset class="manipulation-element"><legend class="manipulation-element-titre">Extraction</legend><span class="manipulation-element-contenu">C'est ${a} qui ${s}${c}. </span></fieldset>`+(d.pronominalisation===null?"":`<fieldset class="manipulation-element"><legend class="manipulation-element-titre">Pronominalisation</legend><span class="manipulation-element-contenu">${e.texte_pos(t)} ${s}${c}. ${p}
        <select name="pronoms"><option disabled selected value>--</option>${b}</select> ${s}${c}.</span></fieldset>`)}else if(o==="cod"){const c=ie(e),d=e.corrige.aFonction("attribut_du_cod")?" "+e.fonction_texte_pos("attribut_du_cod"):"",b=e.corrige.infos_de_manipulation("cod").est_anime?"Qui ":"Qu'",v="le la l' les me m' te t' nous vous en".split(" ").map(P=>`<option value="${P.toLowerCase()}">${P}</option>`).join(" ");u("manipulations-form-contenu").innerHTML=A("Question",`${b}est-ce ${he("que",c)} ${s}${d} ? ${a}`)+A("Extraction",`C'est ${a} ${he("que",c)} ${s}${d}.`)+A("Pronominalisation",`${c} ${s} ${e.texte_pos(t)}${d} ${p} ${c} <select name="pronoms"><option disabled selected value>--</option>${v}</select> ${s}${d}.`)}else if(o==="coi"){const c=ie(e),d=e.corrige.aFonction("cod")?" "+e.fonction_texte_pos("cod"):"",h=e.corrige.infos_de_manipulation("coi"),b=h.preposition,v=b+" "+h.est_anime?"qui ":"quoi",P="lui leur me moi m' te t' toi en y".split(" ").map(S=>`<option value="${S.toLowerCase()}">${S}</option>`).join(" ");u("manipulations-form-contenu").innerHTML=A("Question",`${c} ${s}${d} ${b} ${v} ? ${a}`)+A("Extraction",`C'est ${a} ${he("que",c)} ${s}${d}.`)+A("Pronominalisation",`${c} ${s}${d} ${b} ${e.texte_pos(t)} ${p} ${c} <select name="pronoms"><option disabled selected value>--</option>${P}</select> ${s}${d}.`)}else if(o==="groupe_verbal"){const c=ie(e),h=e.corrige.infos_de_manipulation("groupe_verbal").verbe;u("manipulations-form-contenu").innerHTML=A("Question",`Que ${h} ${c} ? ${c} ${a}`)}else if(o==="attribut_du_sujet"){const c=ie(e);u("manipulations-form-contenu").innerHTML=A("Question",`${c} ${s} quoi ? ${a}`)+Ye(e,t)}else o==="complement_circonstanciel"&&(u("manipulations-form-contenu").innerHTML=Ye(e,t)+Rn(e,t),u("manipulable").style.visibility="collapse",zn([u("dragula-container")],{moves:function(c,d,h){if(c===void 0)throw Error("el is undefined");return c.className!=="dragula-dz"},accepts:function(c,d,h,b){if(b===void 0)throw Error("sibling is undefined");return b===null||b.className==="dragula-dz"}}));for(let c of document.getElementsByClassName("manipulation-supprimable"))c.addEventListener("click",()=>{c.classList.remove("manipulation-supprimable"),c.classList.add("manipulation-supprime")});for(const c of document.getElementsByClassName("manipulation-drop-zone"))c.addEventListener("dragover",d=>{const h=d;if(h.dataTransfer===null)throw Error("Pas de données transférées");h.preventDefault(),h.dataTransfer.dropEffect="copy"}),c.addEventListener("drop",d=>{const h=d;if(h.dataTransfer===null)throw Error("Pas de données transférées");h.preventDefault();const b=Hn(u(h.dataTransfer.getData("text/plain")).innerHTML);let v=h.target;v.innerHTML=b,v.classList.add("manipulable-deplace"),v.classList.remove("manipulation-drop-zone")})}function Gn(){const o=t=>document.querySelectorAll(t).length,e=document.getElementsByName("pronoms");for(const t of e)if(t.value==="")return!1;return console.log(o(".manipulation-element-contenu"),o(".manipulable-deplace")),!(o(".manipulation-drop-zone")>0||document.querySelectorAll(".manipulation-deplacable").length!==document.querySelectorAll(".manipulation-deplace").length||o(".manipulation-supprimable")>0)}u("manipulable").addEventListener("dragstart",o=>{o.dataTransfer!==null&&(o.dataTransfer.setData("text/plain",o.target.id),o.dataTransfer.dropEffect="copy")});function ve(o){return Math.abs(Math.floor(o))}function W(o,e){return Math.random()*(e-o)+o}function k(o,e){return Math.floor(W(o,e+1))}function Ke(o,e,t,n){const i=Math.pow;return Math.sqrt(i(o-t,2)+i(e-n,2))}function je(o,e,t=1){if(o>360||o<0)throw new Error(`Expected hue 0-360 range, got \`${o}\``);if(e>100||e<0)throw new Error(`Expected lightness 0-100 range, got \`${e}\``);if(t>1||t<0)throw new Error(`Expected alpha 0-1 range, got \`${t}\``);return`hsla(${o}, 100%, ${e}%, ${t})`}const Je=o=>{if(typeof o=="object"&&o!==null){if(typeof Object.getPrototypeOf=="function"){const e=Object.getPrototypeOf(o);return e===Object.prototype||e===null}return Object.prototype.toString.call(o)==="[object Object]"}return!1},Wn=["__proto__","constructor","prototype"],_t=(...o)=>o.reduce((e,t)=>(Object.keys(t).forEach(n=>{Wn.includes(n)||(Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=t[n]:Je(e[n])&&Je(t[n])?e[n]=_t(e[n],t[n]):e[n]=t[n])}),e),{});function Xn(o,e){let t;return(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>o(...n),e)}}class Yn{constructor({x:e,y:t,ctx:n,hue:i,decay:s,gravity:a,friction:p,brightness:c,flickering:d,lineWidth:h,explosionLength:b}){r(this,"x");r(this,"y");r(this,"ctx");r(this,"hue");r(this,"friction");r(this,"gravity");r(this,"flickering");r(this,"lineWidth");r(this,"explosionLength");r(this,"angle");r(this,"speed");r(this,"brightness");r(this,"coordinates",[]);r(this,"decay");r(this,"alpha",1);for(this.x=e,this.y=t,this.ctx=n,this.hue=i,this.gravity=a,this.friction=p,this.flickering=d,this.lineWidth=h,this.explosionLength=b,this.angle=W(0,Math.PI*2),this.speed=k(1,10),this.brightness=k(c.min,c.max),this.decay=W(s.min,s.max);this.explosionLength--;)this.coordinates.push([e,t])}update(e){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&e()}draw(){const e=this.coordinates.length-1;this.ctx.beginPath(),this.ctx.lineWidth=this.lineWidth,this.ctx.fillStyle=je(this.hue,this.brightness,this.alpha),this.ctx.moveTo(this.coordinates[e][0],this.coordinates[e][1]),this.ctx.lineTo(this.x,this.y),this.ctx.strokeStyle=je(this.hue,this.flickering?W(0,this.brightness):this.brightness,this.alpha),this.ctx.stroke()}}class Kn{constructor(e,t){r(this,"active",!1);r(this,"x");r(this,"y");this.options=e,this.canvas=t,this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=this.pointerMove.bind(this)}get mouseOptions(){return this.options.mouse}mount(){this.canvas.addEventListener("pointerdown",this.pointerDown),this.canvas.addEventListener("pointerup",this.pointerUp),this.canvas.addEventListener("pointermove",this.pointerMove)}unmount(){this.canvas.removeEventListener("pointerdown",this.pointerDown),this.canvas.removeEventListener("pointerup",this.pointerUp),this.canvas.removeEventListener("pointermove",this.pointerMove)}usePointer(e,t){const{click:n,move:i}=this.mouseOptions;(n||i)&&(this.x=e.pageX-this.canvas.offsetLeft,this.y=e.pageY-this.canvas.offsetTop,this.active=t)}pointerDown(e){this.usePointer(e,this.mouseOptions.click)}pointerUp(e){this.usePointer(e,!1)}pointerMove(e){this.usePointer(e,this.active)}}class Jn{constructor(){r(this,"hue");r(this,"rocketsPoint");r(this,"opacity");r(this,"acceleration");r(this,"friction");r(this,"gravity");r(this,"particles");r(this,"explosion");r(this,"mouse");r(this,"boundaries");r(this,"sound");r(this,"delay");r(this,"brightness");r(this,"decay");r(this,"flickering");r(this,"intensity");r(this,"traceLength");r(this,"traceSpeed");r(this,"lineWidth");r(this,"lineStyle");r(this,"autoresize");this.autoresize=!0,this.lineStyle="round",this.flickering=50,this.traceLength=3,this.traceSpeed=10,this.intensity=30,this.explosion=5,this.gravity=1.5,this.opacity=.5,this.particles=50,this.friction=.95,this.acceleration=1.05,this.hue={min:0,max:360},this.rocketsPoint={min:50,max:50},this.lineWidth={explosion:{min:1,max:3},trace:{min:1,max:2}},this.mouse={click:!1,move:!1,max:1},this.delay={min:30,max:60},this.brightness={min:50,max:80},this.decay={min:.015,max:.03},this.sound={enabled:!1,files:["explosion0.mp3","explosion1.mp3","explosion2.mp3"],volume:{min:4,max:8}},this.boundaries={debug:!1,height:0,width:0,x:50,y:50}}update(e){Object.assign(this,_t(this,e))}}class Qn{constructor(e,t){r(this,"tick",0);r(this,"rafId",0);r(this,"fps",60);r(this,"tolerance",.1);r(this,"now");this.options=e,this.render=t}mount(){this.now=performance.now();const e=1e3/this.fps,t=n=>{this.rafId=requestAnimationFrame(t);const i=n-this.now;i>=e-this.tolerance&&(this.render(),this.now=n-i%e,this.tick+=i*(this.options.intensity*Math.PI)/1e3)};this.rafId=requestAnimationFrame(t)}unmount(){cancelAnimationFrame(this.rafId)}}class Un{constructor(e,t,n){r(this,"resizer");this.options=e,this.updateSize=t,this.container=n}mount(){if(!this.resizer){const e=Xn(()=>this.updateSize(),100);this.resizer=new ResizeObserver(e)}this.options.autoresize&&this.resizer.observe(this.container)}unmount(){this.resizer&&this.resizer.unobserve(this.container)}}class Zn{constructor(e){r(this,"buffers",[]);r(this,"audioContext");r(this,"onInit",!1);this.options=e,this.init()}get isEnabled(){return this.options.sound.enabled}get soundOptions(){return this.options.sound}init(){!this.onInit&&this.isEnabled&&(this.onInit=!0,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.loadSounds())}async loadSounds(){for(const e of this.soundOptions.files){const t=await(await fetch(e)).arrayBuffer();this.audioContext.decodeAudioData(t).then(n=>{this.buffers.push(n)}).catch(n=>{throw n})}}play(){if(this.isEnabled&&this.buffers.length){const e=this.audioContext.createBufferSource(),t=this.buffers[k(0,this.buffers.length-1)],n=this.audioContext.createGain();e.buffer=t,n.gain.value=W(this.soundOptions.volume.min/100,this.soundOptions.volume.max/100),n.connect(this.audioContext.destination),e.connect(n),e.start(0)}else this.init()}}class eo{constructor({x:e,y:t,dx:n,dy:i,ctx:s,hue:a,speed:p,traceLength:c,acceleration:d}){r(this,"x");r(this,"y");r(this,"sx");r(this,"sy");r(this,"dx");r(this,"dy");r(this,"ctx");r(this,"hue");r(this,"speed");r(this,"acceleration");r(this,"traceLength");r(this,"totalDistance");r(this,"angle");r(this,"brightness");r(this,"coordinates",[]);r(this,"currentDistance",0);for(this.x=e,this.y=t,this.sx=e,this.sy=t,this.dx=n,this.dy=i,this.ctx=s,this.hue=a,this.speed=p,this.traceLength=c,this.acceleration=d,this.totalDistance=Ke(e,t,n,i),this.angle=Math.atan2(i-t,n-e),this.brightness=k(50,70);this.traceLength--;)this.coordinates.push([e,t])}update(e){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.acceleration;const t=Math.cos(this.angle)*this.speed,n=Math.sin(this.angle)*this.speed;this.currentDistance=Ke(this.sx,this.sy,this.x+t,this.y+n),this.currentDistance>=this.totalDistance?e(this.dx,this.dy,this.hue):(this.x+=t,this.y+=n)}draw(){const e=this.coordinates.length-1;this.ctx.beginPath(),this.ctx.moveTo(this.coordinates[e][0],this.coordinates[e][1]),this.ctx.lineTo(this.x,this.y),this.ctx.strokeStyle=je(this.hue,this.brightness),this.ctx.stroke()}}class to{constructor(e,t={}){r(this,"target");r(this,"container");r(this,"canvas");r(this,"ctx");r(this,"width");r(this,"height");r(this,"traces",[]);r(this,"explosions",[]);r(this,"waitStopRaf");r(this,"running",!1);r(this,"opts");r(this,"sound");r(this,"resize");r(this,"mouse");r(this,"raf");this.target=e,this.container=e,this.opts=new Jn,this.createCanvas(this.target),this.updateOptions(t),this.sound=new Zn(this.opts),this.resize=new Un(this.opts,this.updateSize.bind(this),this.container),this.mouse=new Kn(this.opts,this.canvas),this.raf=new Qn(this.opts,this.render.bind(this))}get isRunning(){return this.running}get version(){return"2.10.7"}get currentOptions(){return this.opts}start(){this.running||(this.canvas.isConnected||this.createCanvas(this.target),this.running=!0,this.resize.mount(),this.mouse.mount(),this.raf.mount())}stop(e=!1){!this.running||(this.running=!1,this.resize.unmount(),this.mouse.unmount(),this.raf.unmount(),this.clear(),e&&this.canvas.remove())}async waitStop(e){if(this.running)return new Promise(t=>{this.waitStopRaf=()=>{!this.waitStopRaf||(requestAnimationFrame(this.waitStopRaf),!this.traces.length&&!this.explosions.length&&(this.waitStopRaf=null,this.stop(e),t()))},this.waitStopRaf()})}pause(){this.running=!this.running,this.running?this.raf.mount():this.raf.unmount()}clear(){!this.ctx||(this.traces=[],this.explosions=[],this.ctx.clearRect(0,0,this.width,this.height))}launch(e=1){for(let t=0;t<e;t++)this.createTrace();this.waitStopRaf||(this.start(),this.waitStop())}updateOptions(e){this.opts.update(e)}updateSize({width:e=this.container.clientWidth,height:t=this.container.clientHeight}={}){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.updateBoundaries({...this.opts.boundaries,width:e,height:t})}updateBoundaries(e){this.updateOptions({boundaries:e})}createCanvas(e){e instanceof HTMLCanvasElement?(e.isConnected||document.body.append(e),this.canvas=e):(this.canvas=document.createElement("canvas"),this.container.append(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.updateSize()}render(){if(!this.ctx||!this.running)return;const{opacity:e,lineStyle:t,lineWidth:n}=this.opts;this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle=`rgba(0, 0, 0, ${e})`,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalCompositeOperation="lighter",this.ctx.lineCap=t,this.ctx.lineJoin="round",this.ctx.lineWidth=W(n.trace.min,n.trace.max),this.initTrace(),this.drawTrace(),this.drawExplosion()}createTrace(){const{hue:e,rocketsPoint:t,boundaries:n,traceLength:i,traceSpeed:s,acceleration:a,mouse:p}=this.opts;this.traces.push(new eo({x:this.width*k(t.min,t.max)/100,y:this.height,dx:this.mouse.x&&p.move||this.mouse.active?this.mouse.x:k(n.x,n.width-n.x*2),dy:this.mouse.y&&p.move||this.mouse.active?this.mouse.y:k(n.y,n.height*.5),ctx:this.ctx,hue:k(e.min,e.max),speed:s,acceleration:a,traceLength:ve(i)}))}initTrace(){if(this.waitStopRaf)return;const{delay:e,mouse:t}=this.opts;(this.raf.tick>k(e.min,e.max)||this.mouse.active&&t.max>this.traces.length)&&(this.createTrace(),this.raf.tick=0)}drawTrace(){let e=this.traces.length;for(;e--;)this.traces[e].draw(),this.traces[e].update((t,n,i)=>{this.initExplosion(t,n,i),this.sound.play(),this.traces.splice(e,1)})}initExplosion(e,t,n){const{particles:i,flickering:s,lineWidth:a,explosion:p,brightness:c,friction:d,gravity:h,decay:b}=this.opts;let v=ve(i);for(;v--;)this.explosions.push(new Yn({x:e,y:t,ctx:this.ctx,hue:n,friction:d,gravity:h,flickering:k(0,100)<=s,lineWidth:W(a.explosion.min,a.explosion.max),explosionLength:ve(p),brightness:c,decay:b}))}drawExplosion(){let e=this.explosions.length;for(;e--;)this.explosions[e].draw(),this.explosions[e].update(()=>{this.explosions.splice(e,1)})}}const se=[["verbes","Sélectionne le ou les verbes."],["independante","Sélectionne une proposition indépendante"],["verbe_noyau","Sélectionne le verbe noyau"],["noyau","Sélectionne le noyau"],["sujet","Sélectionne le sujet"],["attribut_du_sujet","Sélectionne l'attribut du sujet."],["cod","Sélectionne le Complément d'objet direct (COD)."],["coi","Sélectionne le Complément d'objet indirect (COI)."],["attribut_du_cod","Sélectionne l'attribut du COD."],["complement_d_agent","Sélectionne le complément d'agent"],["complement_du_verbe_impersonnel","Sélectionne le complément du verbe impersonnel"],["groupe_verbal","Sélectionne le groupe verbal"],["complement_circonstanciel","Sélectionne un complément circonstanciel"],["complement_du_nom","Sélectionne un complément du nom"],["complement_du_pronom","Sélectionne un complément du pronom"],["epithete","Sélectionne une épithète"],["apposition","Sélectionne une apposition"],["complement_de_l_adjectif","Sélectionne un complément de l'adjectif"],["modalisateur","Sélectionne un modalisateur"],["auto-enonciative","Sélectionne une fonction auto-énonciative"],["connecteur","Sélectionne un connecteur"],["balise_textuelle","Sélectionne une balise textuelle"]];function mt(o){const e=u("bouton-valider");e.classList.replace("boutons-analyse-desactive","bouton-actif"),e.classList.add("boutons-analyse-valider");let t=new T(o.contenu,o);new Ce(t).analyse_fonction()}const ee=class ee{constructor(e){r(this,"_consignes_etape",0);r(this,"_fonctions_multiples_index",-1);r(this,"_groupes_enchasses_generateur");r(this,"_corrige");r(this,"_id");r(this,"_fonction_courante","sujet");r(this,"_mots_selectionnes",[]);r(this,"_score",0);this._syntagme=e,this._syntagme=e,this._corrige=e.corrige,this._groupes_enchasses_generateur=e.corrige.groupes_enchasses(),this._id=ee.current_id++}get id(){return this._id}analyse_finie(){if(this._syntagme.arbre_genealogique.length===1){V(`<div class="victoire" id="victoire">${(()=>{switch(console.log("Nombre d'erreurs à la fin de l'analyse: ",this._score),this._score){case 0:return"<h1>Bravo ! Tu n'as aucune faute.</h1>";case 1:return"<h2>C'est très bien ! Tu as fait une seule erreur.</h2>";default:return`<h2>C'est bien, mais tu as fait ${this._score} erreurs.</h2>`}})()}<div id="feu-d-artifice"></div></div>`,"Commencer une autre analyse",dt,!0);const n=u("feu-d-artifice");new to(n,{autoresize:!1,mouse:{click:!0,move:!1,max:1}}).start()}const e=new Event(`AnalyseFinie-${this._id}`);document.dispatchEvent(e)}analyse_fonction(){if(this._fonction_courante=se[this._consignes_etape][0],console.log(`Nouvelle analyse: ${this._fonction_courante}`),!this._corrige.aFonction(this._fonction_courante)){this.analyse_suivante();return}T.Fonctions_multiples.includes(this._fonction_courante)&&this._fonctions_multiples_index===-1&&(this._fonctions_multiples_index=0);const e=se[this._consignes_etape][1]+(this._fonctions_multiples_index>=0?` (${this._fonctions_multiples_index+1})`:"");u("consigne-container").innerHTML=Ne(e,this._syntagme),u("phrase-analyse-paragraphe").innerHTML=ge(this._syntagme,this._syntagme.mots_pos),be(u("phrase-analyse-paragraphe")),j.fonction_de_validation=()=>{this._mots_selectionnes=Array.from(document.getElementsByClassName("phrase-selectionne")).map(t=>Number(t.id.split("-")[2])),this._mots_selectionnes.length!==0&&(this._syntagme.declare(this._fonction_courante,this._mots_selectionnes,this._fonctions_multiples_index),this.manipule_fonction())},j.ok=j.fonction_de_validation,this.preselection()}preselection(){const e=this._syntagme.fonctionPos(this._fonction_courante,this._fonctions_multiples_index);Array.from(document.getElementsByClassName("phrase-cliquable")).forEach((t,n)=>{e.includes(n)&&t.classList.add("phrase-selectionne")})}async analyse_suivante(){if(this._consignes_etape===se.length-1){console.debug("Fin de l'analyse du syntagme");for(let[[e,t],n]of this._groupes_enchasses_generateur){if(console.debug(`Analyse d'un groupe enchâssé: ${e}`),n.vide){console.debug("Groupe enchâssé vide",e);continue}const i=new ee(this._syntagme.cree_groupe_enchasse_eleve(n,e,t));await new Promise((a,p)=>{i.analyse_fonction(),document.addEventListener(`AnalyseFinie-${i.id}`,()=>{a()},{once:!0})}).then(()=>console.debug("promise ok"))}return u("consigne-container").innerHTML=Ne("L'analyse est terminée.",this._syntagme),u("phrase-analyse-paragraphe").innerHTML=ge(this._syntagme,this._syntagme.mots_pos),be(u("phrase-analyse-paragraphe")),this.analyse_finie()}else{const e=T.Fonctions_multiples.includes(this._fonction_courante)&&!this._syntagme.est_complet(this._fonction_courante)?0:1;return this._fonctions_multiples_index=e===0?this._fonctions_multiples_index+1:-1,this._consignes_etape+=e,this.analyse_fonction()}}affiche_erreur(){const e=u("modal-message-contenu");e.classList.add("modal-message-erreur"),V("Il y a une erreur dans ton analyse !","Reprendre l'analyse",()=>{e.classList.remove("modal-message-erreur")})}soumettre_fonction(e,t){this._syntagme.est_correct(e,t)?this.analyse_suivante():(this._score++,console.log("score",this._score),this.affiche_erreur())}prepare_manipulation(e,t=!0){const n=this;return new Promise((i,s)=>{Vn(e,n._syntagme,n._syntagme.fonctionPos(e,this._fonctions_multiples_index));const a={once:!0},p=()=>{if(!Gn()){u("modal-manipulations-OK").addEventListener("click",p,a);return}t&&K(u("modal-manipulations-contenu"),u("modal-manipulations")),u("modal-manipulations-annuler").removeEventListener("click",c,a),i()},c=()=>{K(u("modal-manipulations-contenu"),u("modal-manipulations")),u("modal-manipulations-OK").removeEventListener("click",p,a),s()};u("modal-manipulations-OK").addEventListener("click",p,a),u("modal-manipulations-annuler").addEventListener("click",c,a),j.ok=p,j.annuler=c})}manipule_fonction(){const e=this,t=s=>se.map((a,p)=>[a[0],p]).filter(a=>a[0]===s)[0][1],n=()=>{this.prepare_manipulation(this._fonction_courante).then(()=>{e.soumettre_fonction(e._fonction_courante,e._fonctions_multiples_index)},()=>{e.analyse_fonction()})},i=s=>(this._corrige.aFonction("sujet")?this.prepare_manipulation("sujet",!1):new Promise(a=>{a()})).then(()=>e.prepare_manipulation(s),()=>{throw"sujet"}).then(()=>{e._corrige.aFonction("sujet")&&!e._syntagme.est_correct("sujet")?(e.affiche_erreur(),e._consignes_etape=t("sujet"),e.analyse_fonction()):e._syntagme.est_correct(s)?e.analyse_suivante():(e.affiche_erreur(),e._consignes_etape=t(s),e.analyse_fonction())},a=>{throw a!=="sujet"?s:a}).catch(a=>{if(a==="sujet")e._consignes_etape=t("sujet");else if(a===s)e._consignes_etape=t(s);else throw a;e.analyse_fonction()});if(this._fonction_courante==="sujet"){if(!this._corrige.aFonctions(["sujet","attribut_du_sujet"])&&!this._corrige.aFonctions(["sujet","cod"])){n();return}this.analyse_suivante();return}else if("coi groupe_verbal complement_circonstanciel".includes(this._fonction_courante)){n();return}else if("attribut_du_sujet cod".split(" ").includes(this._fonction_courante)){if(this._corrige.aFonction("attribut_du_cod"))return;i(this._fonction_courante);return}else if(this._fonction_courante==="attribut_du_cod"){i("cod").then(()=>{this.soumettre_fonction("attribut_du_cod",-1)});return}this.soumettre_fonction(this._fonction_courante,this._fonctions_multiples_index)}};r(ee,"current_id",0);let Ce=ee;function dt(){const o=u("modal-choix-phrase");o.style.display="block";const e=an(5,0),t=u("modal-choix-phrase-liste");t.innerHTML="";for(let n in e){const i=e[n],s=kt(t,"li",{id:`modal-choix-phrase-liste-${n}`});s.innerHTML=i.contenu,s.addEventListener("click",()=>{mt(e[n]),K(u("modal-choix-phrase-contenu"),o)})}}let we=!1;const Le=u("phrase-analyse-paragraphe");Le.addEventListener("mousedown",o=>{const e=o.target;o.button!=0||!e.classList.contains("phrase-cliquable")||(we=!0,e.classList.toggle("phrase-selectionne"))});Le.addEventListener("mouseover",o=>{const e=o.target;we&&e.classList.contains("phrase-cliquable")&&e.classList.toggle("phrase-selectionne")});Le.addEventListener("mouseup",o=>{we=!1});u("bouton-valider").addEventListener("click",()=>{j.fonction_de_validation()});document.onkeyup=function(o){switch(o.which){case 13:j.ok();break;case 27:j.annuler();break}};u("modal-message-bouton").addEventListener("click",()=>{j.fonction_du_bouton_de_message()});u("nouvelle_phrase").addEventListener("click",()=>{it()});u("analyse_fichier").addEventListener("click",()=>{for(const o of ne(document.getElementsByClassName("modal")))o.style.display="none";nn(),u("modal-analyse-fichier").style.display="block"});function no(){if((()=>{var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window})()){const e=u("analyse_fichier_input_form");e.classList.add("has-advanced-upload"),u("analyse_fichier_bouton").style.display="none","drag dragstart dragend dragover dragenter dragleave drop".split(" ").forEach(t=>{e.addEventListener(t,n=>{n.preventDefault(),n.stopPropagation()})}),["dragover","dragenter"].forEach(t=>{e.addEventListener(t,()=>e.classList.add("is-dragover"))}),["dragleave","dragend","drop"].forEach(t=>{e.addEventListener(t,()=>e.classList.remove("is-dragover"))})}else u("analyse_fichier_input").classList.remove("box__file")}function ht(o){const e=new FileReader,t=()=>{K(u("modal-analyse-fichier-contenu"),u("modal-analyse-fichier"))};if(o.length==0)return t(),V("Pas de fichier chargé.","OK",()=>{});const n=o[0];if(!(n.type?n.type:"Introuvable").includes("json"))return t(),V("Format invalide","OK",()=>{});e.addEventListener("load",i=>{const s=e.result??"";if(typeof s!="string"||s==="")return t(),V("Fichier invalide","OK",()=>{});try{mt(F.fromJSON(s))}catch(a){return console.log(a),t(),a instanceof TypeError?V("Ce fichier n'est pas compatible avec la version actuelle du programme.","OK",()=>{}):V("Fichier invalide","OK",()=>{})}t()}),e.readAsText(n)}u("analyse_fichier_input").addEventListener("change",o=>{const e=o.target;ht(e.files)});u("analyse_fichier_input_form").addEventListener("drop",o=>{var e;ht((e=o.dataTransfer)==null?void 0:e.files)});u("modal-croix").addEventListener("click",o=>{K(u("modal-message-contenu"),u("modal-message")),u("modal-croix").style.display="none",j.fonction_de_validation=()=>{};const e=u("bouton-valider");e.classList.replace("boutons-analyse-valider","boutons-analyse-desactive"),e.classList.remove("bouton-actif")});en();dt();no();
