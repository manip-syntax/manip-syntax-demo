var ae=Object.defineProperty;var re=(s,e,t)=>e in s?ae(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var r=(s,e,t)=>(re(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();const le=document.createElement("canvas");function w(s,e){let t=s.length;if(t!=e.length)return!1;for(;t--;)if(s[t]!==e[t])return!1;return!0}function q(s){if(s===null)throw TypeError("elt is null");return s}function ce(s,e,t={}){let n=document.createElement(e);return s.appendChild(n),Object.entries(t).forEach(([o,i])=>n.setAttribute(o,i)),n}function E(s,e){s.classList.add("modal-contenu-animation-disparition");const t=()=>{e.style.display="none",s.classList.remove("modal-contenu-animation-disparition"),s.removeEventListener("animationend",t)};s.addEventListener("animationend",t)}function l(s){return q(document.getElementById(s))}function d(s,e){if(s===!1)throw Error(e)}function ue(s,e){let t=q(le.getContext("2d"));t.font=e;let n=t.measureText(s);return Math.ceil(n.width)}const h=class h{constructor(e,t=[]){r(this,"_denomination",["phrase",-1]);r(this,"_parent",null);r(this,"_phrase_cassee",[]);r(this,"verbes",[]);r(this,"_mots_offset",[]);r(this,"_fonctions_uniques",{});r(this,"_fonctions_multiples",{});r(this,"_groupes_enchasses",new Map);r(this,"_manipulations",{});r(this,"_fonction_enchassee",(e,t)=>[e,t[0],t.slice(-1)[0]]);this.phrase=e,this._mots_pos=t,this.phrase=e,this._casseSyntagme(),this._mots_pos=w(t,[])?[...Array(this._phrase_cassee.length).keys()]:t,this._remplit_mots_offset()}get ancetre(){if(this._denomination[0]==="phrase")return this;if(this._parent===null)throw d(this._parent!==null,"Pas de parent enregistré"),Error;return this._parent.ancetre}get contenu(){return this.phrase}get arbre_genealogique(){if(this._parent===null)return[this._denomination];let e=this._parent.arbre_genealogique;return e.push(this._denomination),e}get mots_sans_fonction(){return this._mots_pos.filter(e=>this.fonction(e).length===0)}get mots_pos(){return this._mots_pos}set contenu(e){this.phrase=e}_remplit_mots_offset(){let e=new RegExp(h.Separateur,"g");const t=[];let n=0,o;for(;(o=e.exec(this.contenu))!==null;)o.index>n&&t.push([n,o.index]),n=o.index+o[0].length;return n<this.contenu.length&&t.push([n,this.contenu.length]),this._mots_offset=t,t}offset_pos(e){let t=[];for(let n=0,o=0,i=0,a=-1;n<this._mots_offset.length;n++)e.includes(n)?(a===n-1?(i=this._mots_offset[n][1],n===this._mots_offset.length-1&&t.push([o,i])):([o,i]=this._mots_offset[n],n===this._mots_offset.length-1&&t.push([o,i])),a=n):i>0&&a===n-1&&t.push([o,i]);return t}texte_pos(e){let t="";for(let n=0,o=0,i=0,a=-1;n<this._mots_offset.length;n++)e.includes(n)?(a===n-1?(i=this._mots_offset[n][1],n===this._mots_offset.length-1&&(t+=this.contenu.slice(o,i))):([o,i]=this._mots_offset[n],t.length>0&&(t+=" "),n===this._mots_offset.length-1&&(t+=this.contenu.slice(o,i))),a=n):i>0&&a===n-1&&(t+=this.contenu.slice(o,i));return t}fonction_texte_pos(e,t=-1){return this.texte_pos(this.fonctionPos(e,t))}get phraseCassee(){return this._phrase_cassee}get longueur(){return this._phrase_cassee.length}static get separateur(){return this._separateur}_remplit_les_vides(){typeof this._fonctions_uniques>"u"&&(this._fonctions_uniques={}),typeof this._fonctions_multiples>"u"&&(this._fonctions_multiples={}),typeof this._groupes_enchasses>"u"&&(this._groupes_enchasses=new Map)}get vide(){for(const[,e]of this._groupes_enchasses)if(!e.vide)return!1;return Object.keys(this._fonctions_uniques).length===0&&Object.keys(this._fonctions_multiples).length===0}ajoute_infos_de_manipulation(e,t){this._manipulations[e]=t}infos_de_manipulation(e){return d(e in this._manipulations,`${e} n'est pas enregistré dans les données de manipulation`),this._manipulations[e]}get est_attributif(){return"sujet"in this._fonctions_uniques&&"attribut_du_sujet"in this._fonctions_uniques}cree_groupe_enchasse(e,t,n){const o=new h(this.contenu,e);return this._groupes_enchasses.set([t,n],o),o._denomination=[t,n],o._parent=this,o}get groupes_enchasses_nombre(){return this._groupes_enchasses.size}groupe_enchasse(e,t){let n;for(const[o,i]of this._groupes_enchasses)o[0]===e&&o[1]===t&&(n=i);if(typeof n>"u")throw Error(`Pas de groupe avec la fonction ${e} et le numéro ${t}`);return n}supprime_groupe_enchasse(e,t){for(const[n]of this._groupes_enchasses)if(n[0]===e&&n[1]===t)return this._groupes_enchasses.delete(n);return!1}fonctions_multiples_nombre(e){const t=this._fonctions_multiples;return e in t?t[e].length:0}get copie(){let e=new h(this.contenu,this._mots_pos);return Object.entries(this._fonctions_uniques).forEach(([t,n])=>{n.length>0&&(e._fonctions_uniques[t]=n)}),Object.entries(this._fonctions_multiples).forEach(([t,n])=>{let o=[];n.length>0&&(o=n.filter(i=>i.length>0)),o.length>0&&(e._fonctions_multiples[t]=o)}),e._groupes_enchasses=new Map([...this._groupes_enchasses.entries()].filter(t=>!t[1].vide).map(t=>[t[0],t[1].copie])),e._manipulations=this._manipulations,e.verbes=this.verbes,e}toJSON(){let e=Object.assign(this.copie);return e._groupes_enchasses=Array.from(this._groupes_enchasses.entries()),e}get profondeur(){return this._groupes_enchasses.size===0?0:Math.max(...[...this._groupes_enchasses.entries()].map(([e,t])=>t.profondeur))+1}fonction(e){let t=[];this.verbes.includes(e)&&t.push("verbes");for(const n in this._fonctions_uniques)this._fonctions_uniques[n].includes(e)&&t.push(n);for(const n in this._fonctions_multiples)for(const o of this._fonctions_multiples[n])if(o.includes(e)){t.push(n);break}for(const[,n]of this._groupes_enchasses){const o=n.fonction(e);o&&t.push(...o)}return t}fonction_detaillee(e){let t=[];this.verbes.includes(e)&&t.push(this._fonction_enchassee("verbes",this.verbes));for(const o in this._fonctions_uniques)this._fonctions_uniques[o].includes(e)&&t.push(this._fonction_enchassee(o,this._fonctions_uniques[o]));const n=this._fonctions_multiples;for(const o in n)for(const i of n[o])i.includes(e)&&t.push(this._fonction_enchassee(o,i));for(const[,o]of this._groupes_enchasses)t.push(...o.fonction_detaillee(e));return t.sort((o,i)=>o[2]-o[1]>i[2]-i[1]?-1:1)}fonctionPos(e,t=-1){return t>=0&&d(h.Fonctions_multiples.includes(e),`fonctionPos:  ${e} n'est pas une fonction multiple`),e=="verbes"?this.verbes:h.Fonctions_multiples.includes(e)?(d(t>-1,`fonctionPos: numero_de_fonction doit être supérieur à -1 pour les fonctions multiples comme ${e}`),!(e in this._fonctions_multiples)||t>=this._fonctions_multiples[e].length?[]:this._fonctions_multiples[e][t]):e in this._fonctions_uniques?this._fonctions_uniques[e]:[]}declareFonction(e,t,n=-1){if(d(this.mots_valides(t),`declareFonction: ${t} ne correspond pas à une liste de mots valides.`),t=t.sort((o,i)=>o-i),e==="verbes"){this.verbes=t;return}if(h.Fonctions_multiples.includes(e)){let o=this._fonctions_multiples;e in o||(d(n<=0,`declareFonction: ${n} introuvable pour ${e}`),o[e]=[]),n===-1||n===o[e].length?o[e].push(t):(d(n<o[e].length,`declareFonction: ${n} introuvable pour ${e}`),o[e][n]=t)}else this._fonctions_uniques[e]=t}fonctionMots(e,t=-1){return t>=0&&(d(h.Fonctions_multiples.includes(e),`fonctionMots: ${e} n'est pas une fonction multiple`),d(e in this._fonctions_multiples,`fonctionMots: ${e} n'a pas été créé.`),d(t<this._fonctions_multiples[e].length,`fonctionMots: ${t} introuvable pour ${e}`)),this.fonctionPos(e,t).map(n=>this._phrase_cassee[n]).join(" ")}mots_valides(e){if(e.length>0){for(const t of e)if(!this._mots_pos.includes(t))return!1}return!0}_casseSyntagme(){this._phrase_cassee=this.phrase.split(h._separateur).filter(e=>e)}*groupes_enchasses(){for(let e of this._groupes_enchasses)yield e}};r(h,"Separateur","[ ,;:?!.'-]"),r(h,"_separateur",new RegExp(h.Separateur)),r(h,"Fonctions_multiples",["independante","complement_circonstanciel","modalisateur","auto-enonciative","connecteur","balise_textuelle","epithete","complement_du_nom","complement_du_pronom","complement_de_l_adjectif","apposition"]),r(h,"Fonctions_contenants",["independante","sujet","cod","coi","attribut_du_sujet","attribut_du_cod","complement_circonstanciel","complement_du_verbe_impersonnel","complement_du_nom","complement_du_pronom","epithete","apposition","complement_de_l_adjectif"]);let j=h;class x extends j{constructor(e,t=[]){super(e,t)}static reviver(e,t){return e===""?x.fromJSON(t):t}static fromJSON(e){if(typeof e=="string")return JSON.parse(e,x.reviver);{let t=Object.create(x.prototype);const n=typeof e._groupes_enchasses>"u"?new Map:new Map(Object.entries(e._groupes_enchasses).map(i=>[i[1][0],x.fromJSON(i[1][1])]));let o=Object.assign(t,e,{_groupes_enchasses:n});return o._remplit_les_vides(),o}}cree_groupe_enchasse(e,t,n){const o=new x(this.contenu,e);return this._groupes_enchasses.set([t,n],o),o._denomination=[t,n],o._parent=this,o}groupe_enchasse(e,t){return super.groupe_enchasse(e,t)}aFonction(e){if(j.Fonctions_multiples.includes(e))return e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>!w(n,[])).length>0:!1;const t=this.fonctionPos(e);return!w(t,[])}aFonctions(e){for(let t of e)if(!this.aFonction(t))return!1;return!0}estFonction(e,t){return t=t.sort((n,o)=>n-o),j.Fonctions_multiples.includes(e)?e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>w(n,t)).length>0:!1:w(this.fonctionPos(e),t)}*groupes_enchasses(){for(let e of this._groupes_enchasses)yield e}}class y extends j{constructor(e,t){super(e,t.mots_pos),this._corrige=t,this._corrige=t}cree_groupe_enchasse_eleve(e,t,n){const o=new y(this.contenu,e);return this._groupes_enchasses.set([t,n],o),o._denomination=[t,n],o._parent=this,o}get corrige(){return this._corrige}est_complet(e){const t=this.corrige.fonctions_multiples_nombre(e);if(t!==this.fonctions_multiples_nombre(e))return!1;const n=this._fonctions_multiples[e];for(let o=0;o<t;o++){const i=this.corrige.fonctionPos(e,o);if(n.filter(u=>w(u,i)).length===0)return!1}return!0}est_correct(e,t=-1){return j.Fonctions_multiples.includes(e)?(d(e in this._fonctions_multiples,`${e} n'a jamais été enregistré dans ce syntagme`),d(t<this._fonctions_multiples[e].length,`Pas de numero ${t} pour la fonction ${e} dans ce syntagme`),this.corrige.estFonction(e,this._fonctions_multiples[e][t])):e==="verbes"?this.corrige.estFonction(e,this.verbes):(d(e in this._fonctions_uniques,`${e} n'a pas été enregistré dans ce syntagme`),this.corrige.estFonction(e,this._fonctions_uniques[e]))}declare(e,t,n=-1){return j.Fonctions_multiples.includes(e)&&e in this._fonctions_multiples&&this._fonctions_multiples[e].filter(o=>w(o,t)).length!==0?!1:(this.declareFonction(e,t,n),this.corrige.estFonction(e,t))}}Array();let m={fonction_de_validation:()=>{console.log("Problème: la fonction de validation n'a pas été mise en place")},ok:()=>{console.log("Aucune fonction définie pour OK")},annuler:()=>{console.log("Aucune fonction définie pour Annuler")},fonction_du_bouton_de_message:()=>console.log("Fonction du bouton de message non mise en place")};const J={Indépendante:"independante",Verbes:"verbes","Verbe noyau":"verbe_noyau",Sujet:"sujet",COD:"cod",COI:"coi","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Complément d'agent":"complement_d_agent","Groupe verbal":"groupe_verbal","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Noyau:"noyau",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition","Complément de l'adjectif":"complement_de_l_adjectif"},pe=Object.fromEntries(Object.entries(J).map(s=>s.reverse()));function C(s,e,t,n=!1){const o=l("modal-message"),i=l("modal-message-contenu-texte"),a=l("modal-message-bouton"),u=l("modal-croix");i.innerHTML=s,a.innerHTML=e,o.style.display="block",n&&(u.style.display="block"),m.fonction_du_bouton_de_message=()=>{E(l("modal-message-contenu"),o),n&&(u.style.display="none"),t()},m.ok=m.fonction_du_bouton_de_message}function Q(s,e){return["sujet","groupe_verbal"].includes(s)?e?"[":"]":""}function _e(s,e){if(e==s[1]||s[0]==="verbes"){const t=Q(s[0],!0),n=pe[s[0]];return`${t}<span groupe class="groupe-de-mots phrase-${s[0]}"><span class="affichage-nom-fonction affichage-${s[0]}">${n}</span>`}return""}function me(s,e){return e==s[2]||s[0]==="verbes"?`</span>${Q(s[0],!1)}`:""}function D(s,e=[]){const t=s.ancetre,n=new RegExp("("+y.Separateur+")"),o=t.contenu.split(n);let i=0,a=[];for(const u of o){if(y.Separateur.includes(u)){a.push(u);continue}const c=t.fonction_detaillee(i);c.forEach(_=>a.push(_e(_,i)));const p=e.includes(i)?'class="phrase-cliquable"':'class="phrase-non-cliquable"';a.push(`<span ${p} id="phrase-mot-${i}">${u}</span>`),c.forEach(_=>a.push(me(_,i))),i+=1}return a.join("")}function P(s){const e=X(s);s.style.lineHeight=`${1.8+e/10}`,Y(s,e),U(s)}function U(s){for(let e=0;e<s.children.length;e++){let t=s.children[e];if(t.hasAttribute("groupe")){const n=q(t.querySelector(".affichage-nom-fonction")),o=window.getComputedStyle(n).font,i=ue(n.innerText,o);let a=parseInt(window.getComputedStyle(t).borderWidth);a===0&&(a=parseInt(window.getComputedStyle(t).borderLeftWidth));const u=i+a*2-t.offsetWidth;t.style.paddingRight=`${u}px`;const c=n.innerText==="Indépendante"?68:74,p=parseInt(t.style.paddingBottom),_=n.innerText==="Indépendante"?23:28;n.style.top=`${c+p-_}px`,U(t)}}}function X(s){let e=1;for(let t=0;t<s.children.length;t++){let n=s.children[t];n.hasAttribute("groupe")&&(e=Math.max(e,X(n)+1))}return e}function Y(s,e){for(let t=0;t<s.children.length;t++){let n=s.children[t];n.hasAttribute("groupe")&&(n.style.padding=`0px 0px ${e*10}px`,Y(n,e-1))}}function V(s,e){const t=e.arbre_genealogique;if(t.length===1)return s;const n={independante:"l'indépendante",verbes:"Verbes",verbe_noyau:"Verbe noyau",sujet:"le sujet",cod:"le COD",coi:"le COI",attribut_du_sujet:"l'attribut du sujet",attribut_du_cod:"l'attribut du COD",complement_du_verbe_impersonnel:"le complément du verbe impersonnel",complement_d_agent:"le complément d'agent",groupe_verbal:"le groupe verbal",complement_circonstanciel:"le complément circonstanciel",modalisateur:"le modalisateur","auto-enonciative":"la fonction auto-énonciative",connecteur:"le connecteur",balise_textuelle:"la balise textuelle",noyau:"Noyau",epithete:"l'épithète",complement_du_nom:"le complément du nom",complement_du_pronom:"le complément du pronom",apposition:"l'apposition",complement_de_l_adjectif:"le complément de l'adjectif"};return t.slice(1).map(o=>"Dans "+(o[1]===-1?n[o[0]]:`${n[o[0]]} numéro ${o[1]+1}`)).join(" > ")+" : "+s}const de={Sujet:"sujet","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},he={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},fe={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ge={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},be={"Complément de l'adjectif":"complement_de_l_adjectif",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ve={"Complément de l'adjectif":"complement_de_l_adjectif",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ye={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},xe={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},je={Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},Le={"Complément de l'adjectif":"complement_de_l_adjectif",Noyau:"noyau"},Ce={Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},we={Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},$e={"Complément de l'adjectif":"complement_de_l_adjectif",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},Ee={Noyau:"noyau",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},qe={independante:de,sujet:he,cod:fe,coi:ge,attribut_du_sujet:be,attribut_du_cod:ve,complement_d_agent:ye,complement_circonstanciel:xe,complement_du_verbe_impersonnel:je,epithete:Le,complement_du_nom:Ce,complement_du_pronom:we,apposition:$e,complement_de_l_adjectif:Ee};let N=()=>console.log("Problème: aucune fonction définie pour le bouton OK de la nouvelle phrase"),Z=()=>console.log("Problème: aucune fonction définie pour la validation de la nouvelle phrase"),ee=s=>console.log("Aucune fonction définie pour le sélecteur"),S=()=>(console.log("Problème: enregistre_fonction n'a pas été instancié"),new T("vide")),L=()=>console.log("Problème: aucune fonction définie pour le bouton OK des ajouts de manipulations");function Oe(){l("modal-nouvelle_phrase-bouton").addEventListener("click",()=>{N()}),l("bouton-valider-phrase").addEventListener("click",()=>{Z()}),l("nouvelle_phrase-fonctions-selection").addEventListener("click",s=>{ee(s)}),l("ajout-manipulations-form").addEventListener("submit",s=>{s.preventDefault(),L()})}class Ae{constructor(e,t,n,o,i=-1,a){r(this,"validee",!1);r(this,"est_multiple",!1);this.nom_de_base=e,this.fonction=t,this.html_node=n,this.syntagme=o,this.numero=i,this.parent=a,this.est_multiple=i>-1}get nom(){return this.numero>-1?`${this.nom_de_base}-${this.numero+1}`:this.nom_de_base}get arbre_genealogique(){return typeof this.parent>"u"?this.nom:`${this.parent.arbre_genealogique} > ${this.nom}`}get id_sous_menu(){const e=this.numero===-1?"":`-${this.numero}`,t=`${this.fonction}${e}`;return typeof this.parent>"u"?t:`${this.parent.id_sous_menu}-${t}`}}class T{constructor(e){r(this,"_phrase");r(this,"_traceur",[]);r(this,"_pos",0);r(this,"_selecteur",l("nouvelle_phrase-fonctions-selection"));this._phrase=new y(e,new x(e)),this._selecteur.innerHTML="",Object.entries(J).forEach(t=>this.ajouter_fonction_tracee(this._traceur.length,t[0],t[1])),this._selecteur.style.display="block"}static contenus_possibles(e){return qe[e]}set pos(e){this.fonction_courante.html_node.classList.remove("selectionne"),d(e<this._traceur.length,`${e} est plus grand que la longueur du traceur: ${this._traceur.length}.`),this._pos=e,this.fonction_courante.html_node.classList.add("selectionne")}get pos(){return this._pos}get fonction_courante(){return this._traceur[this._pos]}set_pos_selecteur(e,t){for(let n of e.children)n.classList.contains("selecteur")||n.classList.contains("sous_menu")?t=this.set_pos_selecteur(n,t):(n.setAttribute("pos",t.toString()),t+=1);return t}ajouter_node_selecteur(e,t,n,o){for(let i of e.children)if(i.classList.contains("sous_menu")){if(n=this.ajouter_node_selecteur(i.children[1],t,n+1,o),n>o)return n}else{if(n===o&&i.insertAdjacentElement("beforebegin",t),n>o)return n;n+=1}return n===o?(e.appendChild(t),n+1):n}ajouter_fonction_tracee(e,t,n,o=this._phrase,i=-1,a){y.Fonctions_multiples.includes(n)&&i===-1&&(i=0),d(e<=this._traceur.length,`${e} est plus grand que la longueur du traceur`);let u=document.createElement("div");const c=new Ae(t,n,u,o,i,a);this._traceur.splice(e,0,c),u.setAttribute("value",c.fonction),u.setAttribute("class","selecteur-element"),u.innerHTML=c.nom,this.ajouter_node_selecteur(this._selecteur,u,0,e),this.set_pos_selecteur(this._selecteur,0)}retirer_enfants(e,t,n=!1){for(const[o,i]of this._traceur.entries())i.parent===e&&(t=this.retirer_enfants(i,t,!1),i.html_node.remove(),t.push(o));return n&&(this._traceur=this._traceur.filter((o,i)=>!t.includes(i)),this.set_pos_selecteur(this._selecteur,0)),t}gere_groupe_enchasse(e,t,n){if(!y.Fonctions_contenants.includes(this.fonction_courante.fonction))return;if(!e){if(n.syntagme.supprime_groupe_enchasse(n.fonction,n.numero)){const c=l(`sous_menu-${n.id_sous_menu}`);c.insertAdjacentElement("beforebegin",n.html_node),this.retirer_enfants(n,[],!0),c.remove()}return}let o=n.syntagme.cree_groupe_enchasse(t,n.fonction,n.numero),i=document.createElement("div");i.setAttribute("class","sous_menu"),i.setAttribute("id",`sous_menu-${n.id_sous_menu}`),this.fonction_courante.html_node.insertAdjacentElement("beforebegin",i),i.insertAdjacentElement("afterbegin",this.fonction_courante.html_node);let a=document.createElement("div");a.setAttribute("class","selecteur sous_menu_contenu"),this.fonction_courante.html_node.insertAdjacentElement("afterend",a);let u=this._pos+1;Object.entries(T.contenus_possibles(this.fonction_courante.fonction)).forEach(c=>{this.ajouter_fonction_tracee(u,c[0],c[1],o,-1,n),u+=1}),i.addEventListener("mouseenter",()=>{a.style.display="block"}),i.addEventListener("mouseleave",()=>{a.style.display="none"})}valide_fonction(e){const t=this.fonction_courante;return t.validee=e,e?t.html_node.classList.add("valide"):t.html_node.classList.remove("valide"),e}analyse_de_fonction(e=-1){e===-1?e=this._pos:this.pos=e;const t=this.fonction_courante.fonction,n=this.fonction_courante.syntagme,o=()=>{const a={groupe_verbal:"verbes verbe_noyau cod coi attribut_du_sujet attribut_du_cod complement_du_verbe_impersonnel".split(" "),verbes:"verbe_noyau groupe_verbal".split(" "),verbe_noyau:"verbes groupe_verbal".split(" "),cod:["groupe_verbal","verbes"],coi:["groupe_verbal","verbes"],attribut_du_sujet:["groupe_verbal","verbes"],attribut_du_cod:["groupe_verbal","verbes"],complement_du_verbe_impersonnel:["groupe_verbal","verbes"]};return t in a?a[t].map(u=>n.fonctionPos(u)).flat().concat(n.mots_sans_fonction).concat(n.fonctionPos(t,this.fonction_courante.numero)):(console.debug("Intégration des mots sans fonction et de la fonction courante dans les mots qu'on peut sélectionner",t),n.mots_sans_fonction.concat(n.fonctionPos(t,this.fonction_courante.numero)).concat(n.fonctionPos("verbes")))};l("phrase-analyse-paragraphe").innerHTML=D(this._phrase,o()),P(l("phrase-analyse-paragraphe")),l("consigne-container").innerHTML=`À renseigner : ${this.fonction_courante.arbre_genealogique}`;const i=n.fonctionPos(t,this.fonction_courante.numero);Array.from(document.getElementsByClassName("phrase-cliquable")).forEach(a=>{i.includes(Number(a.id.split("-")[2]))&&a.classList.add("phrase-selectionne")}),S=()=>{const a=Array.from(document.getElementsByClassName("phrase-selectionne")).map(c=>Number(c.id.split("-")[2]));if(this.fonction_courante.est_multiple&&this._phrase.fonctions_multiples_nombre(t)===this.fonction_courante.numero){if(a.length===0)return this;this.ajouter_fonction_tracee(e+1,this.fonction_courante.nom_de_base,t,n,this.fonction_courante.numero+1)}n.declareFonction(t,a,this.fonction_courante.numero);const u=this.valide_fonction(a.length>0);return this.gere_groupe_enchasse(u,a,this.fonction_courante),this.elements_de_manipulation(u),this},Z=async()=>{let a=this._phrase.contenu.replaceAll(" ","_").replace(j.separateur,"").toLowerCase();a=a.length>40?a.slice(0,37)+"...":a;const u=`${a}.v0.10.0.json`;await this.verification_verbes_sans_sujet(this._phrase);const c=new Blob([JSON.stringify(S()._phrase)],{type:"text/json"}),p=document.createElement("a");p.download=u,p.href=window.URL.createObjectURL(c),p.dataset.downloadurl=["text/json",p.download,p.href].join(":");const _=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});p.dispatchEvent(_),p.remove(),te()},m.fonction_de_validation=()=>{S(),this.analyse_de_fonction(e+1)},m.ok=m.fonction_de_validation}manipulation_titre(e){let t;switch(this.fonction_courante.fonction){case"sujet":t="sujet";break;case"cod":t="COD";break;case"groupe_verbal":t="Groupe Verbal";break;case"coi":t="COI";break;default:throw this.fonction_courante.fonction}return l("modal-ajout-manipulations-titre").innerHTML=`Renseignements nécessaires à la manipulation du ${t} : ${e}`,t}cree_fieldset(e,t){return`<fieldset class="ajout-manipulations-cadre">
                    <legend class="ajout-manipulations-cadre-titre">${e}</legend>
                    <div class="ajout-manipulations-cadre-contenu">${t}</div>
                </fieldset>`}cree_select(e,t,n){const o=t.split(",").map(a=>`<option name=${n} value=${a.toLowerCase()}>${a}</option>`).join(" "),i=`<select name="ajout-manipulations-contenu-${n}" class="manipulation-select">
        ${o}</select>
        `;return this.cree_fieldset(e,i)}cree_liste_preposions_coi(e){const t=e.split(" ");let n="à,de,";return t.length>=1&&(n+=t[0]),t.length>=2&&(n+=`,${t[0]} ${t[1]}`),t.length>=3&&(n+=`,${t[0]} ${t[1]} ${t[2]}`),n}recupere_valeur_select(e){return Array.from(document.getElementsByName(e)).filter(t=>t.selected)[0].getAttribute("value")}elements_de_manipulation_verbes(e,t){l("modal-ajout-manipulations").style.display="block",l("modal-ajout-manipulations-titre").innerHTML=`Rentrer les informations nécessaires à la validation d'un verbe sans sujet: ${t}`,l("ajout-manipulations-form-contenu").innerHTML=this.cree_select("Sujet","tu,nous,vous,je,j',il,elle,ils,elles","manipulation-verbe-sans-sujet"),L=()=>{const n=this.recupere_valeur_select("manipulation-verbe-sans-sujet");e.ajoute_infos_de_manipulation("verbe_noyau",{pronominalisation:n}),console.log("manip inside",e.infos_de_manipulation("verbe_noyau")),l("modal-ajout-manipulations").style.display="none"},m.ok=L}async verification_verbes_sans_sujet(e){e.fonctionPos("verbe_noyau").length>0&&e.fonctionPos("sujet").length===0&&(this.elements_de_manipulation_verbes(e,e.fonctionMots("verbe_noyau")),await new Promise((n,o)=>{const i=L;L=()=>{i(),n()}}).then(()=>console.debug("Promise fulfilled")));for(let[t,n]of e.groupes_enchasses())await this.verification_verbes_sans_sujet(n)}elements_de_manipulation(e){if(e&&"sujet cod coi groupe_verbal".split(" ").includes(this.fonction_courante.fonction)){const t=Array.from(document.getElementsByClassName("phrase-selectionne")).map(i=>i.innerHTML).join(" "),n=this.manipulation_titre(t);l("modal-ajout-manipulations").style.display="block";let o=this.fonction_courante;if("sujet cod coi".split(" ").includes(this.fonction_courante.fonction)){let i;switch(n){case"sujet":i="je j' tu il elle nous vous ils elles ce c'";break;case"COD":i="me m' te t' le la l' nous vous les en";break;case"COI":i="me m' te t' elle lui nous vous leur en y";break;default:throw n}i=i.split(" ");const a=i.includes(t.toLowerCase())?`<input type="hidden" id="pronom-inutile" name="${n}-pronoms" value="null" checked="true">`:`<fieldset class="ajout-manipulations-cadre"><legend class="ajout-manipulations-cadre-titre">Par quoi le ${n} peut-il être pronominalisé ?</legend>`+i.map(c=>`<label class="ajout-manipulations-label" for="pronom-${c}">${c}<input type="radio" class="pronoms" id="pronom-${c}" name="${n}-pronoms" value="${c}" required><span class="ajout-manipulations-radio"></span></label class="ajout-manipulations-label">`).join(" ")+"</fieldset>",u=this.fonction_courante.fonction!=="coi"?"":this.cree_select("Par quelle préposition commence la question pour trouver le COI ?",this.cree_liste_preposions_coi(t),"manipulation-preposition-coi");l("ajout-manipulations-form-contenu").innerHTML=`<fieldset class="ajout-manipulations-cadre"><legend class="ajout-manipulations-cadre-titre">Animé ou non-animé ?</legend><label class="ajout-manipulations-label" for="est-anime">Le référent du ${n} est animé.<input type="radio" id="est-anime" value="true" name="${n}-anime" required><span class="ajout-manipulations-radio"></span></label class="ajout-manipulations-label"><label class="ajout-manipulations-label" for="est-non-anime">Le référent du ${n} est non animé.<input type="radio" id="est-non-anime" value="false" name="${n}-anime" required><span class="ajout-manipulations-radio"></span></label class="ajout-manipulations-label"></fieldset>`+u+a,L=()=>{const c=document.getElementsByName(`${n}-anime`)[0].checked;let p=Array.from(document.getElementsByName(`${n}-pronoms`)).filter(_=>_.checked)[0].getAttribute("value");p==="null"&&(p=null),o.syntagme.ajoute_infos_de_manipulation(o.fonction,(()=>o.fonction==="coi"?{est_anime:c,pronominalisation:p,preposition:this.recupere_valeur_select("manipulation-preposition-coi")}:{est_anime:c,pronominalisation:p})()),l("modal-ajout-manipulations").style.display="none"}}else o.fonction==="groupe_verbal"&&(l("ajout-manipulations-form-contenu").innerHTML=this.cree_select("Verbe pouvant remplacer le groupe verbal","fais,fait,faisons,faites,font","manipulation-verbe"),L=()=>{const i=this.recupere_valeur_select("manipulation-verbe");o.syntagme.ajoute_infos_de_manipulation("groupe_verbal",{verbe:i}),l("modal-ajout-manipulations").style.display="none"});m.ok=L}}}function te(){for(const n of q(document.getElementsByClassName("modal")))n.style.display="none";const s=l("modal-nouvelle-phrase");s.style.display="block",l("nouvelle_phrase-texterea").focus();const e=l("bouton-valider");e.style.width="50%",e.innerHTML="Valider la fonction";const t=l("bouton-valider-phrase");t.style.display="block",N=()=>{let n=l("nouvelle_phrase-texterea").value;if(n.trim()==="")return;n=n.replace(`
`,"");let o=new T(n);s.style.display="none",o.analyse_de_fonction(0),ee=i=>{const a=i.target;S();const u=()=>{let c=a.getAttribute("pos");return typeof c=="string"?parseInt(c):(d(!1,"la valeur de l'attribut est nulle."),-1)};o.analyse_de_fonction(u()),Array.from(document.getElementsByClassName("sous_menu_contenu")).map(c=>c.style.display="none")}},m.ok=N}function Me(){l("conseil").innerHTML="";const s=l("bouton-valider");s.style.width="100%",s.innerHTML="Valider";const e=l("bouton-valider-phrase");e.style.display="none",l("nouvelle_phrase-fonctions-selection").innerHTML=""}const ke=[{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[2],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{verbe_noyau:[2],sujet:[0,1],attribut_du_sujet:[3,4,5]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[0,1]}],[["attribut_du_sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{noyau:[5]},_fonctions_multiples:{epithete:[[4]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[4]}]],_manipulations:{},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[3,4,5]}]],_manipulations:{sujet:{est_anime:!1,pronominalisation:"elle"},groupe_verbal:{verbe:"fait"}},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[0,1,2,3,4,5]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[0],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{verbe_noyau:[0],cod:[2,3],coi:[1],groupe_verbal:[0,1,2,3]},_fonctions_multiples:{complement_circonstanciel:[[4]]},_groupes_enchasses:[[["cod",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[2,3]}],[["coi",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[1]}],[["complement_circonstanciel",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[4]}]],_manipulations:{cod:{est_anime:!1,pronominalisation:"la"},coi:{est_anime:!0,pronominalisation:"me",preposition:"à"},groupe_verbal:{verbe:"faites"},verbe_noyau:{pronominalisation:"vous"}},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[0,1,2,3,4]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{independante:[[0,1,2,3,4],[6,7,8,9]]},_groupes_enchasses:[[["independante",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{sujet:[0,1,2,3],verbe_noyau:[4],groupe_verbal:[4]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{noyau:[2]},_fonctions_multiples:{epithete:[[1],[3]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[1]}],[["epithete",1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[3]}]],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[0,1,2,3]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"},groupe_verbal:{verbe:"fait"}},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[0,1,2,3,4]}],[["independante",1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{sujet:[6,7,8],verbe_noyau:[9],groupe_verbal:[9]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{noyau:[8]},_fonctions_multiples:{epithete:[[7]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[7]}]],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[6,7,8]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"},groupe_verbal:{verbe:"fait"}},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[6,7,8,9]}]],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[0,1,2,3,4,5,6,7,8,9]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[4,5],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{verbe_noyau:[4,5],sujet:[0,1,2,3],cod:[6,7,8,9,10,11],groupe_verbal:[4,5,6,7,8,9,10,11]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{noyau:[1]},_fonctions_multiples:{complement_du_nom:[[2,3]]},_groupes_enchasses:[[["complement_du_nom",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[2,3]}]],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[0,1,2,3]}],[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[0,1,2,3]}],[["cod",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{noyau:[7]},_fonctions_multiples:{apposition:[[8,9,10,11]]},_groupes_enchasses:[[["apposition",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{noyau:[9]},_fonctions_multiples:{complement_du_nom:[[10,11]]},_groupes_enchasses:[[["complement_du_nom",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[10,11]}]],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[8,9,10,11]}]],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[6,7,8,9,10,11]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"},cod:{est_anime:!0,pronominalisation:"l'"},groupe_verbal:{verbe:"fait"}},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[0,1,2,3,4,5,6,7,8,9,10,11]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[3,5,14],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{verbe_noyau:[3,5],sujet:[0,1,2],cod:[6,7],groupe_verbal:[3,5,6,7]},_fonctions_multiples:{complement_circonstanciel:[[8,9,10],[11,12,13,14],[4]]},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{noyau:[2]},_fonctions_multiples:{epithete:[[1]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[1]}]],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[0,1,2]}],[["cod",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[6,7]}],[["complement_circonstanciel",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[8,9,10]}],[["complement_circonstanciel",1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[11,12,13,14]}],[["complement_circonstanciel",2],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[4]}],[["complement_circonstanciel",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[8,9,10]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"},cod:{est_anime:!1,pronominalisation:"l'"},groupe_verbal:{verbe:"fait"}},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]}],Se=ke.map(s=>x.fromJSON(s));function Te(s,e=0){return Se.slice(e,e+s)}function b(s,e){return`<fieldset class="manipulation-element">
                <legend class="manipulation-element-titre">${s}</legend>
                <span class="manipulation-element-contenu">${e}</span>
            </fieldset>`}function G(s,e){const t=s.offset_pos(e);let n="";for(let o=0,i=0;o<s.contenu.length;o++)o===t[i][0]?n+='<span class="manipulation-supprimable">':o===t[i][1]&&(n+="</span>",i<t.length-1&&i++),n+=s.contenu[o];return b("Suppression",n)}function Fe(s,e){const t=s.offset_pos(e),n='<span class="manipulation-deplacement-dropzone"> </span>';let o=n;for(let i=0,a=0;i<s.contenu.length;i++){if(i===t[a][0])o+='<span draggable="true" class="manipulation-deplacable" id="manipulation-deplacable"><span> </span> ';else if(i===t[a][1])o+="<span> </span></span>",a<t.length-1&&a++;else if(s.contenu[i]===" "&&(i<t[a][0]||i>=t[a][1])){o+=n;continue}o+=s.contenu[i]}return o+=n,b("Déplacement",o)}function De(){const s=()=>{l("manipulation-deplacable").addEventListener("dragstart",t=>{if(t.dataTransfer!==null)t.dataTransfer.setData("text/plain",t.target.id),t.dataTransfer.dropEffect="move";else throw t})},e=t=>{t.addEventListener("dragenter",()=>{t.classList.add("manipulation-dropzone-hover")}),t.addEventListener("dragleave",()=>{t.classList.remove("manipulation-dropzone-hover")}),t.addEventListener("dragover",n=>{const o=n;if(o.dataTransfer===null)throw Error("Pas de données transférées");o.preventDefault(),o.dataTransfer.dropEffect="move"}),t.addEventListener("drop",n=>{const o=n;if(o.dataTransfer===null)throw Error("Pas de données transférées");o.preventDefault();const i=l(o.dataTransfer.getData("text/plain"));let a=o.target;a.classList.remove("manipulation-dropzone-hover"),a.classList.add("manipulation-dropzone-dropped");const u=a.outerHTML;a.outerHTML=i.outerHTML,i.outerHTML=u,l("manipulation-deplacable").classList.add("manipulation-deplace");const c=q(document.querySelector(".manipulation-dropzone-dropped"));e(c),c.classList.remove("manipulation-dropzone-dropped"),s()})};for(const t of document.getElementsByClassName("manipulation-deplacement-dropzone"))s(),e(t)}function M(s){if(s.corrige.aFonction("sujet"))return s.fonction_texte_pos("sujet");if(s.corrige.aFonction("verbe_noyau")){const e=s.corrige.infos_de_manipulation("verbe_noyau").pronominalisation;if(typeof e!="string")throw new Error("Impossible de trouver le sujet");return e}return""}function Pe(s,e,t){const n=l("modal-manipulations");n.style.display="block";const o={sujet:"le sujet",attribut_du_sujet:"l'attribut du sujet",cod:"le COD",coi:"le COI",groupe_verbal:"le groupe verbal",complement_circonstanciel:"le complément circonstanciel"}[s];l("modal-manipulations-titre").innerHTML=`Manipule ${o} pour vérifier ta réponse.`,l("manipulable").innerHTML=e.texte_pos(t),l("manipulable").style.visibility="visible";const i=e.fonction_texte_pos("verbe_noyau"),a=`<span class="manipulation-drop-zone">Glisse ${o} ici</span>`,u=`
            <span class="manipulation-fleche">
    <svg fill="#000000" height="36px" width="100px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
             viewBox="0 0 476.213 476.213" xml:space="preserve">
    <polygon points="345.606,107.5 324.394,128.713 418.787,223.107 0,223.107 0,253.107 418.787,253.107 324.394,347.5 
            345.606,368.713 476.213,238.106 "/>
    </svg> </span>`;if(s==="sujet"){const c=" "+function(){return e.corrige.aFonction("attribut_du_sujet")?e.fonction_texte_pos("attribut_du_sujet"):e.corrige.aFonction("cod")?e.fonction_texte_pos("cod"):""}(),p=e.corrige.infos_de_manipulation("sujet"),_=p.est_anime?"Qui ":"Qu'",f="Je Tu Il Elle Nous Vous Ils Elles C' Ce".split(" ").map(g=>`<option value="${g.toLowerCase()}">${g}</option>`).join(" ");l("manipulations-form-contenu").innerHTML=`<fieldset class="manipulation-element"><legend class="manipulation-element-titre">Question</legend><span class="manipulation-element-contenu">${_}est-ce qui ${i}${c} ? ${a}</span></fieldset><fieldset class="manipulation-element"><legend class="manipulation-element-titre">Extraction</legend><span class="manipulation-element-contenu">C'est ${a} qui ${i}${c}. </span></fieldset>`+(p.pronominalisation===null?"":`<fieldset class="manipulation-element"><legend class="manipulation-element-titre">Pronominalisation</legend><span class="manipulation-element-contenu">${e.texte_pos(t)} ${i}${c}. ${u}
        <select name="pronoms"><option disabled selected value>--</option>${f}</select> ${i}${c}.</span></fieldset>`)}else if(s==="cod"){const c=M(e),p=e.corrige.aFonction("attribut_du_cod")?" "+e.fonction_texte_pos("attribut_du_cod"):"",f=e.corrige.infos_de_manipulation("cod").est_anime?"Qui ":"Qu'",g="le la l' les me m' te t' nous vous en".split(" ").map(A=>`<option value="${A.toLowerCase()}">${A}</option>`).join(" ");l("manipulations-form-contenu").innerHTML=b("Question",`${f}est-ce que ${c} ${i}${p} ? ${a}`)+b("Extraction",`C'est ${a} que ${c} ${i}${p}.`)+b("Pronominalisation",`${c} ${i} ${e.texte_pos(t)}${p} ${u} ${c} <select name="pronoms"><option disabled selected value>--</option>${g}</select> ${i}${p}.`)}else if(s==="coi"){const c=M(e),p=e.corrige.aFonction("cod")?" "+e.fonction_texte_pos("cod"):"",_=e.corrige.infos_de_manipulation("coi"),f=_.preposition,g=f+" "+_.est_anime?"qui ":"quoi",A="lui leur me m' te t' en y".split(" ").map(R=>`<option value="${R.toLowerCase()}">${R}</option>`).join(" ");l("manipulations-form-contenu").innerHTML=b("Question",`${c} ${i}${p} ${f} ${g} ? ${a}`)+b("Extraction",`C'est ${a} que ${c} ${i}${p}.`)+b("Pronominalisation",`${c} ${i}${p} ${f} ${e.texte_pos(t)} ${u} ${c} <select name="pronoms"><option disabled selected value>--</option>${A}</select> ${i}${p}.`)}else if(s==="groupe_verbal"){const c=M(e),_=e.corrige.infos_de_manipulation("groupe_verbal").verbe;l("manipulations-form-contenu").innerHTML=b("Question",`Que ${_} ${c} ? ${c} ${a}`)}else if(s==="attribut_du_sujet"){const c=M(e);l("manipulations-form-contenu").innerHTML=b("Question",`${c} ${i} quoi ? ${a}`)+G(e,t)}else s==="complement_circonstanciel"&&(l("manipulations-form-contenu").innerHTML=G(e,t)+Fe(e,t),De(),l("manipulable").style.visibility="collapse");for(let c of document.getElementsByClassName("manipulation-supprimable"))c.addEventListener("click",()=>{c.classList.remove("manipulation-supprimable"),c.classList.add("manipulation-supprime")});for(const c of document.getElementsByClassName("manipulation-drop-zone"))c.addEventListener("dragover",p=>{const _=p;if(_.dataTransfer===null)throw Error("Pas de données transférées");_.preventDefault(),_.dataTransfer.dropEffect="copy"}),c.addEventListener("drop",p=>{const _=p;if(_.dataTransfer===null)throw Error("Pas de données transférées");_.preventDefault();const f=l(_.dataTransfer.getData("text/plain")).innerHTML;let g=_.target;g.innerHTML=f,g.classList.add("manipulable-deplace"),g.classList.remove("manipulation-drop-zone")})}function Ne(){const s=t=>document.querySelectorAll(t).length,e=document.getElementsByName("pronoms");for(const t of e)if(t.value==="")return!1;return console.log(s(".manipulation-element-contenu"),s(".manipulable-deplace")),!(s(".manipulation-drop-zone")>0||document.querySelectorAll(".manipulation-deplacable").length!==document.querySelectorAll(".manipulation-deplace").length||s(".manipulation-supprimable")>0)}l("manipulable").addEventListener("dragstart",s=>{s.dataTransfer!==null&&(s.dataTransfer.setData("text/plain",s.target.id),s.dataTransfer.dropEffect="copy")});function F(s){return Math.abs(Math.floor(s))}function $(s,e){return Math.random()*(e-s)+s}function v(s,e){return Math.floor($(s,e+1))}function W(s,e,t,n){const o=Math.pow;return Math.sqrt(o(s-t,2)+o(e-n,2))}function z(s,e,t=1){if(s>360||s<0)throw new Error(`Expected hue 0-360 range, got \`${s}\``);if(e>100||e<0)throw new Error(`Expected lightness 0-100 range, got \`${e}\``);if(t>1||t<0)throw new Error(`Expected alpha 0-1 range, got \`${t}\``);return`hsla(${s}, 100%, ${e}%, ${t})`}const K=s=>{if(typeof s=="object"&&s!==null){if(typeof Object.getPrototypeOf=="function"){const e=Object.getPrototypeOf(s);return e===Object.prototype||e===null}return Object.prototype.toString.call(s)==="[object Object]"}return!1},ze=["__proto__","constructor","prototype"],ne=(...s)=>s.reduce((e,t)=>(Object.keys(t).forEach(n=>{ze.includes(n)||(Array.isArray(e[n])&&Array.isArray(t[n])?e[n]=t[n]:K(e[n])&&K(t[n])?e[n]=ne(e[n],t[n]):e[n]=t[n])}),e),{});function Ie(s,e){let t;return(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>s(...n),e)}}class He{constructor({x:e,y:t,ctx:n,hue:o,decay:i,gravity:a,friction:u,brightness:c,flickering:p,lineWidth:_,explosionLength:f}){r(this,"x");r(this,"y");r(this,"ctx");r(this,"hue");r(this,"friction");r(this,"gravity");r(this,"flickering");r(this,"lineWidth");r(this,"explosionLength");r(this,"angle");r(this,"speed");r(this,"brightness");r(this,"coordinates",[]);r(this,"decay");r(this,"alpha",1);for(this.x=e,this.y=t,this.ctx=n,this.hue=o,this.gravity=a,this.friction=u,this.flickering=p,this.lineWidth=_,this.explosionLength=f,this.angle=$(0,Math.PI*2),this.speed=v(1,10),this.brightness=v(c.min,c.max),this.decay=$(i.min,i.max);this.explosionLength--;)this.coordinates.push([e,t])}update(e){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&e()}draw(){const e=this.coordinates.length-1;this.ctx.beginPath(),this.ctx.lineWidth=this.lineWidth,this.ctx.fillStyle=z(this.hue,this.brightness,this.alpha),this.ctx.moveTo(this.coordinates[e][0],this.coordinates[e][1]),this.ctx.lineTo(this.x,this.y),this.ctx.strokeStyle=z(this.hue,this.flickering?$(0,this.brightness):this.brightness,this.alpha),this.ctx.stroke()}}class Be{constructor(e,t){r(this,"active",!1);r(this,"x");r(this,"y");this.options=e,this.canvas=t,this.pointerDown=this.pointerDown.bind(this),this.pointerUp=this.pointerUp.bind(this),this.pointerMove=this.pointerMove.bind(this)}get mouseOptions(){return this.options.mouse}mount(){this.canvas.addEventListener("pointerdown",this.pointerDown),this.canvas.addEventListener("pointerup",this.pointerUp),this.canvas.addEventListener("pointermove",this.pointerMove)}unmount(){this.canvas.removeEventListener("pointerdown",this.pointerDown),this.canvas.removeEventListener("pointerup",this.pointerUp),this.canvas.removeEventListener("pointermove",this.pointerMove)}usePointer(e,t){const{click:n,move:o}=this.mouseOptions;(n||o)&&(this.x=e.pageX-this.canvas.offsetLeft,this.y=e.pageY-this.canvas.offsetTop,this.active=t)}pointerDown(e){this.usePointer(e,this.mouseOptions.click)}pointerUp(e){this.usePointer(e,!1)}pointerMove(e){this.usePointer(e,this.active)}}class Re{constructor(){r(this,"hue");r(this,"rocketsPoint");r(this,"opacity");r(this,"acceleration");r(this,"friction");r(this,"gravity");r(this,"particles");r(this,"explosion");r(this,"mouse");r(this,"boundaries");r(this,"sound");r(this,"delay");r(this,"brightness");r(this,"decay");r(this,"flickering");r(this,"intensity");r(this,"traceLength");r(this,"traceSpeed");r(this,"lineWidth");r(this,"lineStyle");r(this,"autoresize");this.autoresize=!0,this.lineStyle="round",this.flickering=50,this.traceLength=3,this.traceSpeed=10,this.intensity=30,this.explosion=5,this.gravity=1.5,this.opacity=.5,this.particles=50,this.friction=.95,this.acceleration=1.05,this.hue={min:0,max:360},this.rocketsPoint={min:50,max:50},this.lineWidth={explosion:{min:1,max:3},trace:{min:1,max:2}},this.mouse={click:!1,move:!1,max:1},this.delay={min:30,max:60},this.brightness={min:50,max:80},this.decay={min:.015,max:.03},this.sound={enabled:!1,files:["explosion0.mp3","explosion1.mp3","explosion2.mp3"],volume:{min:4,max:8}},this.boundaries={debug:!1,height:0,width:0,x:50,y:50}}update(e){Object.assign(this,ne(this,e))}}class Ve{constructor(e,t){r(this,"tick",0);r(this,"rafId",0);r(this,"fps",60);r(this,"tolerance",.1);r(this,"now");this.options=e,this.render=t}mount(){this.now=performance.now();const e=1e3/this.fps,t=n=>{this.rafId=requestAnimationFrame(t);const o=n-this.now;o>=e-this.tolerance&&(this.render(),this.now=n-o%e,this.tick+=o*(this.options.intensity*Math.PI)/1e3)};this.rafId=requestAnimationFrame(t)}unmount(){cancelAnimationFrame(this.rafId)}}class Ge{constructor(e,t,n){r(this,"resizer");this.options=e,this.updateSize=t,this.container=n}mount(){if(!this.resizer){const e=Ie(()=>this.updateSize(),100);this.resizer=new ResizeObserver(e)}this.options.autoresize&&this.resizer.observe(this.container)}unmount(){this.resizer&&this.resizer.unobserve(this.container)}}class We{constructor(e){r(this,"buffers",[]);r(this,"audioContext");r(this,"onInit",!1);this.options=e,this.init()}get isEnabled(){return this.options.sound.enabled}get soundOptions(){return this.options.sound}init(){!this.onInit&&this.isEnabled&&(this.onInit=!0,this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.loadSounds())}async loadSounds(){for(const e of this.soundOptions.files){const t=await(await fetch(e)).arrayBuffer();this.audioContext.decodeAudioData(t).then(n=>{this.buffers.push(n)}).catch(n=>{throw n})}}play(){if(this.isEnabled&&this.buffers.length){const e=this.audioContext.createBufferSource(),t=this.buffers[v(0,this.buffers.length-1)],n=this.audioContext.createGain();e.buffer=t,n.gain.value=$(this.soundOptions.volume.min/100,this.soundOptions.volume.max/100),n.connect(this.audioContext.destination),e.connect(n),e.start(0)}else this.init()}}class Ke{constructor({x:e,y:t,dx:n,dy:o,ctx:i,hue:a,speed:u,traceLength:c,acceleration:p}){r(this,"x");r(this,"y");r(this,"sx");r(this,"sy");r(this,"dx");r(this,"dy");r(this,"ctx");r(this,"hue");r(this,"speed");r(this,"acceleration");r(this,"traceLength");r(this,"totalDistance");r(this,"angle");r(this,"brightness");r(this,"coordinates",[]);r(this,"currentDistance",0);for(this.x=e,this.y=t,this.sx=e,this.sy=t,this.dx=n,this.dy=o,this.ctx=i,this.hue=a,this.speed=u,this.traceLength=c,this.acceleration=p,this.totalDistance=W(e,t,n,o),this.angle=Math.atan2(o-t,n-e),this.brightness=v(50,70);this.traceLength--;)this.coordinates.push([e,t])}update(e){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.acceleration;const t=Math.cos(this.angle)*this.speed,n=Math.sin(this.angle)*this.speed;this.currentDistance=W(this.sx,this.sy,this.x+t,this.y+n),this.currentDistance>=this.totalDistance?e(this.dx,this.dy,this.hue):(this.x+=t,this.y+=n)}draw(){const e=this.coordinates.length-1;this.ctx.beginPath(),this.ctx.moveTo(this.coordinates[e][0],this.coordinates[e][1]),this.ctx.lineTo(this.x,this.y),this.ctx.strokeStyle=z(this.hue,this.brightness),this.ctx.stroke()}}class Je{constructor(e,t={}){r(this,"target");r(this,"container");r(this,"canvas");r(this,"ctx");r(this,"width");r(this,"height");r(this,"traces",[]);r(this,"explosions",[]);r(this,"waitStopRaf");r(this,"running",!1);r(this,"opts");r(this,"sound");r(this,"resize");r(this,"mouse");r(this,"raf");this.target=e,this.container=e,this.opts=new Re,this.createCanvas(this.target),this.updateOptions(t),this.sound=new We(this.opts),this.resize=new Ge(this.opts,this.updateSize.bind(this),this.container),this.mouse=new Be(this.opts,this.canvas),this.raf=new Ve(this.opts,this.render.bind(this))}get isRunning(){return this.running}get version(){return"2.10.7"}get currentOptions(){return this.opts}start(){this.running||(this.canvas.isConnected||this.createCanvas(this.target),this.running=!0,this.resize.mount(),this.mouse.mount(),this.raf.mount())}stop(e=!1){!this.running||(this.running=!1,this.resize.unmount(),this.mouse.unmount(),this.raf.unmount(),this.clear(),e&&this.canvas.remove())}async waitStop(e){if(this.running)return new Promise(t=>{this.waitStopRaf=()=>{!this.waitStopRaf||(requestAnimationFrame(this.waitStopRaf),!this.traces.length&&!this.explosions.length&&(this.waitStopRaf=null,this.stop(e),t()))},this.waitStopRaf()})}pause(){this.running=!this.running,this.running?this.raf.mount():this.raf.unmount()}clear(){!this.ctx||(this.traces=[],this.explosions=[],this.ctx.clearRect(0,0,this.width,this.height))}launch(e=1){for(let t=0;t<e;t++)this.createTrace();this.waitStopRaf||(this.start(),this.waitStop())}updateOptions(e){this.opts.update(e)}updateSize({width:e=this.container.clientWidth,height:t=this.container.clientHeight}={}){this.width=e,this.height=t,this.canvas.width=e,this.canvas.height=t,this.updateBoundaries({...this.opts.boundaries,width:e,height:t})}updateBoundaries(e){this.updateOptions({boundaries:e})}createCanvas(e){e instanceof HTMLCanvasElement?(e.isConnected||document.body.append(e),this.canvas=e):(this.canvas=document.createElement("canvas"),this.container.append(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.updateSize()}render(){if(!this.ctx||!this.running)return;const{opacity:e,lineStyle:t,lineWidth:n}=this.opts;this.ctx.globalCompositeOperation="destination-out",this.ctx.fillStyle=`rgba(0, 0, 0, ${e})`,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalCompositeOperation="lighter",this.ctx.lineCap=t,this.ctx.lineJoin="round",this.ctx.lineWidth=$(n.trace.min,n.trace.max),this.initTrace(),this.drawTrace(),this.drawExplosion()}createTrace(){const{hue:e,rocketsPoint:t,boundaries:n,traceLength:o,traceSpeed:i,acceleration:a,mouse:u}=this.opts;this.traces.push(new Ke({x:this.width*v(t.min,t.max)/100,y:this.height,dx:this.mouse.x&&u.move||this.mouse.active?this.mouse.x:v(n.x,n.width-n.x*2),dy:this.mouse.y&&u.move||this.mouse.active?this.mouse.y:v(n.y,n.height*.5),ctx:this.ctx,hue:v(e.min,e.max),speed:i,acceleration:a,traceLength:F(o)}))}initTrace(){if(this.waitStopRaf)return;const{delay:e,mouse:t}=this.opts;(this.raf.tick>v(e.min,e.max)||this.mouse.active&&t.max>this.traces.length)&&(this.createTrace(),this.raf.tick=0)}drawTrace(){let e=this.traces.length;for(;e--;)this.traces[e].draw(),this.traces[e].update((t,n,o)=>{this.initExplosion(t,n,o),this.sound.play(),this.traces.splice(e,1)})}initExplosion(e,t,n){const{particles:o,flickering:i,lineWidth:a,explosion:u,brightness:c,friction:p,gravity:_,decay:f}=this.opts;let g=F(o);for(;g--;)this.explosions.push(new He({x:e,y:t,ctx:this.ctx,hue:n,friction:p,gravity:_,flickering:v(0,100)<=i,lineWidth:$(a.explosion.min,a.explosion.max),explosionLength:F(u),brightness:c,decay:f}))}drawExplosion(){let e=this.explosions.length;for(;e--;)this.explosions[e].draw(),this.explosions[e].update(()=>{this.explosions.splice(e,1)})}}const k=[["verbes","Sélectionne le ou les verbes."],["independante","Sélectionne une proposition indépendante"],["verbe_noyau","Sélectionne le verbe noyau"],["noyau","Sélectionne le noyau"],["sujet","Sélectionne le sujet"],["attribut_du_sujet","Sélectionne l'attribut du sujet."],["cod","Sélectionne le Complément d'objet direct (COD)."],["coi","Sélectionne le Complément d'objet indirect (COI)."],["attribut_du_cod","Sélectionne l'attribut du COD."],["complement_d_agent","Sélectionne le complément d'agent"],["complement_du_verbe_impersonnel","Sélectionne le complément du verbe impersonnel"],["groupe_verbal","Sélectionne le groupe verbal"],["complement_circonstanciel","Sélectionne un complément circonstanciel"],["complement_du_nom","Sélectionne un complément du nom"],["complement_du_pronom","Sélectionne un complément du pronom"],["epithete","Sélectionne une épithète"],["apposition","Sélectionne une apposition"],["complement_de_l_adjectif","Sélectionne un complément de l'adjectif"],["modalisateur","Sélectionne un modalisateur"],["auto-enonciative","Sélectionne une fonction auto-énonciative"],["connecteur","Sélectionne un connecteur"],["balise_textuelle","Sélectionne une balise textuelle"]];function oe(s){const e=l("bouton-valider");e.classList.replace("boutons-analyse-desactive","bouton-actif"),e.classList.add("boutons-analyse-valider");let t=new y(s.contenu,s);new I(t).analyse_fonction()}const O=class O{constructor(e){r(this,"_consignes_etape",0);r(this,"_fonctions_multiples_index",-1);r(this,"_groupes_enchasses_generateur");r(this,"_corrige");r(this,"_id");r(this,"_fonction_courante","sujet");r(this,"_mots_selectionnes",[]);this._syntagme=e,this._syntagme=e,this._corrige=e.corrige,this._groupes_enchasses_generateur=e.corrige.groupes_enchasses(),this._id=O.current_id++}get id(){return this._id}analyse_finie(){if(this._syntagme.arbre_genealogique.length===1){C('<div class="victoire" id="victoire"><h1>Bravo !</h1><div id="feu-d-artifice"></div></div>',"Commencer une autre analyse",se,!0);const t=l("feu-d-artifice");new Je(t,{autoresize:!1,mouse:{click:!0,move:!1,max:1}}).start()}const e=new Event(`AnalyseFinie-${this._id}`);document.dispatchEvent(e)}analyse_fonction(){if(this._fonction_courante=k[this._consignes_etape][0],console.log(`Nouvelle analyse: ${this._fonction_courante}`),!this._corrige.aFonction(this._fonction_courante)){this.analyse_suivante();return}y.Fonctions_multiples.includes(this._fonction_courante)&&this._fonctions_multiples_index===-1&&(this._fonctions_multiples_index=0);const e=k[this._consignes_etape][1]+(this._fonctions_multiples_index>=0?` (${this._fonctions_multiples_index+1})`:"");l("consigne-container").innerHTML=V(e,this._syntagme),l("phrase-analyse-paragraphe").innerHTML=D(this._syntagme,this._syntagme.mots_pos),P(l("phrase-analyse-paragraphe")),m.fonction_de_validation=()=>{this._mots_selectionnes=Array.from(document.getElementsByClassName("phrase-selectionne")).map(t=>Number(t.id.split("-")[2])),this._mots_selectionnes.length!==0&&(this._syntagme.declare(this._fonction_courante,this._mots_selectionnes,this._fonctions_multiples_index),this.manipule_fonction())},m.ok=m.fonction_de_validation,this.preselection()}preselection(){const e=this._syntagme.fonctionPos(this._fonction_courante,this._fonctions_multiples_index);Array.from(document.getElementsByClassName("phrase-cliquable")).forEach((t,n)=>{e.includes(n)&&t.classList.add("phrase-selectionne")})}async analyse_suivante(){if(this._consignes_etape===k.length-1){console.debug("Fin de l'analyse du syntagme");for(let[[e,t],n]of this._groupes_enchasses_generateur){if(console.debug(`Analyse d'un groupe enchâssé: ${e}`),n.vide){console.debug("Groupe enchâssé vide",e);continue}const o=new O(this._syntagme.cree_groupe_enchasse_eleve(n,e,t));await new Promise((a,u)=>{o.analyse_fonction(),document.addEventListener(`AnalyseFinie-${o.id}`,()=>{a()},{once:!0})}).then(()=>console.debug("promise ok"))}return l("consigne-container").innerHTML=V("L'analyse est terminée.",this._syntagme),l("phrase-analyse-paragraphe").innerHTML=D(this._syntagme,this._syntagme.mots_pos),P(l("phrase-analyse-paragraphe")),this.analyse_finie()}else{const e=y.Fonctions_multiples.includes(this._fonction_courante)&&!this._syntagme.est_complet(this._fonction_courante)?0:1;return this._fonctions_multiples_index=e===0?this._fonctions_multiples_index+1:-1,this._consignes_etape+=e,this.analyse_fonction()}}affiche_erreur(){const e=l("modal-message-contenu");e.classList.add("modal-message-erreur"),C("Il y a une erreur dans ton analyse !","Reprendre l'analyse",()=>{e.classList.remove("modal-message-erreur")})}soumettre_fonction(e,t){this._syntagme.est_correct(e,t)?this.analyse_suivante():this.affiche_erreur()}prepare_manipulation(e,t=!0){const n=this;return new Promise((o,i)=>{Pe(e,n._syntagme,n._syntagme.fonctionPos(e,this._fonctions_multiples_index));const a={once:!0},u=()=>{if(!Ne()){l("modal-manipulations-OK").addEventListener("click",u,a);return}t&&E(l("modal-manipulations-contenu"),l("modal-manipulations")),l("modal-manipulations-annuler").removeEventListener("click",c,a),o()},c=()=>{E(l("modal-manipulations-contenu"),l("modal-manipulations")),l("modal-manipulations-OK").removeEventListener("click",u,a),i()};l("modal-manipulations-OK").addEventListener("click",u,a),l("modal-manipulations-annuler").addEventListener("click",c,a),m.ok=u,m.annuler=c})}manipule_fonction(){const e=this,t=i=>k.map((a,u)=>[a[0],u]).filter(a=>a[0]===i)[0][1],n=()=>{this.prepare_manipulation(this._fonction_courante).then(()=>{e.soumettre_fonction(e._fonction_courante,e._fonctions_multiples_index)},()=>{e.analyse_fonction()})},o=i=>(this._corrige.aFonction("sujet")?this.prepare_manipulation("sujet",!1):new Promise(a=>{a()})).then(()=>e.prepare_manipulation(i),()=>{throw"sujet"}).then(()=>{e._corrige.aFonction("sujet")&&!e._syntagme.est_correct("sujet")?(e.affiche_erreur(),e._consignes_etape=t("sujet"),e.analyse_fonction()):e._syntagme.est_correct(i)?e.analyse_suivante():(e.affiche_erreur(),e._consignes_etape=t(i),e.analyse_fonction())},a=>{throw a!=="sujet"?i:a}).catch(a=>{if(a==="sujet")e._consignes_etape=t("sujet");else if(a===i)e._consignes_etape=t(i);else throw a;e.analyse_fonction()});if(this._fonction_courante==="sujet"){if(!this._corrige.aFonctions(["sujet","attribut_du_sujet"])&&!this._corrige.aFonctions(["sujet","cod"])){n();return}this.analyse_suivante();return}else if("coi groupe_verbal complement_circonstanciel".includes(this._fonction_courante)){n();return}else if("attribut_du_sujet cod".split(" ").includes(this._fonction_courante)){if(this._corrige.aFonction("attribut_du_cod"))return;o(this._fonction_courante);return}else if(this._fonction_courante==="attribut_du_cod"){o("cod").then(()=>{this.soumettre_fonction("attribut_du_cod",-1)});return}this.soumettre_fonction(this._fonction_courante,this._fonctions_multiples_index)}};r(O,"current_id",0);let I=O;function se(){const s=l("modal-choix-phrase");s.style.display="block";const e=Te(5,0),t=l("modal-choix-phrase-liste");t.innerHTML="";for(let n in e){const o=e[n],i=ce(t,"li",{id:`modal-choix-phrase-liste-${n}`});i.innerHTML=o.contenu,i.addEventListener("click",()=>{oe(e[n]),E(l("modal-choix-phrase-contenu"),s)})}}let H=!1;const B=l("phrase-analyse-paragraphe");B.addEventListener("mousedown",s=>{const e=s.target;s.button!=0||!e.classList.contains("phrase-cliquable")||(H=!0,e.classList.toggle("phrase-selectionne"))});B.addEventListener("mouseover",s=>{const e=s.target;H&&e.classList.contains("phrase-cliquable")&&e.classList.toggle("phrase-selectionne")});B.addEventListener("mouseup",s=>{H=!1});l("bouton-valider").addEventListener("click",()=>{m.fonction_de_validation()});document.onkeyup=function(s){switch(s.which){case 13:m.ok();break;case 27:m.annuler();break}};l("modal-message-bouton").addEventListener("click",()=>{m.fonction_du_bouton_de_message()});l("nouvelle_phrase").addEventListener("click",()=>{te()});l("analyse_fichier").addEventListener("click",()=>{for(const s of q(document.getElementsByClassName("modal")))s.style.display="none";Me(),l("modal-analyse-fichier").style.display="block"});function Qe(){if((()=>{var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window})()){const e=l("analyse_fichier_input_form");e.classList.add("has-advanced-upload"),l("analyse_fichier_bouton").style.display="none","drag dragstart dragend dragover dragenter dragleave drop".split(" ").forEach(t=>{e.addEventListener(t,n=>{n.preventDefault(),n.stopPropagation()})}),["dragover","dragenter"].forEach(t=>{e.addEventListener(t,()=>e.classList.add("is-dragover"))}),["dragleave","dragend","drop"].forEach(t=>{e.addEventListener(t,()=>e.classList.remove("is-dragover"))})}else l("analyse_fichier_input").classList.remove("box__file")}function ie(s){const e=new FileReader,t=()=>{E(l("modal-analyse-fichier-contenu"),l("modal-analyse-fichier"))};if(s.length==0)return t(),C("Pas de fichier chargé.","OK",()=>{});const n=s[0];if(!(n.type?n.type:"Introuvable").includes("json"))return t(),C("Format invalide","OK",()=>{});e.addEventListener("load",o=>{const i=e.result??"";if(typeof i!="string"||i==="")return t(),C("Fichier invalide","OK",()=>{});try{oe(x.fromJSON(i))}catch(a){return console.log(a),t(),a instanceof TypeError?C("Ce fichier n'est pas compatible avec la version actuelle du programme.","OK",()=>{}):C("Fichier invalide","OK",()=>{})}t()}),e.readAsText(n)}l("analyse_fichier_input").addEventListener("change",s=>{const e=s.target;ie(e.files)});l("analyse_fichier_input_form").addEventListener("drop",s=>{var e;ie((e=s.dataTransfer)==null?void 0:e.files)});l("modal-croix").addEventListener("click",s=>{E(l("modal-message-contenu"),l("modal-message")),l("modal-croix").style.display="none",m.fonction_de_validation=()=>{};const e=l("bouton-valider");e.classList.replace("boutons-analyse-valider","boutons-analyse-desactive"),e.classList.remove("bouton-actif")});Oe();se();Qe();
