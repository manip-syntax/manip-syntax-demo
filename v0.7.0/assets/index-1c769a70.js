var X=Object.defineProperty;var Y=(i,e,t)=>e in i?X(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var _=(i,e,t)=>(Y(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();function $(i,e){let t=i.length;if(t!=e.length)return!1;for(;t--;)if(i[t]!==e[t])return!1;return!0}function T(i){if(i===null)throw TypeError("elt is null");return i}function Z(i,e,t={}){let n=document.createElement(e);return i.appendChild(n),Object.entries(t).forEach(([o,s])=>n.setAttribute(o,s)),n}function q(i,e){i.classList.add("modal-contenu-animation-disparition");const t=()=>{e.style.display="none",i.classList.remove("modal-contenu-animation-disparition"),i.removeEventListener("animationend",t)};i.addEventListener("animationend",t)}function r(i){return T(document.getElementById(i))}function d(i,e){if(i===!1)throw Error(e)}const f=class{constructor(e,t=[]){_(this,"_denomination",["phrase",-1]);_(this,"_parent",null);_(this,"_phrase_cassee",[]);_(this,"verbes",[]);_(this,"_mots_offset",[]);_(this,"_fonctions_uniques",{});_(this,"_fonctions_multiples",{});_(this,"_groupes_enchasses",new Map);_(this,"_manipulations",{});_(this,"_fonction_enchassee",(e,t)=>[e,t[0],t.slice(-1)[0]]);this.phrase=e,this._mots_pos=t,this.phrase=e,this._casseSyntagme(),this._mots_pos=$(t,[])?[...Array(this._phrase_cassee.length).keys()]:t,this._remplit_mots_offset()}get ancetre(){if(this._denomination[0]==="phrase")return this;if(this._parent===null)throw d(this._parent!==null,"Pas de parent enregistré"),Error;return this._parent.ancetre}get contenu(){return this.phrase}get arbre_genealogique(){if(this._parent===null)return[this._denomination];let e=this._parent.arbre_genealogique;return e.push(this._denomination),e}get mots_sans_fonction(){return this._mots_pos.filter(e=>this.fonction(e).length===0)}get mots_pos(){return this._mots_pos}set contenu(e){this.phrase=e}_remplit_mots_offset(){let e=new RegExp(f.Separateur,"g");const t=[];let n=0,o;for(;(o=e.exec(this.contenu))!==null;)o.index>n&&t.push([n,o.index]),n=o.index+o[0].length;return n<this.contenu.length&&t.push([n,this.contenu.length]),this._mots_offset=t,t}offset_pos(e){let t=[];for(let n=0,o=0,s=0,a=-1;n<this._mots_offset.length;n++)e.includes(n)?(a===n-1?(s=this._mots_offset[n][1],n===this._mots_offset.length-1&&t.push([o,s])):([o,s]=this._mots_offset[n],n===this._mots_offset.length-1&&t.push([o,s])),a=n):s>0&&a===n-1&&t.push([o,s]);return t}texte_pos(e){let t="";for(let n=0,o=0,s=0,a=-1;n<this._mots_offset.length;n++)e.includes(n)?(a===n-1?(s=this._mots_offset[n][1],n===this._mots_offset.length-1&&(t+=this.contenu.slice(o,s))):([o,s]=this._mots_offset[n],t.length>0&&(t+=" "),n===this._mots_offset.length-1&&(t+=this.contenu.slice(o,s))),a=n):s>0&&a===n-1&&(t+=this.contenu.slice(o,s));return t}fonction_texte_pos(e,t=-1){return this.texte_pos(this.fonctionPos(e,t))}get phraseCassee(){return this._phrase_cassee}get longueur(){return this._phrase_cassee.length}static get separateur(){return this._separateur}_remplit_les_vides(){typeof this._fonctions_uniques>"u"&&(this._fonctions_uniques={}),typeof this._fonctions_multiples>"u"&&(this._fonctions_multiples={}),typeof this._groupes_enchasses>"u"&&(this._groupes_enchasses=new Map)}get vide(){for(const[,e]of this._groupes_enchasses)if(!e.vide)return!1;return Object.keys(this._fonctions_uniques).length===0&&Object.keys(this._fonctions_multiples).length===0}ajoute_infos_de_manipulation(e,t){this._manipulations[e]=t}infos_de_manipulation(e){return d(e in this._manipulations,`${e} n'est pas enregistré dans les données de manipulation`),this._manipulations[e]}get est_attributif(){return"sujet"in this._fonctions_uniques&&"attribut_du_sujet"in this._fonctions_uniques}cree_groupe_enchasse(e,t,n){const o=new f(this.contenu,e);return this._groupes_enchasses.set([t,n],o),o._denomination=[t,n],o._parent=this,o}get groupes_enchasses_nombre(){return this._groupes_enchasses.size}groupe_enchasse(e,t){let n;for(const[o,s]of this._groupes_enchasses)o[0]===e&&o[1]===t&&(n=s);if(typeof n>"u")throw Error(`Pas de groupe avec la fonction ${e} et le numéro ${t}`);return n}supprime_groupe_enchasse(e,t){for(const[n]of this._groupes_enchasses)if(n[0]===e&&n[1]===t)return this._groupes_enchasses.delete(n);return!1}fonctions_multiples_nombre(e){const t=this._fonctions_multiples;return e in t?t[e].length:0}get copie(){let e=new f(this.contenu,this._mots_pos);return Object.entries(this._fonctions_uniques).forEach(([t,n])=>{n.length>0&&(e._fonctions_uniques[t]=n)}),Object.entries(this._fonctions_multiples).forEach(([t,n])=>{let o=[];n.length>0&&(o=n.filter(s=>s.length>0)),o.length>0&&(e._fonctions_multiples[t]=o)}),e._groupes_enchasses=new Map([...this._groupes_enchasses.entries()].filter(t=>!t[1].vide).map(t=>[t[0],t[1].copie])),e._manipulations=this._manipulations,e.verbes=this.verbes,e}toJSON(){let e=Object.assign(this.copie);return e._groupes_enchasses=Array.from(this._groupes_enchasses.entries()),e}get profondeur(){return this._groupes_enchasses.size===0?0:Math.max(...[...this._groupes_enchasses.entries()].map(([e,t])=>t.profondeur))+1}fonction(e){let t=[];this.verbes.includes(e)&&t.push("verbes");for(const n in this._fonctions_uniques)this._fonctions_uniques[n].includes(e)&&t.push(n);for(const n in this._fonctions_multiples)for(const o of this._fonctions_multiples[n])if(o.includes(e)){t.push(n);break}for(const[,n]of this._groupes_enchasses){const o=n.fonction(e);o&&t.push(...o)}return t}fonction_detaillee(e){let t=[];this.verbes.includes(e)&&t.push(this._fonction_enchassee("verbes",this.verbes));for(const o in this._fonctions_uniques)this._fonctions_uniques[o].includes(e)&&t.push(this._fonction_enchassee(o,this._fonctions_uniques[o]));const n=this._fonctions_multiples;for(const o in n)for(const s of n[o])s.includes(e)&&t.push(this._fonction_enchassee(o,s));for(const[,o]of this._groupes_enchasses)t.push(...o.fonction_detaillee(e));return t.sort((o,s)=>o[2]-o[1]>s[2]-s[1]?-1:1)}fonctionPos(e,t=-1){return t>=0&&d(f.Fonctions_multiples.includes(e),`fonctionPos:  ${e} n'est pas une fonction multiple`),e=="verbes"?this.verbes:f.Fonctions_multiples.includes(e)?(d(t>-1,`fonctionPos: numero_de_fonction doit être supérieur à -1 pour les fonctions multiples comme ${e}`),!(e in this._fonctions_multiples)||t>=this._fonctions_multiples[e].length?[]:this._fonctions_multiples[e][t]):e in this._fonctions_uniques?this._fonctions_uniques[e]:[]}declareFonction(e,t,n=-1){if(d(this.mots_valides(t),`declareFonction: ${t} ne correspond pas à une liste de mots valides.`),t=t.sort((o,s)=>o-s),e==="verbes"){this.verbes=t;return}if(f.Fonctions_multiples.includes(e)){let o=this._fonctions_multiples;e in o||(d(n<=0,`declareFonction: ${n} introuvable pour ${e}`),o[e]=[]),n===-1||n===o[e].length?o[e].push(t):(d(n<o[e].length,`declareFonction: ${n} introuvable pour ${e}`),o[e][n]=t)}else this._fonctions_uniques[e]=t}fonctionMots(e,t=-1){return t>=0&&(d(f.Fonctions_multiples.includes(e),`fonctionMots: ${e} n'est pas une fonction multiple`),d(e in this._fonctions_multiples,`fonctionMots: ${e} n'a pas été créé.`),d(t<this._fonctions_multiples[e].length,`fonctionMots: ${t} introuvable pour ${e}`)),this.fonctionPos(e,t).map(n=>this._phrase_cassee[n]).join(" ")}mots_valides(e){if(e.length>0){for(const t of e)if(!this._mots_pos.includes(t))return!1}return!0}_casseSyntagme(){this._phrase_cassee=this.phrase.split(f._separateur).filter(e=>e)}*groupes_enchasses(){for(let e of this._groupes_enchasses)yield e}};let h=f;_(h,"Separateur","[ ,;:?!.'-]"),_(h,"_separateur",new RegExp(f.Separateur)),_(h,"Fonctions_multiples",["independante","complement_circonstanciel","modalisateur","auto-enonciative","connecteur","balise_textuelle","epithete","complement_du_nom","complement_du_pronom","complement_de_l_adjectif","apposition"]),_(h,"Fonctions_contenants",["independante","sujet","cod","coi","attribut_du_sujet","attribut_du_cod","complement_circonstanciel","complement_du_verbe_impersonnel","complement_du_nom","complement_du_pronom","epithete","apposition","complement_de_l_adjectif"]);class j extends h{constructor(e,t=[]){super(e,t)}static reviver(e,t){return e===""?j.fromJSON(t):t}static fromJSON(e){if(typeof e=="string")return JSON.parse(e,j.reviver);{let t=Object.create(j.prototype);const n=typeof e._groupes_enchasses>"u"?new Map:new Map(Object.entries(e._groupes_enchasses).map(s=>[s[1][0],j.fromJSON(s[1][1])]));let o=Object.assign(t,e,{_groupes_enchasses:n});return o._remplit_les_vides(),o}}cree_groupe_enchasse(e,t,n){const o=new j(this.contenu,e);return this._groupes_enchasses.set([t,n],o),o._denomination=[t,n],o._parent=this,o}groupe_enchasse(e,t){return super.groupe_enchasse(e,t)}aFonction(e){if(h.Fonctions_multiples.includes(e))return e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>!$(n,[])).length>0:!1;const t=this.fonctionPos(e);return!$(t,[])}aFonctions(e){for(let t of e)if(!this.aFonction(t))return!1;return!0}estFonction(e,t){return t=t.sort((n,o)=>n-o),h.Fonctions_multiples.includes(e)?e in this._fonctions_multiples?this._fonctions_multiples[e].filter(n=>$(n,t)).length>0:!1:$(this.fonctionPos(e),t)}*groupes_enchasses(){for(let e of this._groupes_enchasses)yield e}}class g extends h{constructor(e,t){super(e,t.mots_pos),this._corrige=t,this._corrige=t}cree_groupe_enchasse_eleve(e,t,n){const o=new g(this.contenu,e);return this._groupes_enchasses.set([t,n],o),o._denomination=[t,n],o._parent=this,o}get corrige(){return this._corrige}est_complet(e){const t=this.corrige.fonctions_multiples_nombre(e);if(t!==this.fonctions_multiples_nombre(e))return!1;const n=this._fonctions_multiples[e];for(let o=0;o<t;o++){const s=this.corrige.fonctionPos(e,o);if(n.filter(u=>$(u,s)).length===0)return!1}return!0}est_correct(e,t=-1){return h.Fonctions_multiples.includes(e)?(d(e in this._fonctions_multiples,`${e} n'a jamais été enregistré dans ce syntagme`),d(t<this._fonctions_multiples[e].length,`Pas de numero ${t} pour la fonction ${e} dans ce syntagme`),this.corrige.estFonction(e,this._fonctions_multiples[e][t])):e==="verbes"?this.corrige.estFonction(e,this.verbes):(d(e in this._fonctions_uniques,`${e} n'a pas été enregistré dans ce syntagme`),this.corrige.estFonction(e,this._fonctions_uniques[e]))}declare(e,t,n=-1){return h.Fonctions_multiples.includes(e)&&e in this._fonctions_multiples&&this._fonctions_multiples[e].filter(o=>$(o,t)).length!==0?!1:(this.declareFonction(e,t,n),this.corrige.estFonction(e,t))}}function B(i,e){return["sujet","groupe_verbal"].includes(i)?e?"[":"]":""}function ee(i,e){return e==i[1]||i[0]==="verbes"?`${B(i[0],!0)}<span groupe class="groupe-de-mots phrase-${i[0]}">`:""}function te(i,e){return e==i[2]||i[0]==="verbes"?`</span>${B(i[0],!1)}`:""}function I(i,e=[]){const t=i.ancetre,n=new RegExp("("+g.Separateur+")"),o=t.contenu.split(n);let s=0,a=[];for(const u of o){if(g.Separateur.includes(u)){a.push(u);continue}const l=t.fonction_detaillee(s);l.forEach(p=>a.push(ee(p,s)));const c=e.includes(s)?'class="phrase-cliquable"':'class="phrase-non-cliquable"';a.push(`<span ${c} id="phrase-mot-${s}">${u}</span>`),l.forEach(p=>a.push(te(p,s))),s+=1}return a.join("")}function V(i){const e=z(i);i.style.lineHeight=`${1.8+e/10}`,G(i,e)}function z(i){let e=1;for(let t=0;t<i.children.length;t++){let n=i.children[t];n.hasAttribute("groupe")&&(e=Math.max(e,z(n)+1))}return e}function G(i,e){for(let t=0;t<i.children.length;t++){let n=i.children[t];n.hasAttribute("groupe")&&(n.style.padding=`0px 0px ${e*10}px`,G(n,e-1))}}function ne(i,e){const t=e.arbre_genealogique;if(t.length===1)return i;const n={independante:"l'indépendante",verbes:"Verbes",verbe_noyau:"Verbe noyau",sujet:"le sujet",cod:"le COD",coi:"le COI",attribut_du_sujet:"l'attribut du sujet",attribut_du_cod:"l'attribut du COD",complement_du_verbe_impersonnel:"le complément du verbe impersonnel",complement_d_agent:"le complément d'agent",groupe_verbal:"le groupe verbal",complement_circonstanciel:"le complément circonstanciel",modalisateur:"le modalisateur","auto-enonciative":"la fonction auto-énonciative",connecteur:"le connecteur",balise_textuelle:"la balise textuelle",noyau:"Noyau",epithete:"l'épithète",complement_du_nom:"le complément du nom",complement_du_pronom:"le complément du pronom",apposition:"l'apposition",complement_de_l_adjectif:"le complément de l'adjectif"};return t.slice(1).map(o=>"Dans "+(o[1]===-1?n[o[0]]:`${n[o[0]]} numéro ${o[1]+1}`)).join(" > ")+" : "+i}Array();let m={fonction_de_validation:()=>{console.log("Problème: la fonction de validation n'a pas été mise en place")},ok:()=>{console.log("Aucune fonction définie pour OK")},annuler:()=>{console.log("Aucune fonction définie pour Annuler")},fonction_du_bouton_de_message:()=>console.log("Fonction du bouton de message non mise en place")};function L(i,e,t){const n=r("modal-message"),o=r("modal-message-contenu-texte"),s=r("modal-message-bouton");o.innerHTML=i,s.innerHTML=e,n.style.display="block",m.fonction_du_bouton_de_message=()=>{q(r("modal-message-contenu"),n),t()},m.ok=m.fonction_du_bouton_de_message}const oe={Sujet:"sujet","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},se={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ie={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ae={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},re={"Complément de l'adjectif":"complement_de_l_adjectif",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},le={"Complément de l'adjectif":"complement_de_l_adjectif",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ue={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},ce={Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle"},_e={Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},pe={"Complément de l'adjectif":"complement_de_l_adjectif",Noyau:"noyau"},me={Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},de={Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},he={"Complément de l'adjectif":"complement_de_l_adjectif",Sujet:"sujet",Noyau:"noyau","Verbe noyau":"verbe_noyau","Groupe verbal":"groupe_verbal",COD:"cod",COI:"coi","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément d'agent":"complement_d_agent","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},fe={Noyau:"noyau",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition"},be={independante:oe,sujet:se,cod:ie,coi:ae,attribut_du_sujet:re,attribut_du_cod:le,complement_d_agent:ue,complement_circonstanciel:ce,complement_du_verbe_impersonnel:_e,epithete:pe,complement_du_nom:me,complement_du_pronom:de,apposition:he,complement_de_l_adjectif:fe};let D=()=>console.log("Problème: aucune fonction définie pour le bouton OK de la nouvelle phrase"),K=()=>console.log("Problème: aucune fonction définie pour la validation de la nouvelle phrase"),Q=i=>console.log("Aucune fonction définie pour le sélecteur"),A=()=>(console.log("Problème: enregistre_fonction n'a pas été instancié"),new x("vide")),C=()=>console.log("Problème: aucune fonction définie pour le bouton OK des ajouts de manipulations");function ve(){r("modal-nouvelle_phrase-bouton").addEventListener("click",()=>{D()}),r("bouton-valider-phrase").addEventListener("click",()=>{K()}),r("nouvelle_phrase-fonctions-selection").addEventListener("click",i=>{Q(i)}),r("ajout-manipulations-form").addEventListener("submit",i=>{i.preventDefault(),C()})}class ge{constructor(e,t,n,o,s=-1,a){_(this,"validee",!1);_(this,"est_multiple",!1);this.nom_de_base=e,this.fonction=t,this.html_node=n,this.syntagme=o,this.numero=s,this.parent=a,this.est_multiple=s>-1}get nom(){return this.numero>-1?`${this.nom_de_base}-${this.numero+1}`:this.nom_de_base}get arbre_genealogique(){return typeof this.parent>"u"?this.nom:`${this.parent.arbre_genealogique} > ${this.nom}`}get id_sous_menu(){const e=this.numero===-1?"":`-${this.numero}`,t=`${this.fonction}${e}`;return typeof this.parent>"u"?t:`${this.parent.id_sous_menu}-${t}`}}const M=class{constructor(e){_(this,"_phrase");_(this,"_traceur",[]);_(this,"_pos",0);_(this,"_selecteur",r("nouvelle_phrase-fonctions-selection"));this._phrase=new g(e,new j(e)),this._selecteur.innerHTML="",Object.entries(M.liste_des_fonctions).forEach(t=>this.ajouter_fonction_tracee(this._traceur.length,t[0],t[1])),this._selecteur.style.display="block"}static contenus_possibles(e){return be[e]}set pos(e){this.fonction_courante.html_node.classList.remove("selectionne"),d(e<this._traceur.length,`${e} est plus grand que la longueur du traceur: ${this._traceur.length}.`),this._pos=e,this.fonction_courante.html_node.classList.add("selectionne")}get pos(){return this._pos}get fonction_courante(){return this._traceur[this._pos]}set_pos_selecteur(e,t){for(let n of e.children)n.classList.contains("selecteur")||n.classList.contains("sous_menu")?t=this.set_pos_selecteur(n,t):(n.setAttribute("pos",t.toString()),t+=1);return t}ajouter_node_selecteur(e,t,n,o){for(let s of e.children)if(s.classList.contains("sous_menu")){if(n=this.ajouter_node_selecteur(s.children[1],t,n+1,o),n>o)return n}else{if(n===o&&s.insertAdjacentElement("beforebegin",t),n>o)return n;n+=1}return n===o?(e.appendChild(t),n+1):n}ajouter_fonction_tracee(e,t,n,o=this._phrase,s=-1,a){g.Fonctions_multiples.includes(n)&&s===-1&&(s=0),d(e<=this._traceur.length,`${e} est plus grand que la longueur du traceur`);let u=document.createElement("div");const l=new ge(t,n,u,o,s,a);this._traceur.splice(e,0,l),u.setAttribute("value",l.fonction),u.setAttribute("class","selecteur-element"),u.innerHTML=l.nom,this.ajouter_node_selecteur(this._selecteur,u,0,e),this.set_pos_selecteur(this._selecteur,0)}retirer_enfants(e,t,n=!1){for(const[o,s]of this._traceur.entries())s.parent===e&&(t=this.retirer_enfants(s,t,!1),s.html_node.remove(),t.push(o));return n&&(this._traceur=this._traceur.filter((o,s)=>!t.includes(s)),this.set_pos_selecteur(this._selecteur,0)),t}gere_groupe_enchasse(e,t,n){if(!g.Fonctions_contenants.includes(this.fonction_courante.fonction))return;if(!e){if(n.syntagme.supprime_groupe_enchasse(n.fonction,n.numero)){const l=r(`sous_menu-${n.id_sous_menu}`);l.insertAdjacentElement("beforebegin",n.html_node),this.retirer_enfants(n,[],!0),l.remove()}return}let o=n.syntagme.cree_groupe_enchasse(t,n.fonction,n.numero),s=document.createElement("div");s.setAttribute("class","sous_menu"),s.setAttribute("id",`sous_menu-${n.id_sous_menu}`),this.fonction_courante.html_node.insertAdjacentElement("beforebegin",s),s.insertAdjacentElement("afterbegin",this.fonction_courante.html_node);let a=document.createElement("div");a.setAttribute("class","selecteur sous_menu_contenu"),this.fonction_courante.html_node.insertAdjacentElement("afterend",a);let u=this._pos+1;Object.entries(M.contenus_possibles(this.fonction_courante.fonction)).forEach(l=>{this.ajouter_fonction_tracee(u,l[0],l[1],o,-1,n),u+=1}),s.addEventListener("mouseenter",()=>{a.style.display="block"}),s.addEventListener("mouseleave",()=>{a.style.display="none"})}valide_fonction(e){const t=this.fonction_courante;return t.validee=e,e?t.html_node.classList.add("valide"):t.html_node.classList.remove("valide"),e}analyse_de_fonction(e=-1){e===-1?e=this._pos:this.pos=e;const t=this.fonction_courante.fonction,n=this.fonction_courante.syntagme,o=()=>{const a={groupe_verbal:"verbes verbe_noyau cod coi attribut_du_sujet attribut_du_cod complement_du_verbe_impersonnel".split(" "),verbes:"verbe_noyau groupe_verbal".split(" "),verbe_noyau:"verbes groupe_verbal".split(" "),cod:["groupe_verbal","verbes"],coi:["groupe_verbal","verbes"],attribut_du_sujet:["groupe_verbal","verbes"],attribut_du_cod:["groupe_verbal","verbes"],complement_du_verbe_impersonnel:["groupe_verbal","verbes"]};return t in a?a[t].map(u=>n.fonctionPos(u)).flat().concat(n.mots_sans_fonction).concat(n.fonctionPos(t,this.fonction_courante.numero)):(console.debug("Intégration des mots sans fonction et de la fonction courante dans les mots qu'on peut sélectionner",t),n.mots_sans_fonction.concat(n.fonctionPos(t,this.fonction_courante.numero)).concat(n.fonctionPos("verbes")))};r("phrase-analyse-paragraphe").innerHTML=I(this._phrase,o()),V(r("phrase-analyse-paragraphe")),r("consigne-container").innerHTML=`À renseigner : ${this.fonction_courante.arbre_genealogique}`;const s=n.fonctionPos(t,this.fonction_courante.numero);Array.from(document.getElementsByClassName("phrase-cliquable")).forEach(a=>{s.includes(Number(a.id.split("-")[2]))&&a.classList.add("phrase-selectionne")}),A=()=>{const a=Array.from(document.getElementsByClassName("phrase-selectionne")).map(l=>Number(l.id.split("-")[2]));if(this.fonction_courante.est_multiple&&this._phrase.fonctions_multiples_nombre(t)===this.fonction_courante.numero){if(a.length===0)return this;this.ajouter_fonction_tracee(e+1,this.fonction_courante.nom_de_base,t,n,this.fonction_courante.numero+1)}n.declareFonction(t,a,this.fonction_courante.numero);const u=this.valide_fonction(a.length>0);return this.gere_groupe_enchasse(u,a,this.fonction_courante),this.elements_de_manipulation(u),this},K=async()=>{let a=this._phrase.contenu.replaceAll(" ","_").replace(h.separateur,"").toLowerCase();a=a.length>40?a.slice(0,37)+"...":a;const u=`${a}.v0.7.0.json`;await this.verification_verbes_sans_sujet(this._phrase);const l=new Blob([JSON.stringify(A()._phrase)],{type:"text/json"}),c=document.createElement("a");c.download=u,c.href=window.URL.createObjectURL(l),c.dataset.downloadurl=["text/json",c.download,c.href].join(":");const p=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});c.dispatchEvent(p),c.remove(),R()},m.fonction_de_validation=()=>{A(),this.analyse_de_fonction(e+1)},m.ok=m.fonction_de_validation}manipulation_titre(e){let t;switch(this.fonction_courante.fonction){case"sujet":t="sujet";break;case"cod":t="COD";break;case"groupe_verbal":t="Groupe Verbal";break;case"coi":t="COI";break;default:throw this.fonction_courante.fonction}return r("modal-ajout-manipulations-titre").innerHTML=`Renseignements nécessaires à la manipulation du ${t} : ${e}`,t}cree_fieldset(e,t){return`<fieldset class="ajout-manipulations-cadre">
                    <legend class="ajout-manipulations-cadre-titre">${e}</legend>
                    <div class="ajout-manipulations-cadre-contenu">${t}</div>
                </fieldset>`}cree_select(e,t,n){const o=t.split(",").map(a=>`<option name=${n} value=${a.toLowerCase()}>${a}</option>`).join(" "),s=`<select name="ajout-manipulations-contenu-${n}" class="manipulation-select">
        ${o}</select>
        `;return this.cree_fieldset(e,s)}cree_liste_preposions_coi(e){const t=e.split(" ");let n="à,de,";return t.length>=1&&(n+=t[0]),t.length>=2&&(n+=`,${t[0]} ${t[1]}`),t.length>=3&&(n+=`,${t[0]} ${t[1]} ${t[2]}`),n}recupere_valeur_select(e){return Array.from(document.getElementsByName(e)).filter(t=>t.selected)[0].getAttribute("value")}elements_de_manipulation_verbes(e,t){r("modal-ajout-manipulations").style.display="block",r("modal-ajout-manipulations-titre").innerHTML=`Rentrer les informations nécessaires à la validation d'un verbe sans sujet: ${t}`,r("ajout-manipulations-form-contenu").innerHTML=this.cree_select("Sujet","tu,nous,vous,je,j',il,elle,ils,elles","manipulation-verbe-sans-sujet"),C=()=>{const n=this.recupere_valeur_select("manipulation-verbe-sans-sujet");e.ajoute_infos_de_manipulation("verbe_noyau",{pronominalisation:n}),console.log("manip inside",e.infos_de_manipulation("verbe_noyau")),r("modal-ajout-manipulations").style.display="none"},m.ok=C}async verification_verbes_sans_sujet(e){e.fonctionPos("verbe_noyau").length>0&&e.fonctionPos("sujet").length===0&&(this.elements_de_manipulation_verbes(e,e.fonctionMots("verbe_noyau")),await new Promise((n,o)=>{const s=C;C=()=>{s(),n()}}).then(()=>console.debug("Promise fulfilled")));for(let[t,n]of e.groupes_enchasses())await this.verification_verbes_sans_sujet(n)}elements_de_manipulation(e){if(e&&"sujet cod coi groupe_verbal".split(" ").includes(this.fonction_courante.fonction)){const t=Array.from(document.getElementsByClassName("phrase-selectionne")).map(s=>s.innerHTML).join(" "),n=this.manipulation_titre(t);r("modal-ajout-manipulations").style.display="block";let o=this.fonction_courante;if("sujet cod coi".split(" ").includes(this.fonction_courante.fonction)){let s;switch(n){case"sujet":s="je j' tu il elle nous vous ils elles";break;case"COD":s="me m' te t' le la l' nous vous les";break;case"COI":s="me m' te t' elle lui nous vous leur en y";break;default:throw n}s=s.split(" ");const a=s.includes(t.toLowerCase())?`<input type="hidden" id="pronom-inutile" name="${n}-pronoms" value="null" checked="true">`:`<fieldset class="ajout-manipulations-cadre"><legend class="ajout-manipulations-cadre-titre">Par quoi le ${n} peut-il être pronominalisé ?</legend>`+s.map(l=>`<label class="ajout-manipulations-label" for="pronom-${l}">${l}<input type="radio" class="pronoms" id="pronom-${l}" name="${n}-pronoms" value="${l}" required><span class="ajout-manipulations-radio"></span></label class="ajout-manipulations-label">`).join(" ")+"</fieldset>",u=this.fonction_courante.fonction!=="coi"?"":this.cree_select("Par quelle préposition commence la question pour trouver le COI ?",this.cree_liste_preposions_coi(t),"manipulation-preposition-coi");r("ajout-manipulations-form-contenu").innerHTML=`<fieldset class="ajout-manipulations-cadre"><legend class="ajout-manipulations-cadre-titre">Animé ou non-animé ?</legend><label class="ajout-manipulations-label" for="est-anime">Le référent du ${n} est animé.<input type="radio" id="est-anime" value="true" name="${n}-anime" required><span class="ajout-manipulations-radio"></span></label class="ajout-manipulations-label"><label class="ajout-manipulations-label" for="est-non-anime">Le référent du ${n} est non animé.<input type="radio" id="est-non-anime" value="false" name="${n}-anime" required><span class="ajout-manipulations-radio"></span></label class="ajout-manipulations-label"></fieldset>`+u+a,C=()=>{const l=document.getElementsByName(`${n}-anime`)[0].checked;let c=Array.from(document.getElementsByName(`${n}-pronoms`)).filter(p=>p.checked)[0].getAttribute("value");c==="null"&&(c=null),o.syntagme.ajoute_infos_de_manipulation(o.fonction,(()=>o.fonction==="coi"?{est_anime:l,pronominalisation:c,preposition:this.recupere_valeur_select("manipulation-preposition-coi")}:{est_anime:l,pronominalisation:c})()),r("modal-ajout-manipulations").style.display="none"}}else o.fonction==="groupe_verbal"&&(r("ajout-manipulations-form-contenu").innerHTML=this.cree_select("Verbe pouvant remplacer le groupe verbal","fais,fait,faisons,faites,font","manipulation-verbe"),C=()=>{const s=this.recupere_valeur_select("manipulation-verbe");o.syntagme.ajoute_infos_de_manipulation("groupe_verbal",{verbe:s}),r("modal-ajout-manipulations").style.display="none"});m.ok=C}}};let x=M;_(x,"liste_des_fonctions",{Indépendante:"independante",Verbes:"verbes","Verbe noyau":"verbe_noyau",Sujet:"sujet",COD:"cod",COI:"coi","Attribut du sujet":"attribut_du_sujet","Attribut du COD":"attribut_du_cod","Complément du verbe impersonnel":"complement_du_verbe_impersonnel","Complément d'agent":"complement_d_agent","Groupe verbal":"groupe_verbal","Complément circonstanciel":"complement_circonstanciel",Modalisateur:"modalisateur","Fonction auto-énonciative":"auto-enonciative",Connecteur:"connecteur","Balise textuelle":"balise_textuelle",Noyau:"noyau",Épithète:"epithete","Complément du nom":"complement_du_nom","Complément du pronom":"complement_du_pronom",Apposition:"apposition","Complément de l'adjectif":"complement_de_l_adjectif"});function R(){for(const n of T(document.getElementsByClassName("modal")))n.style.display="none";const i=r("modal-nouvelle-phrase");i.style.display="block",r("nouvelle_phrase-texterea").focus();const e=r("bouton-valider");e.style.width="50%",e.innerHTML="Valider la fonction";const t=r("bouton-valider-phrase");t.style.display="block",D=()=>{let n=r("nouvelle_phrase-texterea").value;if(n.trim()==="")return;n=n.replace(`
`,"");let o=new x(n);i.style.display="none",o.analyse_de_fonction(0),Q=s=>{const a=s.target;A();const u=()=>{let l=a.getAttribute("pos");return typeof l=="string"?parseInt(l):(d(!1,"la valeur de l'attribut est nulle."),-1)};o.analyse_de_fonction(u()),Array.from(document.getElementsByClassName("sous_menu_contenu")).map(l=>l.style.display="none")}},m.ok=D}function ye(){r("conseil").innerHTML="";const i=r("bouton-valider");i.style.width="100%",i.innerHTML="Valider";const e=r("bouton-valider-phrase");e.style.display="none",r("nouvelle_phrase-fonctions-selection").innerHTML=""}const je=[{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[2],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{verbe_noyau:[2],sujet:[0,1],attribut_du_sujet:[3,4,5]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[0,1]}],[["attribut_du_sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{noyau:[5]},_fonctions_multiples:{epithete:[[4]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Cette","bibliothèque","était","un","véritable","trésor"],verbes:[],_mots_offset:[[0,5],[6,18],[19,24],[25,27],[28,37],[38,44]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[4]}]],_manipulations:{},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[3,4,5]}]],_manipulations:{sujet:{est_anime:!1,pronominalisation:"elle"},groupe_verbal:{verbe:"fait"}},phrase:"Cette bibliothèque était un véritable trésor.",_mots_pos:[0,1,2,3,4,5]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[0],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{verbe_noyau:[0],cod:[2,3],coi:[1],groupe_verbal:[0,1,2,3]},_fonctions_multiples:{complement_circonstanciel:[[4]]},_groupes_enchasses:[[["cod",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[2,3]}],[["coi",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[1]}],[["complement_circonstanciel",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Donnez","moi","cette","feuille","maintenant"],verbes:[],_mots_offset:[[0,6],[7,10],[11,16],[17,24],[25,35]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[4]}]],_manipulations:{cod:{est_anime:!1,pronominalisation:"la"},coi:{est_anime:!0,pronominalisation:"me",preposition:"à"},groupe_verbal:{verbe:"faites"},verbe_noyau:{pronominalisation:"vous"}},phrase:"Donnez-moi cette feuille maintenant.",_mots_pos:[0,1,2,3,4]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{independante:[[0,1,2,3,4],[6,7,8,9]]},_groupes_enchasses:[[["independante",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{sujet:[0,1,2,3],verbe_noyau:[4],groupe_verbal:[4]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{noyau:[2]},_fonctions_multiples:{epithete:[[1],[3]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[1]}],[["epithete",1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[3]}]],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[0,1,2,3]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"},groupe_verbal:{verbe:"fait"}},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[0,1,2,3,4]}],[["independante",1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{sujet:[6,7,8],verbe_noyau:[9],groupe_verbal:[9]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{noyau:[8]},_fonctions_multiples:{epithete:[[7]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","petit","chat","roux","boit","et","le","gros","chien","dort"],verbes:[],_mots_offset:[[0,2],[3,8],[9,13],[14,18],[19,23],[24,26],[27,29],[30,34],[35,40],[41,45]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[7]}]],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[6,7,8]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"},groupe_verbal:{verbe:"fait"}},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[6,7,8,9]}]],_manipulations:{},phrase:"Le petit chat roux boit et le gros chien dort.",_mots_pos:[0,1,2,3,4,5,6,7,8,9]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[4,5],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{verbe_noyau:[4,5],sujet:[0,1,2,3],cod:[6,7,8,9,10,11],groupe_verbal:[4,5,6,7,8,9,10,11]},_fonctions_multiples:{},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{noyau:[1]},_fonctions_multiples:{complement_du_nom:[[2,3]]},_groupes_enchasses:[[["complement_du_nom",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[2,3]}]],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[0,1,2,3]}],[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[0,1,2,3]}],[["cod",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{noyau:[7]},_fonctions_multiples:{apposition:[[8,9,10,11]]},_groupes_enchasses:[[["apposition",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{noyau:[9]},_fonctions_multiples:{complement_du_nom:[[10,11]]},_groupes_enchasses:[[["complement_du_nom",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","rat","des","villes","a","invité","son","cousin","le","rat","des","champs"],verbes:[],_mots_offset:[[0,2],[3,6],[7,10],[11,17],[18,19],[20,26],[27,30],[31,37],[39,41],[42,45],[46,49],[50,56]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[10,11]}]],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[8,9,10,11]}]],_manipulations:{},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[6,7,8,9,10,11]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"},cod:{est_anime:!0,pronominalisation:"l'"},groupe_verbal:{verbe:"fait"}},phrase:"Le rat des villes a invité son cousin, le rat des champs.",_mots_pos:[0,1,2,3,4,5,6,7,8,9,10,11]},{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[3,5,14],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{verbe_noyau:[3,5],sujet:[0,1,2],cod:[6,7],groupe_verbal:[3,5,6,7]},_fonctions_multiples:{complement_circonstanciel:[[8,9,10],[11,12,13,14],[4]]},_groupes_enchasses:[[["sujet",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{noyau:[2]},_fonctions_multiples:{epithete:[[1]]},_groupes_enchasses:[[["epithete",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[1]}]],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[0,1,2]}],[["cod",-1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[6,7]}],[["complement_circonstanciel",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[8,9,10]}],[["complement_circonstanciel",1],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[11,12,13,14]}],[["complement_circonstanciel",2],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[4]}],[["complement_circonstanciel",0],{_denomination:["phrase",-1],_parent:null,_phrase_cassee:["Le","vieil","homme","a","longtemps","aimé","se","promener","par","les","champs","quand","la","nuit","tombait"],verbes:[],_mots_offset:[[0,2],[3,8],[9,14],[15,16],[17,26],[27,31],[32,34],[35,43],[44,47],[48,51],[52,58],[59,64],[65,67],[68,72],[73,80]],_fonctions_uniques:{},_fonctions_multiples:{},_groupes_enchasses:[],_manipulations:{},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[8,9,10]}]],_manipulations:{sujet:{est_anime:!0,pronominalisation:"il"},cod:{est_anime:!1,pronominalisation:"l'"},groupe_verbal:{verbe:"fait"}},phrase:"Le vieil homme a longtemps aimé se promener par les champs quand la nuit tombait.",_mots_pos:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]}],Ce=je.map(i=>j.fromJSON(i));function Le(i,e=0){return Ce.slice(e,e+i)}function v(i,e){return`<fieldset class="manipulation-element">
                <legend class="manipulation-element-titre">${i}</legend>
                <span class="manipulation-element-contenu">${e}</span>
            </fieldset>`}function H(i,e){const t=i.offset_pos(e);let n="";for(let o=0,s=0;o<i.contenu.length;o++)o===t[s][0]?n+='<span class="manipulation-supprimable">':o===t[s][1]&&(n+="</span>",s<t.length-1&&s++),n+=i.contenu[o];return v("Suppression",n)}function $e(i,e){const t=i.offset_pos(e),n='<span class="manipulation-deplacement-dropzone"> </span>';let o=n;for(let s=0,a=0;s<i.contenu.length;s++){if(s===t[a][0])o+='<span draggable="true" class="manipulation-deplacable" id="manipulation-deplacable"><span> </span> ';else if(s===t[a][1])o+="<span> </span></span>",a<t.length-1&&a++;else if(i.contenu[s]===" "&&(s<t[a][0]||s>=t[a][1])){o+=n;continue}o+=i.contenu[s]}return o+=n,v("Deplacement",o)}function xe(){const i=()=>{r("manipulation-deplacable").addEventListener("dragstart",t=>{if(t.dataTransfer!==null)t.dataTransfer.setData("text/plain",t.target.id),t.dataTransfer.dropEffect="move";else throw t})},e=t=>{t.addEventListener("dragenter",()=>{t.classList.add("manipulation-dropzone-hover")}),t.addEventListener("dragleave",()=>{t.classList.remove("manipulation-dropzone-hover")}),t.addEventListener("dragover",n=>{const o=n;if(o.dataTransfer===null)throw Error("Pas de données transférées");o.preventDefault(),o.dataTransfer.dropEffect="move"}),t.addEventListener("drop",n=>{const o=n;if(o.dataTransfer===null)throw Error("Pas de données transférées");o.preventDefault();const s=r(o.dataTransfer.getData("text/plain"));let a=o.target;a.classList.remove("manipulation-dropzone-hover");const u=a.outerHTML;a.outerHTML=s.outerHTML,s.outerHTML=u,e(t),i()})};for(const t of document.getElementsByClassName("manipulation-deplacement-dropzone"))i(),e(t)}function w(i){if(i.corrige.aFonction("sujet"))return i.fonction_texte_pos("sujet");if(i.corrige.aFonction("verbe_noyau")){const e=i.corrige.infos_de_manipulation("verbe_noyau").pronominalisation;if(typeof e!="string")throw new Error("Impossible de trouver le sujet");return e}return""}function qe(i,e,t){const n=r("modal-manipulations");n.style.display="block";const o={sujet:"le sujet",attribut_du_sujet:"l'attribut du sujet",cod:"le COD",groupe_verbal:"le groupe verbal",complement_circonstanciel:"le complément circonstanciel"}[i];r("modal-manipulations-titre").innerHTML=`Manipule ${o} pour vérifier ta réponse.`,r("manipulable").innerHTML=e.texte_pos(t),r("manipulable").style.visibility="visible";const s=e.fonction_texte_pos("verbe_noyau"),a=`<span class="manipulation-drop-zone">Glisse ${o} ici</span>`,u=`
            <span class="manipulation-fleche">
    <svg fill="#000000" height="36px" width="100px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
             viewBox="0 0 476.213 476.213" xml:space="preserve">
    <polygon points="345.606,107.5 324.394,128.713 418.787,223.107 0,223.107 0,253.107 418.787,253.107 324.394,347.5 
            345.606,368.713 476.213,238.106 "/>
    </svg> </span>`;if(i==="sujet"){const l=" "+function(){return e.corrige.aFonction("attribut_du_sujet")?e.fonction_texte_pos("attribut_du_sujet"):e.corrige.aFonction("cod")?e.fonction_texte_pos("cod"):""}(),c=e.corrige.infos_de_manipulation("sujet"),p=c.est_anime?"Qui ":"Qu'",y="Je Tu Il Elle Nous Vous Ils Elles".split(" ").map(b=>`<option value="${b.toLowerCase()}">${b}</option>`).join(" ");r("manipulations-form-contenu").innerHTML=`<fieldset class="manipulation-element"><legend class="manipulation-element-titre">Question</legend><span class="manipulation-element-contenu">${p}est-ce qui ${s}${l} ? ${a}</span></fieldset><fieldset class="manipulation-element"><legend class="manipulation-element-titre">Extraction</legend><span class="manipulation-element-contenu">C'est ${a} qui ${s}${l}. </span></fieldset>`+(c.pronominalisation===null?"":`<fieldset class="manipulation-element"><legend class="manipulation-element-titre">Pronominalisation</legend><span class="manipulation-element-contenu">${e.texte_pos(t)} ${s}${l}. ${u}
        <select name="pronoms">${y}</select> ${s}${l}.</span></fieldset>`)}else if(i==="cod"){const l=w(e),c=e.corrige.aFonction("attribut_du_cod")?" "+e.fonction_texte_pos("attribut_du_cod"):"",y=e.corrige.infos_de_manipulation("cod").est_anime?"Qui ":"Qu'",b="le la l' les me m' te t' nous vous".split(" ").map(E=>`<option value="${E.toLowerCase()}">${E}</option>`).join(" ");r("manipulations-form-contenu").innerHTML=v("Question",`${y}est-ce que ${l} ${s}${c} ? ${a}`)+v("Extraction",`C'est ${a} que ${l} ${s}${c}.`)+v("Pronominalisation",`${l} ${s} ${e.texte_pos(t)}${c} ${u} ${l} <select name="pronoms">${b}</select> ${s}${c}.`)}else if(i==="coi"){const l=w(e),c=e.corrige.aFonction("cod")?" "+e.fonction_texte_pos("cod"):"",p=e.corrige.infos_de_manipulation("coi"),y=p.preposition,b=y+" "+p.est_anime?"qui ":"quoi",E="lui leur me m' te t' en y".split(" ").map(P=>`<option value="${P.toLowerCase()}">${P}</option>`).join(" ");r("manipulations-form-contenu").innerHTML=v("Question",`${l} ${s}${c} ${y} ${b} ? ${a}`)+v("Extraction",`C'est ${a} que ${l} ${s}${c}.`)+v("Pronominalisation",`${l} ${s}${c} ${y} ${e.texte_pos(t)} ${u} ${l} <select name="pronoms">${E}</select> ${s}${c}.`)}else if(i==="groupe_verbal"){const l=w(e),p=e.corrige.infos_de_manipulation("groupe_verbal").verbe;r("manipulations-form-contenu").innerHTML=v("Question",`Que ${p} ${l} ? ${l} ${a}`)}else if(i==="attribut_du_sujet"){const l=w(e);r("manipulations-form-contenu").innerHTML=v("Question",`${l} ${s} quoi ? ${a}`)+H(e,t)}else i==="complement_circonstanciel"&&(r("manipulations-form-contenu").innerHTML=H(e,t)+$e(e,t),xe(),r("manipulable").style.visibility="collapse");for(let l of document.getElementsByClassName("manipulation-supprimable"))l.addEventListener("click",()=>{l.classList.remove("manipulation-supprimable"),l.classList.add("manipulation-supprime")});for(const l of document.getElementsByClassName("manipulation-drop-zone"))l.addEventListener("dragover",c=>{const p=c;if(p.dataTransfer===null)throw Error("Pas de données transférées");p.preventDefault(),p.dataTransfer.dropEffect="copy"}),l.addEventListener("drop",c=>{const p=c;if(p.dataTransfer===null)throw Error("Pas de données transférées");p.preventDefault();const y=r(p.dataTransfer.getData("text/plain")).innerHTML;let b=p.target;b.innerHTML=y,b.classList.add("manipulable-deplace"),b.classList.remove("manipulation-drop-zone")})}r("manipulable").addEventListener("dragstart",i=>{i.dataTransfer!==null&&(i.dataTransfer.setData("text/plain",i.target.id),i.dataTransfer.dropEffect="copy")});const O=[["verbes","Sélectionne les verbes."],["independante","Sélectionne une proposition indépendante"],["verbe_noyau","Sélectionne le verbe noyau"],["noyau","Sélectionne le noyau"],["sujet","Sélectionne le groupe sujet"],["attribut_du_sujet","Sélectionne l'attribut du sujet."],["cod","Sélectionne le Complément d'objet direct (COD)."],["coi","Sélectionne le Complément d'objet indirect (COI)."],["attribut_du_cod","Sélectionne l'attribut du COD."],["complement_d_agent","Sélectionne le complément d'agent"],["complement_du_verbe_impersonnel","Sélectionne le complément du verbe impersonnel"],["groupe_verbal","Sélectionne le groupe verbal"],["complement_circonstanciel","Sélectionne un complément circonstanciel"],["complement_du_nom","Sélectionne un complément du nom"],["complement_du_pronom","Sélectionne un complément du pronom"],["epithete","Sélectionne une épithète"],["apposition","Sélectionne une apposition"],["complement_de_l_adjectif","Sélectionne un complément de l'adjectif"],["modalisateur","Sélectionne un modalisateur"],["auto-enonciative","Sélectionne une fonction auto-énonciative"],["connecteur","Sélectionne un connecteur"],["balise_textuelle","Sélectionne une balise textuelle"]];function J(i){let e=new g(i.contenu,i);new F(e).analyse_fonction()}const k=class{constructor(e){_(this,"_consignes_etape",0);_(this,"_fonctions_multiples_index",-1);_(this,"_groupes_enchasses_generateur");_(this,"_corrige");_(this,"_id");_(this,"_fonction_courante","sujet");_(this,"_mots_selectionnes",[]);this._syntagme=e,this._syntagme=e,this._corrige=e.corrige,this._groupes_enchasses_generateur=e.corrige.groupes_enchasses(),this._id=k.current_id++}get id(){return this._id}analyse_finie(){this._syntagme.arbre_genealogique.length===1&&L("Bravo !","Commencer une autre analyse",U);const e=new Event(`AnalyseFinie-${this._id}`);document.dispatchEvent(e)}analyse_fonction(){if(this._fonction_courante=O[this._consignes_etape][0],console.log(`Nouvelle analyse: ${this._fonction_courante}`),!this._corrige.aFonction(this._fonction_courante)){this.analyse_suivante();return}g.Fonctions_multiples.includes(this._fonction_courante)&&this._fonctions_multiples_index===-1&&(this._fonctions_multiples_index=0);const e=O[this._consignes_etape][1]+(this._fonctions_multiples_index>=0?` (${this._fonctions_multiples_index+1})`:"");r("consigne-container").innerHTML=ne(e,this._syntagme),r("phrase-analyse-paragraphe").innerHTML=I(this._syntagme,this._syntagme.mots_pos),V(r("phrase-analyse-paragraphe")),m.fonction_de_validation=()=>{this._mots_selectionnes=Array.from(document.getElementsByClassName("phrase-selectionne")).map(t=>Number(t.id.split("-")[2])),this._mots_selectionnes.length!==0&&(this._syntagme.declare(this._fonction_courante,this._mots_selectionnes,this._fonctions_multiples_index),this.manipule_fonction())},m.ok=m.fonction_de_validation,this.preselection()}preselection(){const e=this._syntagme.fonctionPos(this._fonction_courante,this._fonctions_multiples_index);Array.from(document.getElementsByClassName("phrase-cliquable")).forEach((t,n)=>{e.includes(n)&&t.classList.add("phrase-selectionne")})}async analyse_suivante(){if(this._consignes_etape===O.length-1){console.debug("Fin de l'analyse du syntagme");for(let[[e,t],n]of this._groupes_enchasses_generateur){if(console.debug(`Analyse d'un groupe enchâssé: ${e}`),n.vide){console.debug("Groupe enchâssé vide",e);continue}const o=new k(this._syntagme.cree_groupe_enchasse_eleve(n,e,t));await new Promise((a,u)=>{o.analyse_fonction(),document.addEventListener(`AnalyseFinie-${o.id}`,()=>{a()},{once:!0})}).then(()=>console.debug("promise ok"))}return this.analyse_finie()}else{const e=g.Fonctions_multiples.includes(this._fonction_courante)&&!this._syntagme.est_complet(this._fonction_courante)?0:1;return this._fonctions_multiples_index=e===0?this._fonctions_multiples_index+1:-1,this._consignes_etape+=e,this.analyse_fonction()}}affiche_erreur(){const e=r("modal-message-contenu");e.classList.add("modal-message-erreur"),L("Il y a une erreur dans ton analyse !","Reprendre l'analyse",()=>{e.classList.remove("modal-message-erreur")})}soumettre_fonction(e,t){this._syntagme.est_correct(e,t)?this.analyse_suivante():this.affiche_erreur()}prepare_manipulation(e,t=!0){const n=this;return new Promise((o,s)=>{qe(e,n._syntagme,n._syntagme.fonctionPos(e,this._fonctions_multiples_index));const a={once:!0},u=()=>{t&&q(r("modal-manipulations-contenu"),r("modal-manipulations")),r("modal-manipulations-annuler").removeEventListener("click",l,a),o()},l=()=>{q(r("modal-manipulations-contenu"),r("modal-manipulations")),r("modal-manipulations-OK").removeEventListener("click",u,a),s()};r("modal-manipulations-OK").addEventListener("click",u,a),r("modal-manipulations-annuler").addEventListener("click",l,a),m.ok=u,m.annuler=l})}manipule_fonction(){const e=this,t=s=>O.map((a,u)=>[a[0],u]).filter(a=>a[0]===s)[0][1],n=()=>{this.prepare_manipulation(this._fonction_courante).then(()=>{e.soumettre_fonction(e._fonction_courante,e._fonctions_multiples_index)},()=>{e.analyse_fonction()})},o=s=>(this._corrige.aFonction("sujet")?this.prepare_manipulation("sujet",!1):new Promise(a=>{a()})).then(()=>e.prepare_manipulation(s),()=>{throw"sujet"}).then(()=>{e._corrige.aFonction("sujet")&&!e._syntagme.est_correct("sujet")?(e.affiche_erreur(),e._consignes_etape=t("sujet"),e.analyse_fonction()):e._syntagme.est_correct(s)?e.analyse_suivante():(e.affiche_erreur(),e._consignes_etape=t(s),e.analyse_fonction())},a=>{throw a!=="sujet"?s:a}).catch(a=>{if(a==="sujet")e._consignes_etape=t("sujet");else if(a===s)e._consignes_etape=t(s);else throw a;e.analyse_fonction()});if(this._fonction_courante==="sujet"){if(!this._corrige.aFonctions(["sujet","attribut_du_sujet"])&&!this._corrige.aFonctions(["sujet","cod"])){n();return}this.analyse_suivante();return}else if("coi groupe_verbal complement_circonstanciel".includes(this._fonction_courante)){n();return}else if("attribut_du_sujet cod".split(" ").includes(this._fonction_courante)){if(this._corrige.aFonction("attribut_du_cod"))return;o(this._fonction_courante);return}else if(this._fonction_courante==="attribut_du_cod"){o("cod").then(()=>{this.soumettre_fonction("attribut_du_cod",-1)});return}this.soumettre_fonction(this._fonction_courante,this._fonctions_multiples_index)}};let F=k;_(F,"current_id",0);function U(){const i=r("modal-choix-phrase");i.style.display="block";const e=Le(5,0),t=r("modal-choix-phrase-liste");t.innerHTML="";for(let n in e){const o=e[n],s=Z(t,"li",{id:`modal-choix-phrase-liste-${n}`});s.innerHTML=o.contenu,s.addEventListener("click",()=>{J(e[n]),q(r("modal-choix-phrase-contenu"),i)})}}let N=!1;const S=r("phrase-analyse-paragraphe");S.addEventListener("mousedown",i=>{const e=i.target;i.button!=0||!e.classList.contains("phrase-cliquable")||(N=!0,e.classList.toggle("phrase-selectionne"))});S.addEventListener("mouseover",i=>{const e=i.target;N&&e.classList.contains("phrase-cliquable")&&e.classList.toggle("phrase-selectionne")});S.addEventListener("mouseup",i=>{N=!1});r("bouton-valider").addEventListener("click",()=>{m.fonction_de_validation()});document.onkeyup=function(i){switch(i.which){case 13:m.ok();break;case 27:m.annuler();break}};r("modal-message-bouton").addEventListener("click",()=>{m.fonction_du_bouton_de_message()});r("nouvelle_phrase").addEventListener("click",()=>{R()});r("analyse_fichier").addEventListener("click",()=>{for(const i of T(document.getElementsByClassName("modal")))i.style.display="none";ye(),r("modal-analyse-fichier").style.display="block"});function Ee(){if((()=>{var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&"FormData"in window&&"FileReader"in window})()){const e=r("analyse_fichier_input_form");e.classList.add("has-advanced-upload"),r("analyse_fichier_bouton").style.display="none","drag dragstart dragend dragover dragenter dragleave drop".split(" ").forEach(t=>{e.addEventListener(t,n=>{n.preventDefault(),n.stopPropagation()})}),["dragover","dragenter"].forEach(t=>{e.addEventListener(t,()=>e.classList.add("is-dragover"))}),["dragleave","dragend","drop"].forEach(t=>{e.addEventListener(t,()=>e.classList.remove("is-dragover"))})}else r("analyse_fichier_input").classList.remove("box__file")}function W(i){const e=new FileReader,t=()=>{q(r("modal-analyse-fichier-contenu"),r("modal-analyse-fichier"))};if(i.length==0)return t(),L("Pas de fichier chargé.","OK",()=>{});const n=i[0];if(!(n.type?n.type:"Introuvable").includes("json"))return t(),L("Format invalide","OK",()=>{});e.addEventListener("load",o=>{const s=e.result??"";if(typeof s!="string"||s==="")return t(),L("Fichier invalide","OK",()=>{});try{J(j.fromJSON(s))}catch(a){return console.log(a),t(),a instanceof TypeError?L("Ce fichier n'est pas compatible avec la version actuelle du programme.","OK",()=>{}):L("Fichier invalide","OK",()=>{})}t()}),e.readAsText(n)}r("analyse_fichier_input").addEventListener("change",i=>{const e=i.target;W(e.files)});r("analyse_fichier_input_form").addEventListener("drop",i=>{var e;W((e=i.dataTransfer)==null?void 0:e.files)});ve();U();Ee();
